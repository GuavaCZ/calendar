var __defProp = Object.defineProperty;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== "symbol" ? key + "" : key, value);

// node_modules/svelte/src/runtime/internal/globals.js
var globals = typeof window !== "undefined" ? window : typeof globalThis !== "undefined" ? globalThis : (
  // @ts-ignore Node typings have this
  global
);

// node_modules/svelte/src/runtime/internal/ResizeObserverSingleton.js
var ResizeObserverSingleton = class _ResizeObserverSingleton {
  /** @param {ResizeObserverOptions} options */
  constructor(options) {
    /**
     * @private
     * @readonly
     * @type {WeakMap<Element, import('./private.js').Listener>}
     */
    __publicField(this, "_listeners", "WeakMap" in globals ? /* @__PURE__ */ new WeakMap() : void 0);
    /**
     * @private
     * @type {ResizeObserver}
     */
    __publicField(this, "_observer");
    /** @type {ResizeObserverOptions} */
    __publicField(this, "options");
    this.options = options;
  }
  /**
   * @param {Element} element
   * @param {import('./private.js').Listener} listener
   * @returns {() => void}
   */
  observe(element2, listener) {
    this._listeners.set(element2, listener);
    this._getObserver().observe(element2, this.options);
    return () => {
      this._listeners.delete(element2);
      this._observer.unobserve(element2);
    };
  }
  /**
   * @private
   */
  _getObserver() {
    return this._observer ?? (this._observer = new ResizeObserver((entries) => {
      for (const entry of entries) {
        _ResizeObserverSingleton.entries.set(entry.target, entry);
        this._listeners.get(entry.target)?.(entry);
      }
    }));
  }
};
ResizeObserverSingleton.entries = "WeakMap" in globals ? /* @__PURE__ */ new WeakMap() : void 0;

// node_modules/svelte/src/runtime/internal/dom.js
function insert(target, node, anchor) {
  target.insertBefore(node, anchor || null);
}
function detach(node) {
  if (node.parentNode) {
    node.parentNode.removeChild(node);
  }
}
function element(name) {
  return document.createElement(name);
}
function attr(node, attribute, value) {
  if (value == null) node.removeAttribute(attribute);
  else if (node.getAttribute(attribute) !== value) node.setAttribute(attribute, value);
}
function get_custom_elements_slots(element2) {
  const result = {};
  element2.childNodes.forEach(
    /** @param {Element} node */
    (node) => {
      result[node.slot || "default"] = true;
    }
  );
  return result;
}

// node_modules/svelte/src/shared/boolean_attributes.js
var _boolean_attributes = (
  /** @type {const} */
  [
    "allowfullscreen",
    "allowpaymentrequest",
    "async",
    "autofocus",
    "autoplay",
    "checked",
    "controls",
    "default",
    "defer",
    "disabled",
    "formnovalidate",
    "hidden",
    "inert",
    "ismap",
    "loop",
    "multiple",
    "muted",
    "nomodule",
    "novalidate",
    "open",
    "playsinline",
    "readonly",
    "required",
    "reversed",
    "selected"
  ]
);
var boolean_attributes = /* @__PURE__ */ new Set([..._boolean_attributes]);

// node_modules/svelte/src/runtime/internal/Component.js
var SvelteElement;
if (typeof HTMLElement === "function") {
  SvelteElement = class extends HTMLElement {
    constructor($$componentCtor, $$slots, use_shadow_dom) {
      super();
      /** The Svelte component constructor */
      __publicField(this, "$$ctor");
      /** Slots */
      __publicField(this, "$$s");
      /** The Svelte component instance */
      __publicField(this, "$$c");
      /** Whether or not the custom element is connected */
      __publicField(this, "$$cn", false);
      /** Component props data */
      __publicField(this, "$$d", {});
      /** `true` if currently in the process of reflecting component props back to attributes */
      __publicField(this, "$$r", false);
      /** @type {Record<string, CustomElementPropDefinition>} Props definition (name, reflected, type etc) */
      __publicField(this, "$$p_d", {});
      /** @type {Record<string, Function[]>} Event listeners */
      __publicField(this, "$$l", {});
      /** @type {Map<Function, Function>} Event listener unsubscribe functions */
      __publicField(this, "$$l_u", /* @__PURE__ */ new Map());
      this.$$ctor = $$componentCtor;
      this.$$s = $$slots;
      if (use_shadow_dom) {
        this.attachShadow({ mode: "open" });
      }
    }
    addEventListener(type, listener, options) {
      this.$$l[type] = this.$$l[type] || [];
      this.$$l[type].push(listener);
      if (this.$$c) {
        const unsub = this.$$c.$on(type, listener);
        this.$$l_u.set(listener, unsub);
      }
      super.addEventListener(type, listener, options);
    }
    removeEventListener(type, listener, options) {
      super.removeEventListener(type, listener, options);
      if (this.$$c) {
        const unsub = this.$$l_u.get(listener);
        if (unsub) {
          unsub();
          this.$$l_u.delete(listener);
        }
      }
    }
    async connectedCallback() {
      this.$$cn = true;
      if (!this.$$c) {
        let create_slot = function(name) {
          return () => {
            let node;
            const obj = {
              c: function create() {
                node = element("slot");
                if (name !== "default") {
                  attr(node, "name", name);
                }
              },
              /**
               * @param {HTMLElement} target
               * @param {HTMLElement} [anchor]
               */
              m: function mount(target, anchor) {
                insert(target, node, anchor);
              },
              d: function destroy(detaching) {
                if (detaching) {
                  detach(node);
                }
              }
            };
            return obj;
          };
        };
        await Promise.resolve();
        if (!this.$$cn || this.$$c) {
          return;
        }
        const $$slots = {};
        const existing_slots = get_custom_elements_slots(this);
        for (const name of this.$$s) {
          if (name in existing_slots) {
            $$slots[name] = [create_slot(name)];
          }
        }
        for (const attribute of this.attributes) {
          const name = this.$$g_p(attribute.name);
          if (!(name in this.$$d)) {
            this.$$d[name] = get_custom_element_value(name, attribute.value, this.$$p_d, "toProp");
          }
        }
        for (const key in this.$$p_d) {
          if (!(key in this.$$d) && this[key] !== void 0) {
            this.$$d[key] = this[key];
            delete this[key];
          }
        }
        this.$$c = new this.$$ctor({
          target: this.shadowRoot || this,
          props: {
            ...this.$$d,
            $$slots,
            $$scope: {
              ctx: []
            }
          }
        });
        const reflect_attributes = () => {
          this.$$r = true;
          for (const key in this.$$p_d) {
            this.$$d[key] = this.$$c.$$.ctx[this.$$c.$$.props[key]];
            if (this.$$p_d[key].reflect) {
              const attribute_value = get_custom_element_value(
                key,
                this.$$d[key],
                this.$$p_d,
                "toAttribute"
              );
              if (attribute_value == null) {
                this.removeAttribute(this.$$p_d[key].attribute || key);
              } else {
                this.setAttribute(this.$$p_d[key].attribute || key, attribute_value);
              }
            }
          }
          this.$$r = false;
        };
        this.$$c.$$.after_update.push(reflect_attributes);
        reflect_attributes();
        for (const type in this.$$l) {
          for (const listener of this.$$l[type]) {
            const unsub = this.$$c.$on(type, listener);
            this.$$l_u.set(listener, unsub);
          }
        }
        this.$$l = {};
      }
    }
    // We don't need this when working within Svelte code, but for compatibility of people using this outside of Svelte
    // and setting attributes through setAttribute etc, this is helpful
    attributeChangedCallback(attr2, _oldValue, newValue) {
      if (this.$$r) return;
      attr2 = this.$$g_p(attr2);
      this.$$d[attr2] = get_custom_element_value(attr2, newValue, this.$$p_d, "toProp");
      this.$$c?.$set({ [attr2]: this.$$d[attr2] });
    }
    disconnectedCallback() {
      this.$$cn = false;
      Promise.resolve().then(() => {
        if (!this.$$cn && this.$$c) {
          this.$$c.$destroy();
          this.$$c = void 0;
        }
      });
    }
    $$g_p(attribute_name) {
      return Object.keys(this.$$p_d).find(
        (key) => this.$$p_d[key].attribute === attribute_name || !this.$$p_d[key].attribute && key.toLowerCase() === attribute_name
      ) || attribute_name;
    }
  };
}
function get_custom_element_value(prop, value, props_definition, transform) {
  const type = props_definition[prop]?.type;
  value = type === "Boolean" && typeof value !== "boolean" ? value != null : value;
  if (!transform || !props_definition[prop]) {
    return value;
  } else if (transform === "toAttribute") {
    switch (type) {
      case "Object":
      case "Array":
        return value == null ? null : JSON.stringify(value);
      case "Boolean":
        return value ? "" : null;
      case "Number":
        return value == null ? null : value;
      default:
        return value;
    }
  } else {
    switch (type) {
      case "Object":
      case "Array":
        return value && JSON.parse(value);
      case "Boolean":
        return value;
      case "Number":
        return value != null ? +value : value;
      default:
        return value;
    }
  }
}

// node_modules/@event-calendar/core/index.js
function symbol() {
  return Symbol("ec");
}
var payloadProp = symbol();

// resources/js/calendar-widget.js
function calendarWidget({
  view = "dayGridMonth",
  locale = "en",
  firstDay = 1,
  events = [],
  eventContent = null,
  resourceLabelContent = null,
  selectable = false,
  eventClickEnabled = false,
  eventDragEnabled = false,
  eventResizeEnabled = false,
  noEventsClickEnabled = false,
  dateClickEnabled = false,
  dateSelectEnabled = false,
  datesSetEnabled = false,
  viewDidMountEnabled = false,
  eventAllUpdatedEnabled = false,
  dayMaxEvents = false,
  moreLinkContent = null,
  resources = [],
  hasDateClickContextMenu = false,
  hasDateSelectContextMenu = false,
  hasEventClickContextMenu = false,
  hasNoEventsClickContextMenu = false,
  options = {},
  dayHeaderFormat = null,
  slotLabelFormat = null,
  eventAssetUrl
}) {
  return {
    calendarEl: null,
    init: async function() {
      this.calendarEl = this.$el;
      let self = this;
      let settings = {
        view,
        resources,
        eventSources: [
          {
            events: (fetchInfo, successCallback, failureCallback) => {
              return this.$wire.getEventsJs(fetchInfo);
            }
          }
        ],
        locale,
        firstDay,
        dayMaxEvents,
        selectable: dateSelectEnabled,
        eventStartEditable: eventDragEnabled,
        eventDurationEditable: eventResizeEnabled
      };
      if (dayHeaderFormat) {
        settings.dayHeaderFormat = dayHeaderFormat;
      }
      if (slotLabelFormat) {
        settings.slotLabelFormat = slotLabelFormat;
      }
      if (dateClickEnabled) {
        settings.dateClick = (info) => {
          if (hasDateClickContextMenu) {
            const element2 = document.querySelector("[calendar-context-menu]");
            const menu = Alpine.$data(element2);
            menu.loadActions("dateClick", {
              date: info.date,
              dateStr: info.dateStr,
              allDay: info.allDay,
              view: info.view,
              resource: info.resource
            });
            menu.openMenu(info.jsEvent);
            return;
            self.$el.querySelector("[calendar-context-menu]").dispatchEvent(new CustomEvent("calendar--open-menu", {
              detail: {
                mountData: {
                  date: info.date,
                  dateStr: info.dateStr,
                  allDay: info.allDay,
                  view: info.view,
                  resource: info.resource
                },
                jsEvent: info.jsEvent,
                dayEl: info.dayEl,
                context: "dateClick"
              }
            }));
          } else {
            this.$wire.onDateClick({
              date: info.date,
              dateStr: info.dateStr,
              allDay: info.allDay,
              view: info.view,
              resource: info.resource
            });
          }
        };
      }
      if (dateSelectEnabled) {
        settings.select = (info) => {
          if (hasDateSelectContextMenu) {
            self.$el.querySelector("[calendar-context-menu]").dispatchEvent(new CustomEvent("calendar--open-menu", {
              detail: {
                mountData: {
                  start: info.start,
                  startStr: info.startStr,
                  end: info.end,
                  endStr: info.endStr,
                  allDay: info.allDay,
                  view: info.view,
                  resource: info.resource
                },
                jsEvent: info.jsEvent,
                context: "dateSelect"
              }
            }));
          } else {
            this.$wire.onDateSelect({
              start: info.start,
              startStr: info.startStr,
              end: info.end,
              endStr: info.endStr,
              allDay: info.allDay,
              view: info.view,
              resource: info.resource
            });
          }
        };
      }
      if (datesSetEnabled) {
        settings.datesSet = (info) => {
          this.$wire.onDatesSet({
            start: info.start,
            startStr: info.startStr,
            end: info.end,
            endStr: info.endStr,
            view: info.view
          });
        };
      }
      if (eventContent !== null) {
        settings.eventContent = (info) => {
          const content = self.getEventContent(info);
          if (content === void 0) {
            return void 0;
          }
          return {
            html: content
          };
        };
      }
      if (moreLinkContent !== null) {
        settings.moreLinkContent = (arg) => {
          return {
            html: self.getMoreLinkContent(arg)
          };
        };
      }
      if (resourceLabelContent !== null) {
        settings.resourceLabelContent = (info) => {
          const content = self.getResourceLabelContent(info);
          if (content === void 0) {
            return void 0;
          }
          return {
            html: content
          };
        };
      }
      if (eventClickEnabled) {
        settings.eventClick = (info) => {
          const component = Alpine.$data(info.el);
          component.onClick(info);
        };
      }
      if (noEventsClickEnabled) {
        settings.noEventsClick = (info) => {
          if (hasNoEventsClickContextMenu) {
            self.$el.querySelector("[calendar-context-menu]").dispatchEvent(new CustomEvent("calendar--open-menu", {
              detail: {
                mountData: {
                  view: info.view
                },
                jsEvent: info.jsEvent,
                context: "noEventsClick"
              }
            }));
          } else {
            this.$wire.onNoEventsClick({
              view: info.view
            });
          }
        };
      }
      settings.eventResize = async (info) => {
        const durationEditable = info.event.durationEditable;
        let enabled = eventResizeEnabled;
        if (durationEditable !== void 0) {
          enabled = durationEditable;
        }
        if (enabled) {
          await this.$wire.onEventResize({
            event: info.event,
            oldEvent: info.oldEvent,
            endDelta: info.endDelta,
            view: info.view
          }).then((result) => {
            if (result === false) {
              info.revert();
            }
          });
        }
      };
      settings.eventDrop = async (info) => {
        const startEditable = info.event.startEditable;
        let enabled = eventDragEnabled;
        if (startEditable !== void 0) {
          enabled = startEditable;
        }
        if (enabled) {
          await this.$wire.onEventDrop({
            event: info.event,
            oldEvent: info.oldEvent,
            oldResource: info.oldResource,
            newResource: info.newResource,
            delta: info.delta,
            view: info.view
          }).then((result) => {
            if (result === false) {
              info.revert();
            }
          });
        }
      };
      if (viewDidMountEnabled) {
        settings.viewDidMount = (view2) => {
          this.$wire.onViewDidMount({
            view: view2
          });
        };
      }
      if (eventAllUpdatedEnabled) {
        settings.eventAllUpdated = (info) => {
          this.$wire.onEventAllUpdated({
            info
          });
        };
      }
      settings.eventDidMount = (info) => {
        info.el.setAttribute("x-load");
        info.el.setAttribute("x-load-src", eventAssetUrl);
        info.el.setAttribute("x-data", `event({
                    event: ${JSON.stringify(info.event)},
                    timeText: "${info.timeText}",
                    view: ${JSON.stringify(info.view)},
                    hasEventClickContextMenu: ${hasEventClickContextMenu},
                })`);
      };
      this.ec = EventCalendar.create(this.$el.querySelector("div"), {
        ...settings,
        ...options
      });
      window.addEventListener("calendar--refresh", () => {
        this.ec.refetchEvents();
      });
      this.$wire.on("calendar--set", (data) => {
        this.ec.setOption(data.key, data.value);
      });
    },
    getEventContent: function(info) {
      if (typeof eventContent === "string") {
        return this.wrapContent(eventContent, info);
      }
      if (typeof eventContent === "object") {
        const model = info.event.extendedProps.model;
        const content = eventContent[model];
        if (content === void 0) {
          return void 0;
        }
        return this.wrapContent(content, info);
      }
      return void 0;
    },
    getResourceLabelContent: function(info) {
      if (typeof resourceLabelContent === "string") {
        return this.wrapContent(resourceLabelContent, info);
      }
      if (typeof resourceLabelContent === "object") {
        const model = info.event.extendedProps.model;
        const content = resourceLabelContent[model];
        if (content === void 0) {
          return void 0;
        }
        return this.wrapContent(content, info);
      }
      return void 0;
    },
    getMoreLinkContent: function(info) {
      return this.wrapContent(moreLinkContent, info);
    },
    wrapContent: function(content, info) {
      let container = document.createElement("div");
      container.innerHTML = content;
      container.setAttribute("x-data", JSON.stringify(info));
      container.classList.add("w-full");
      return container.outerHTML;
    }
  };
}
export {
  calendarWidget as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vbm9kZV9tb2R1bGVzL3N2ZWx0ZS9zcmMvcnVudGltZS9pbnRlcm5hbC9nbG9iYWxzLmpzIiwgIi4uLy4uL25vZGVfbW9kdWxlcy9zdmVsdGUvc3JjL3J1bnRpbWUvaW50ZXJuYWwvUmVzaXplT2JzZXJ2ZXJTaW5nbGV0b24uanMiLCAiLi4vLi4vbm9kZV9tb2R1bGVzL3N2ZWx0ZS9zcmMvcnVudGltZS9pbnRlcm5hbC9kb20uanMiLCAiLi4vLi4vbm9kZV9tb2R1bGVzL3N2ZWx0ZS9zcmMvc2hhcmVkL2Jvb2xlYW5fYXR0cmlidXRlcy5qcyIsICIuLi8uLi9ub2RlX21vZHVsZXMvc3ZlbHRlL3NyYy9ydW50aW1lL2ludGVybmFsL0NvbXBvbmVudC5qcyIsICIuLi8uLi9ub2RlX21vZHVsZXMvQGV2ZW50LWNhbGVuZGFyL2NvcmUvaW5kZXguanMiLCAiLi4vLi4vcmVzb3VyY2VzL2pzL2NhbGVuZGFyLXdpZGdldC5qcyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqIEB0eXBlIHt0eXBlb2YgZ2xvYmFsVGhpc30gKi9cbmV4cG9ydCBjb25zdCBnbG9iYWxzID1cblx0dHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCdcblx0XHQ/IHdpbmRvd1xuXHRcdDogdHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnXG5cdFx0PyBnbG9iYWxUaGlzXG5cdFx0OiAvLyBAdHMtaWdub3JlIE5vZGUgdHlwaW5ncyBoYXZlIHRoaXNcblx0XHQgIGdsb2JhbDtcbiIsICJpbXBvcnQgeyBnbG9iYWxzIH0gZnJvbSAnLi9nbG9iYWxzLmpzJztcblxuLyoqXG4gKiBSZXNpemUgb2JzZXJ2ZXIgc2luZ2xldG9uLlxuICogT25lIGxpc3RlbmVyIHBlciBlbGVtZW50IG9ubHkhXG4gKiBodHRwczovL2dyb3Vwcy5nb29nbGUuY29tL2EvY2hyb21pdW0ub3JnL2cvYmxpbmstZGV2L2MvejZpZW5PTlViNUEvbS9GNS1WY1VadEJBQUpcbiAqL1xuZXhwb3J0IGNsYXNzIFJlc2l6ZU9ic2VydmVyU2luZ2xldG9uIHtcblx0LyoqXG5cdCAqIEBwcml2YXRlXG5cdCAqIEByZWFkb25seVxuXHQgKiBAdHlwZSB7V2Vha01hcDxFbGVtZW50LCBpbXBvcnQoJy4vcHJpdmF0ZS5qcycpLkxpc3RlbmVyPn1cblx0ICovXG5cdF9saXN0ZW5lcnMgPSAnV2Vha01hcCcgaW4gZ2xvYmFscyA/IG5ldyBXZWFrTWFwKCkgOiB1bmRlZmluZWQ7XG5cblx0LyoqXG5cdCAqIEBwcml2YXRlXG5cdCAqIEB0eXBlIHtSZXNpemVPYnNlcnZlcn1cblx0ICovXG5cdF9vYnNlcnZlciA9IHVuZGVmaW5lZDtcblxuXHQvKiogQHR5cGUge1Jlc2l6ZU9ic2VydmVyT3B0aW9uc30gKi9cblx0b3B0aW9ucztcblxuXHQvKiogQHBhcmFtIHtSZXNpemVPYnNlcnZlck9wdGlvbnN9IG9wdGlvbnMgKi9cblx0Y29uc3RydWN0b3Iob3B0aW9ucykge1xuXHRcdHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG5cdH1cblxuXHQvKipcblx0ICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50XG5cdCAqIEBwYXJhbSB7aW1wb3J0KCcuL3ByaXZhdGUuanMnKS5MaXN0ZW5lcn0gbGlzdGVuZXJcblx0ICogQHJldHVybnMgeygpID0+IHZvaWR9XG5cdCAqL1xuXHRvYnNlcnZlKGVsZW1lbnQsIGxpc3RlbmVyKSB7XG5cdFx0dGhpcy5fbGlzdGVuZXJzLnNldChlbGVtZW50LCBsaXN0ZW5lcik7XG5cdFx0dGhpcy5fZ2V0T2JzZXJ2ZXIoKS5vYnNlcnZlKGVsZW1lbnQsIHRoaXMub3B0aW9ucyk7XG5cdFx0cmV0dXJuICgpID0+IHtcblx0XHRcdHRoaXMuX2xpc3RlbmVycy5kZWxldGUoZWxlbWVudCk7XG5cdFx0XHR0aGlzLl9vYnNlcnZlci51bm9ic2VydmUoZWxlbWVudCk7IC8vIHRoaXMgbGluZSBjYW4gcHJvYmFibHkgYmUgcmVtb3ZlZFxuXHRcdH07XG5cdH1cblxuXHQvKipcblx0ICogQHByaXZhdGVcblx0ICovXG5cdF9nZXRPYnNlcnZlcigpIHtcblx0XHRyZXR1cm4gKFxuXHRcdFx0dGhpcy5fb2JzZXJ2ZXIgPz9cblx0XHRcdCh0aGlzLl9vYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoZW50cmllcykgPT4ge1xuXHRcdFx0XHRmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcblx0XHRcdFx0XHRSZXNpemVPYnNlcnZlclNpbmdsZXRvbi5lbnRyaWVzLnNldChlbnRyeS50YXJnZXQsIGVudHJ5KTtcblx0XHRcdFx0XHR0aGlzLl9saXN0ZW5lcnMuZ2V0KGVudHJ5LnRhcmdldCk/LihlbnRyeSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pKVxuXHRcdCk7XG5cdH1cbn1cblxuLy8gTmVlZHMgdG8gYmUgd3JpdHRlbiBsaWtlIHRoaXMgdG8gcGFzcyB0aGUgdHJlZS1zaGFrZS10ZXN0XG5SZXNpemVPYnNlcnZlclNpbmdsZXRvbi5lbnRyaWVzID0gJ1dlYWtNYXAnIGluIGdsb2JhbHMgPyBuZXcgV2Vha01hcCgpIDogdW5kZWZpbmVkO1xuIiwgImltcG9ydCB7IGNvbnRlbnRlZGl0YWJsZV90cnV0aHlfdmFsdWVzLCBoYXNfcHJvcCB9IGZyb20gJy4vdXRpbHMuanMnO1xuXG5pbXBvcnQgeyBSZXNpemVPYnNlcnZlclNpbmdsZXRvbiB9IGZyb20gJy4vUmVzaXplT2JzZXJ2ZXJTaW5nbGV0b24uanMnO1xuXG4vLyBUcmFjayB3aGljaCBub2RlcyBhcmUgY2xhaW1lZCBkdXJpbmcgaHlkcmF0aW9uLiBVbmNsYWltZWQgbm9kZXMgY2FuIHRoZW4gYmUgcmVtb3ZlZCBmcm9tIHRoZSBET01cbi8vIGF0IHRoZSBlbmQgb2YgaHlkcmF0aW9uIHdpdGhvdXQgdG91Y2hpbmcgdGhlIHJlbWFpbmluZyBub2Rlcy5cbmxldCBpc19oeWRyYXRpbmcgPSBmYWxzZTtcblxuLyoqXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0X2h5ZHJhdGluZygpIHtcblx0aXNfaHlkcmF0aW5nID0gdHJ1ZTtcbn1cblxuLyoqXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVuZF9oeWRyYXRpbmcoKSB7XG5cdGlzX2h5ZHJhdGluZyA9IGZhbHNlO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7bnVtYmVyfSBsb3dcbiAqIEBwYXJhbSB7bnVtYmVyfSBoaWdoXG4gKiBAcGFyYW0geyhpbmRleDogbnVtYmVyKSA9PiBudW1iZXJ9IGtleVxuICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlXG4gKiBAcmV0dXJucyB7bnVtYmVyfVxuICovXG5mdW5jdGlvbiB1cHBlcl9ib3VuZChsb3csIGhpZ2gsIGtleSwgdmFsdWUpIHtcblx0Ly8gUmV0dXJuIGZpcnN0IGluZGV4IG9mIHZhbHVlIGxhcmdlciB0aGFuIGlucHV0IHZhbHVlIGluIHRoZSByYW5nZSBbbG93LCBoaWdoKVxuXHR3aGlsZSAobG93IDwgaGlnaCkge1xuXHRcdGNvbnN0IG1pZCA9IGxvdyArICgoaGlnaCAtIGxvdykgPj4gMSk7XG5cdFx0aWYgKGtleShtaWQpIDw9IHZhbHVlKSB7XG5cdFx0XHRsb3cgPSBtaWQgKyAxO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRoaWdoID0gbWlkO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gbG93O1xufVxuXG4vKipcbiAqIEBwYXJhbSB7Tm9kZUV4fSB0YXJnZXRcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5mdW5jdGlvbiBpbml0X2h5ZHJhdGUodGFyZ2V0KSB7XG5cdGlmICh0YXJnZXQuaHlkcmF0ZV9pbml0KSByZXR1cm47XG5cdHRhcmdldC5oeWRyYXRlX2luaXQgPSB0cnVlO1xuXHQvLyBXZSBrbm93IHRoYXQgYWxsIGNoaWxkcmVuIGhhdmUgY2xhaW1fb3JkZXIgdmFsdWVzIHNpbmNlIHRoZSB1bmNsYWltZWQgaGF2ZSBiZWVuIGRldGFjaGVkIGlmIHRhcmdldCBpcyBub3QgPGhlYWQ+XG5cblx0bGV0IGNoaWxkcmVuID0gLyoqIEB0eXBlIHtBcnJheUxpa2U8Tm9kZUV4Mj59ICovICh0YXJnZXQuY2hpbGROb2Rlcyk7XG5cdC8vIElmIHRhcmdldCBpcyA8aGVhZD4sIHRoZXJlIG1heSBiZSBjaGlsZHJlbiB3aXRob3V0IGNsYWltX29yZGVyXG5cdGlmICh0YXJnZXQubm9kZU5hbWUgPT09ICdIRUFEJykge1xuXHRcdGNvbnN0IG15X2NoaWxkcmVuID0gW107XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuXHRcdFx0Y29uc3Qgbm9kZSA9IGNoaWxkcmVuW2ldO1xuXHRcdFx0aWYgKG5vZGUuY2xhaW1fb3JkZXIgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRteV9jaGlsZHJlbi5wdXNoKG5vZGUpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRjaGlsZHJlbiA9IG15X2NoaWxkcmVuO1xuXHR9XG5cdC8qXG5cdCAqIFJlb3JkZXIgY2xhaW1lZCBjaGlsZHJlbiBvcHRpbWFsbHkuXG5cdCAqIFdlIGNhbiByZW9yZGVyIGNsYWltZWQgY2hpbGRyZW4gb3B0aW1hbGx5IGJ5IGZpbmRpbmcgdGhlIGxvbmdlc3Qgc3Vic2VxdWVuY2Ugb2Zcblx0ICogbm9kZXMgdGhhdCBhcmUgYWxyZWFkeSBjbGFpbWVkIGluIG9yZGVyIGFuZCBvbmx5IG1vdmluZyB0aGUgcmVzdC4gVGhlIGxvbmdlc3Rcblx0ICogc3Vic2VxdWVuY2Ugb2Ygbm9kZXMgdGhhdCBhcmUgY2xhaW1lZCBpbiBvcmRlciBjYW4gYmUgZm91bmQgYnlcblx0ICogY29tcHV0aW5nIHRoZSBsb25nZXN0IGluY3JlYXNpbmcgc3Vic2VxdWVuY2Ugb2YgLmNsYWltX29yZGVyIHZhbHVlcy5cblx0ICpcblx0ICogVGhpcyBhbGdvcml0aG0gaXMgb3B0aW1hbCBpbiBnZW5lcmF0aW5nIHRoZSBsZWFzdCBhbW91bnQgb2YgcmVvcmRlciBvcGVyYXRpb25zXG5cdCAqIHBvc3NpYmxlLlxuXHQgKlxuXHQgKiBQcm9vZjpcblx0ICogV2Uga25vdyB0aGF0LCBnaXZlbiBhIHNldCBvZiByZW9yZGVyaW5nIG9wZXJhdGlvbnMsIHRoZSBub2RlcyB0aGF0IGRvIG5vdCBtb3ZlXG5cdCAqIGFsd2F5cyBmb3JtIGFuIGluY3JlYXNpbmcgc3Vic2VxdWVuY2UsIHNpbmNlIHRoZXkgZG8gbm90IG1vdmUgYW1vbmcgZWFjaCBvdGhlclxuXHQgKiBtZWFuaW5nIHRoYXQgdGhleSBtdXN0IGJlIGFscmVhZHkgb3JkZXJlZCBhbW9uZyBlYWNoIG90aGVyLiBUaHVzLCB0aGUgbWF4aW1hbFxuXHQgKiBzZXQgb2Ygbm9kZXMgdGhhdCBkbyBub3QgbW92ZSBmb3JtIGEgbG9uZ2VzdCBpbmNyZWFzaW5nIHN1YnNlcXVlbmNlLlxuXHQgKi9cblx0Ly8gQ29tcHV0ZSBsb25nZXN0IGluY3JlYXNpbmcgc3Vic2VxdWVuY2Vcblx0Ly8gbTogc3Vic2VxdWVuY2UgbGVuZ3RoIGogPT4gaW5kZXggayBvZiBzbWFsbGVzdCB2YWx1ZSB0aGF0IGVuZHMgYW4gaW5jcmVhc2luZyBzdWJzZXF1ZW5jZSBvZiBsZW5ndGggalxuXHRjb25zdCBtID0gbmV3IEludDMyQXJyYXkoY2hpbGRyZW4ubGVuZ3RoICsgMSk7XG5cdC8vIFByZWRlY2Vzc29yIGluZGljZXMgKyAxXG5cdGNvbnN0IHAgPSBuZXcgSW50MzJBcnJheShjaGlsZHJlbi5sZW5ndGgpO1xuXHRtWzBdID0gLTE7XG5cdGxldCBsb25nZXN0ID0gMDtcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuXHRcdGNvbnN0IGN1cnJlbnQgPSBjaGlsZHJlbltpXS5jbGFpbV9vcmRlcjtcblx0XHQvLyBGaW5kIHRoZSBsYXJnZXN0IHN1YnNlcXVlbmNlIGxlbmd0aCBzdWNoIHRoYXQgaXQgZW5kcyBpbiBhIHZhbHVlIGxlc3MgdGhhbiBvdXIgY3VycmVudCB2YWx1ZVxuXHRcdC8vIHVwcGVyX2JvdW5kIHJldHVybnMgZmlyc3QgZ3JlYXRlciB2YWx1ZSwgc28gd2Ugc3VidHJhY3Qgb25lXG5cdFx0Ly8gd2l0aCBmYXN0IHBhdGggZm9yIHdoZW4gd2UgYXJlIG9uIHRoZSBjdXJyZW50IGxvbmdlc3Qgc3Vic2VxdWVuY2Vcblx0XHRjb25zdCBzZXFfbGVuID1cblx0XHRcdChsb25nZXN0ID4gMCAmJiBjaGlsZHJlblttW2xvbmdlc3RdXS5jbGFpbV9vcmRlciA8PSBjdXJyZW50XG5cdFx0XHRcdD8gbG9uZ2VzdCArIDFcblx0XHRcdFx0OiB1cHBlcl9ib3VuZCgxLCBsb25nZXN0LCAoaWR4KSA9PiBjaGlsZHJlblttW2lkeF1dLmNsYWltX29yZGVyLCBjdXJyZW50KSkgLSAxO1xuXHRcdHBbaV0gPSBtW3NlcV9sZW5dICsgMTtcblx0XHRjb25zdCBuZXdfbGVuID0gc2VxX2xlbiArIDE7XG5cdFx0Ly8gV2UgY2FuIGd1YXJhbnRlZSB0aGF0IGN1cnJlbnQgaXMgdGhlIHNtYWxsZXN0IHZhbHVlLiBPdGhlcndpc2UsIHdlIHdvdWxkIGhhdmUgZ2VuZXJhdGVkIGEgbG9uZ2VyIHNlcXVlbmNlLlxuXHRcdG1bbmV3X2xlbl0gPSBpO1xuXHRcdGxvbmdlc3QgPSBNYXRoLm1heChuZXdfbGVuLCBsb25nZXN0KTtcblx0fVxuXHQvLyBUaGUgbG9uZ2VzdCBpbmNyZWFzaW5nIHN1YnNlcXVlbmNlIG9mIG5vZGVzIChpbml0aWFsbHkgcmV2ZXJzZWQpXG5cblx0LyoqXG5cdCAqIEB0eXBlIHtOb2RlRXgyW119XG5cdCAqL1xuXHRjb25zdCBsaXMgPSBbXTtcblx0Ly8gVGhlIHJlc3Qgb2YgdGhlIG5vZGVzLCBub2RlcyB0aGF0IHdpbGwgYmUgbW92ZWRcblxuXHQvKipcblx0ICogQHR5cGUge05vZGVFeDJbXX1cblx0ICovXG5cdGNvbnN0IHRvX21vdmUgPSBbXTtcblx0bGV0IGxhc3QgPSBjaGlsZHJlbi5sZW5ndGggLSAxO1xuXHRmb3IgKGxldCBjdXIgPSBtW2xvbmdlc3RdICsgMTsgY3VyICE9IDA7IGN1ciA9IHBbY3VyIC0gMV0pIHtcblx0XHRsaXMucHVzaChjaGlsZHJlbltjdXIgLSAxXSk7XG5cdFx0Zm9yICg7IGxhc3QgPj0gY3VyOyBsYXN0LS0pIHtcblx0XHRcdHRvX21vdmUucHVzaChjaGlsZHJlbltsYXN0XSk7XG5cdFx0fVxuXHRcdGxhc3QtLTtcblx0fVxuXHRmb3IgKDsgbGFzdCA+PSAwOyBsYXN0LS0pIHtcblx0XHR0b19tb3ZlLnB1c2goY2hpbGRyZW5bbGFzdF0pO1xuXHR9XG5cdGxpcy5yZXZlcnNlKCk7XG5cdC8vIFdlIHNvcnQgdGhlIG5vZGVzIGJlaW5nIG1vdmVkIHRvIGd1YXJhbnRlZSB0aGF0IHRoZWlyIGluc2VydGlvbiBvcmRlciBtYXRjaGVzIHRoZSBjbGFpbSBvcmRlclxuXHR0b19tb3ZlLnNvcnQoKGEsIGIpID0+IGEuY2xhaW1fb3JkZXIgLSBiLmNsYWltX29yZGVyKTtcblx0Ly8gRmluYWxseSwgd2UgbW92ZSB0aGUgbm9kZXNcblx0Zm9yIChsZXQgaSA9IDAsIGogPSAwOyBpIDwgdG9fbW92ZS5sZW5ndGg7IGkrKykge1xuXHRcdHdoaWxlIChqIDwgbGlzLmxlbmd0aCAmJiB0b19tb3ZlW2ldLmNsYWltX29yZGVyID49IGxpc1tqXS5jbGFpbV9vcmRlcikge1xuXHRcdFx0aisrO1xuXHRcdH1cblx0XHRjb25zdCBhbmNob3IgPSBqIDwgbGlzLmxlbmd0aCA/IGxpc1tqXSA6IG51bGw7XG5cdFx0dGFyZ2V0Lmluc2VydEJlZm9yZSh0b19tb3ZlW2ldLCBhbmNob3IpO1xuXHR9XG59XG5cbi8qKlxuICogQHBhcmFtIHtOb2RlfSB0YXJnZXRcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcHBlbmQodGFyZ2V0LCBub2RlKSB7XG5cdHRhcmdldC5hcHBlbmRDaGlsZChub2RlKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge05vZGV9IHRhcmdldFxuICogQHBhcmFtIHtzdHJpbmd9IHN0eWxlX3NoZWV0X2lkXG4gKiBAcGFyYW0ge3N0cmluZ30gc3R5bGVzXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwcGVuZF9zdHlsZXModGFyZ2V0LCBzdHlsZV9zaGVldF9pZCwgc3R5bGVzKSB7XG5cdGNvbnN0IGFwcGVuZF9zdHlsZXNfdG8gPSBnZXRfcm9vdF9mb3Jfc3R5bGUodGFyZ2V0KTtcblx0aWYgKCFhcHBlbmRfc3R5bGVzX3RvLmdldEVsZW1lbnRCeUlkKHN0eWxlX3NoZWV0X2lkKSkge1xuXHRcdGNvbnN0IHN0eWxlID0gZWxlbWVudCgnc3R5bGUnKTtcblx0XHRzdHlsZS5pZCA9IHN0eWxlX3NoZWV0X2lkO1xuXHRcdHN0eWxlLnRleHRDb250ZW50ID0gc3R5bGVzO1xuXHRcdGFwcGVuZF9zdHlsZXNoZWV0KGFwcGVuZF9zdHlsZXNfdG8sIHN0eWxlKTtcblx0fVxufVxuXG4vKipcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHJldHVybnMge1NoYWRvd1Jvb3QgfCBEb2N1bWVudH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldF9yb290X2Zvcl9zdHlsZShub2RlKSB7XG5cdGlmICghbm9kZSkgcmV0dXJuIGRvY3VtZW50O1xuXHRjb25zdCByb290ID0gbm9kZS5nZXRSb290Tm9kZSA/IG5vZGUuZ2V0Um9vdE5vZGUoKSA6IG5vZGUub3duZXJEb2N1bWVudDtcblx0aWYgKHJvb3QgJiYgLyoqIEB0eXBlIHtTaGFkb3dSb290fSAqLyAocm9vdCkuaG9zdCkge1xuXHRcdHJldHVybiAvKiogQHR5cGUge1NoYWRvd1Jvb3R9ICovIChyb290KTtcblx0fVxuXHRyZXR1cm4gbm9kZS5vd25lckRvY3VtZW50O1xufVxuXG4vKipcbiAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICogQHJldHVybnMge0NTU1N0eWxlU2hlZXR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhcHBlbmRfZW1wdHlfc3R5bGVzaGVldChub2RlKSB7XG5cdGNvbnN0IHN0eWxlX2VsZW1lbnQgPSBlbGVtZW50KCdzdHlsZScpO1xuXHQvLyBGb3IgdHJhbnNpdGlvbnMgdG8gd29yayB3aXRob3V0ICdzdHlsZS1zcmM6IHVuc2FmZS1pbmxpbmUnIENvbnRlbnQgU2VjdXJpdHkgUG9saWN5LFxuXHQvLyB0aGVzZSBlbXB0eSB0YWdzIG5lZWQgdG8gYmUgYWxsb3dlZCB3aXRoIGEgaGFzaCBhcyBhIHdvcmthcm91bmQgdW50aWwgd2UgbW92ZSB0byB0aGUgV2ViIEFuaW1hdGlvbnMgQVBJLlxuXHQvLyBVc2luZyB0aGUgaGFzaCBmb3IgdGhlIGVtcHR5IHN0cmluZyAoZm9yIGFuIGVtcHR5IHRhZykgd29ya3MgaW4gYWxsIGJyb3dzZXJzIGV4Y2VwdCBTYWZhcmkuXG5cdC8vIFNvIGFzIGEgd29ya2Fyb3VuZCBmb3IgdGhlIHdvcmthcm91bmQsIHdoZW4gd2UgYXBwZW5kIGVtcHR5IHN0eWxlIHRhZ3Mgd2Ugc2V0IHRoZWlyIGNvbnRlbnQgdG8gLyogZW1wdHkgKi8uXG5cdC8vIFRoZSBoYXNoICdzaGEyNTYtOU9sTk8wRE5FZWFWekhMNFJad0NMc0JIQThXQlE4dG9CcC80RjVYVjJuYz0nIHdpbGwgdGhlbiB3b3JrIGV2ZW4gaW4gU2FmYXJpLlxuXHRzdHlsZV9lbGVtZW50LnRleHRDb250ZW50ID0gJy8qIGVtcHR5ICovJztcblx0YXBwZW5kX3N0eWxlc2hlZXQoZ2V0X3Jvb3RfZm9yX3N0eWxlKG5vZGUpLCBzdHlsZV9lbGVtZW50KTtcblx0cmV0dXJuIHN0eWxlX2VsZW1lbnQuc2hlZXQ7XG59XG5cbi8qKlxuICogQHBhcmFtIHtTaGFkb3dSb290IHwgRG9jdW1lbnR9IG5vZGVcbiAqIEBwYXJhbSB7SFRNTFN0eWxlRWxlbWVudH0gc3R5bGVcbiAqIEByZXR1cm5zIHtDU1NTdHlsZVNoZWV0fVxuICovXG5mdW5jdGlvbiBhcHBlbmRfc3R5bGVzaGVldChub2RlLCBzdHlsZSkge1xuXHRhcHBlbmQoLyoqIEB0eXBlIHtEb2N1bWVudH0gKi8gKG5vZGUpLmhlYWQgfHwgbm9kZSwgc3R5bGUpO1xuXHRyZXR1cm4gc3R5bGUuc2hlZXQ7XG59XG5cbi8qKlxuICogQHBhcmFtIHtOb2RlRXh9IHRhcmdldFxuICogQHBhcmFtIHtOb2RlRXh9IG5vZGVcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXBwZW5kX2h5ZHJhdGlvbih0YXJnZXQsIG5vZGUpIHtcblx0aWYgKGlzX2h5ZHJhdGluZykge1xuXHRcdGluaXRfaHlkcmF0ZSh0YXJnZXQpO1xuXHRcdGlmIChcblx0XHRcdHRhcmdldC5hY3R1YWxfZW5kX2NoaWxkID09PSB1bmRlZmluZWQgfHxcblx0XHRcdCh0YXJnZXQuYWN0dWFsX2VuZF9jaGlsZCAhPT0gbnVsbCAmJiB0YXJnZXQuYWN0dWFsX2VuZF9jaGlsZC5wYXJlbnROb2RlICE9PSB0YXJnZXQpXG5cdFx0KSB7XG5cdFx0XHR0YXJnZXQuYWN0dWFsX2VuZF9jaGlsZCA9IHRhcmdldC5maXJzdENoaWxkO1xuXHRcdH1cblx0XHQvLyBTa2lwIG5vZGVzIG9mIHVuZGVmaW5lZCBvcmRlcmluZ1xuXHRcdHdoaWxlICh0YXJnZXQuYWN0dWFsX2VuZF9jaGlsZCAhPT0gbnVsbCAmJiB0YXJnZXQuYWN0dWFsX2VuZF9jaGlsZC5jbGFpbV9vcmRlciA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHR0YXJnZXQuYWN0dWFsX2VuZF9jaGlsZCA9IHRhcmdldC5hY3R1YWxfZW5kX2NoaWxkLm5leHRTaWJsaW5nO1xuXHRcdH1cblx0XHRpZiAobm9kZSAhPT0gdGFyZ2V0LmFjdHVhbF9lbmRfY2hpbGQpIHtcblx0XHRcdC8vIFdlIG9ubHkgaW5zZXJ0IGlmIHRoZSBvcmRlcmluZyBvZiB0aGlzIG5vZGUgc2hvdWxkIGJlIG1vZGlmaWVkIG9yIHRoZSBwYXJlbnQgbm9kZSBpcyBub3QgdGFyZ2V0XG5cdFx0XHRpZiAobm9kZS5jbGFpbV9vcmRlciAhPT0gdW5kZWZpbmVkIHx8IG5vZGUucGFyZW50Tm9kZSAhPT0gdGFyZ2V0KSB7XG5cdFx0XHRcdHRhcmdldC5pbnNlcnRCZWZvcmUobm9kZSwgdGFyZ2V0LmFjdHVhbF9lbmRfY2hpbGQpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHR0YXJnZXQuYWN0dWFsX2VuZF9jaGlsZCA9IG5vZGUubmV4dFNpYmxpbmc7XG5cdFx0fVxuXHR9IGVsc2UgaWYgKG5vZGUucGFyZW50Tm9kZSAhPT0gdGFyZ2V0IHx8IG5vZGUubmV4dFNpYmxpbmcgIT09IG51bGwpIHtcblx0XHR0YXJnZXQuYXBwZW5kQ2hpbGQobm9kZSk7XG5cdH1cbn1cblxuLyoqXG4gKiBAcGFyYW0ge05vZGV9IHRhcmdldFxuICogQHBhcmFtIHtOb2RlfSBub2RlXG4gKiBAcGFyYW0ge05vZGV9IFthbmNob3JdXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluc2VydCh0YXJnZXQsIG5vZGUsIGFuY2hvcikge1xuXHR0YXJnZXQuaW5zZXJ0QmVmb3JlKG5vZGUsIGFuY2hvciB8fCBudWxsKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge05vZGVFeH0gdGFyZ2V0XG4gKiBAcGFyYW0ge05vZGVFeH0gbm9kZVxuICogQHBhcmFtIHtOb2RlRXh9IFthbmNob3JdXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluc2VydF9oeWRyYXRpb24odGFyZ2V0LCBub2RlLCBhbmNob3IpIHtcblx0aWYgKGlzX2h5ZHJhdGluZyAmJiAhYW5jaG9yKSB7XG5cdFx0YXBwZW5kX2h5ZHJhdGlvbih0YXJnZXQsIG5vZGUpO1xuXHR9IGVsc2UgaWYgKG5vZGUucGFyZW50Tm9kZSAhPT0gdGFyZ2V0IHx8IG5vZGUubmV4dFNpYmxpbmcgIT0gYW5jaG9yKSB7XG5cdFx0dGFyZ2V0Lmluc2VydEJlZm9yZShub2RlLCBhbmNob3IgfHwgbnVsbCk7XG5cdH1cbn1cblxuLyoqXG4gKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5leHBvcnQgZnVuY3Rpb24gZGV0YWNoKG5vZGUpIHtcblx0aWYgKG5vZGUucGFyZW50Tm9kZSkge1xuXHRcdG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTtcblx0fVxufVxuXG4vKipcbiAqIEByZXR1cm5zIHt2b2lkfSAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlc3Ryb3lfZWFjaChpdGVyYXRpb25zLCBkZXRhY2hpbmcpIHtcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBpdGVyYXRpb25zLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0aWYgKGl0ZXJhdGlvbnNbaV0pIGl0ZXJhdGlvbnNbaV0uZChkZXRhY2hpbmcpO1xuXHR9XG59XG5cbi8qKlxuICogQHRlbXBsYXRlIHtrZXlvZiBIVE1MRWxlbWVudFRhZ05hbWVNYXB9IEtcbiAqIEBwYXJhbSB7S30gbmFtZVxuICogQHJldHVybnMge0hUTUxFbGVtZW50VGFnTmFtZU1hcFtLXX1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVsZW1lbnQobmFtZSkge1xuXHRyZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChuYW1lKTtcbn1cblxuLyoqXG4gKiBAdGVtcGxhdGUge2tleW9mIEhUTUxFbGVtZW50VGFnTmFtZU1hcH0gS1xuICogQHBhcmFtIHtLfSBuYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gaXNcbiAqIEByZXR1cm5zIHtIVE1MRWxlbWVudFRhZ05hbWVNYXBbS119XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbGVtZW50X2lzKG5hbWUsIGlzKSB7XG5cdHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG5hbWUsIHsgaXMgfSk7XG59XG5cbi8qKlxuICogQHRlbXBsYXRlIFRcbiAqIEB0ZW1wbGF0ZSB7a2V5b2YgVH0gS1xuICogQHBhcmFtIHtUfSBvYmpcbiAqIEBwYXJhbSB7S1tdfSBleGNsdWRlXG4gKiBAcmV0dXJucyB7UGljazxULCBFeGNsdWRlPGtleW9mIFQsIEs+Pn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG9iamVjdF93aXRob3V0X3Byb3BlcnRpZXMob2JqLCBleGNsdWRlKSB7XG5cdGNvbnN0IHRhcmdldCA9IC8qKiBAdHlwZSB7UGljazxULCBFeGNsdWRlPGtleW9mIFQsIEs+Pn0gKi8gKHt9KTtcblx0Zm9yIChjb25zdCBrIGluIG9iaikge1xuXHRcdGlmIChcblx0XHRcdGhhc19wcm9wKG9iaiwgaykgJiZcblx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdGV4Y2x1ZGUuaW5kZXhPZihrKSA9PT0gLTFcblx0XHQpIHtcblx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdHRhcmdldFtrXSA9IG9ialtrXTtcblx0XHR9XG5cdH1cblx0cmV0dXJuIHRhcmdldDtcbn1cblxuLyoqXG4gKiBAdGVtcGxhdGUge2tleW9mIFNWR0VsZW1lbnRUYWdOYW1lTWFwfSBLXG4gKiBAcGFyYW0ge0t9IG5hbWVcbiAqIEByZXR1cm5zIHtTVkdFbGVtZW50fVxuICovXG5leHBvcnQgZnVuY3Rpb24gc3ZnX2VsZW1lbnQobmFtZSkge1xuXHRyZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsIG5hbWUpO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBkYXRhXG4gKiBAcmV0dXJucyB7VGV4dH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRleHQoZGF0YSkge1xuXHRyZXR1cm4gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGF0YSk7XG59XG5cbi8qKlxuICogQHJldHVybnMge1RleHR9ICovXG5leHBvcnQgZnVuY3Rpb24gc3BhY2UoKSB7XG5cdHJldHVybiB0ZXh0KCcgJyk7XG59XG5cbi8qKlxuICogQHJldHVybnMge1RleHR9ICovXG5leHBvcnQgZnVuY3Rpb24gZW1wdHkoKSB7XG5cdHJldHVybiB0ZXh0KCcnKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gY29udGVudFxuICogQHJldHVybnMge0NvbW1lbnR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb21tZW50KGNvbnRlbnQpIHtcblx0cmV0dXJuIGRvY3VtZW50LmNyZWF0ZUNvbW1lbnQoY29udGVudCk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtFdmVudFRhcmdldH0gbm9kZVxuICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50XG4gKiBAcGFyYW0ge0V2ZW50TGlzdGVuZXJPckV2ZW50TGlzdGVuZXJPYmplY3R9IGhhbmRsZXJcbiAqIEBwYXJhbSB7Ym9vbGVhbiB8IEFkZEV2ZW50TGlzdGVuZXJPcHRpb25zIHwgRXZlbnRMaXN0ZW5lck9wdGlvbnN9IFtvcHRpb25zXVxuICogQHJldHVybnMgeygpID0+IHZvaWR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsaXN0ZW4obm9kZSwgZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMpIHtcblx0bm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyLCBvcHRpb25zKTtcblx0cmV0dXJuICgpID0+IG5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlciwgb3B0aW9ucyk7XG59XG5cbi8qKlxuICogQHJldHVybnMgeyhldmVudDogYW55KSA9PiBhbnl9ICovXG5leHBvcnQgZnVuY3Rpb24gcHJldmVudF9kZWZhdWx0KGZuKSB7XG5cdHJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHtcblx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHRyZXR1cm4gZm4uY2FsbCh0aGlzLCBldmVudCk7XG5cdH07XG59XG5cbi8qKlxuICogQHJldHVybnMgeyhldmVudDogYW55KSA9PiBhbnl9ICovXG5leHBvcnQgZnVuY3Rpb24gc3RvcF9wcm9wYWdhdGlvbihmbikge1xuXHRyZXR1cm4gZnVuY3Rpb24gKGV2ZW50KSB7XG5cdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHJldHVybiBmbi5jYWxsKHRoaXMsIGV2ZW50KTtcblx0fTtcbn1cblxuLyoqXG4gKiBAcmV0dXJucyB7KGV2ZW50OiBhbnkpID0+IGFueX0gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdG9wX2ltbWVkaWF0ZV9wcm9wYWdhdGlvbihmbikge1xuXHRyZXR1cm4gZnVuY3Rpb24gKGV2ZW50KSB7XG5cdFx0ZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHJldHVybiBmbi5jYWxsKHRoaXMsIGV2ZW50KTtcblx0fTtcbn1cblxuLyoqXG4gKiBAcmV0dXJucyB7KGV2ZW50OiBhbnkpID0+IHZvaWR9ICovXG5leHBvcnQgZnVuY3Rpb24gc2VsZihmbikge1xuXHRyZXR1cm4gZnVuY3Rpb24gKGV2ZW50KSB7XG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdGlmIChldmVudC50YXJnZXQgPT09IHRoaXMpIGZuLmNhbGwodGhpcywgZXZlbnQpO1xuXHR9O1xufVxuXG4vKipcbiAqIEByZXR1cm5zIHsoZXZlbnQ6IGFueSkgPT4gdm9pZH0gKi9cbmV4cG9ydCBmdW5jdGlvbiB0cnVzdGVkKGZuKSB7XG5cdHJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHtcblx0XHQvLyBAdHMtaWdub3JlXG5cdFx0aWYgKGV2ZW50LmlzVHJ1c3RlZCkgZm4uY2FsbCh0aGlzLCBldmVudCk7XG5cdH07XG59XG5cbi8qKlxuICogQHBhcmFtIHtFbGVtZW50fSBub2RlXG4gKiBAcGFyYW0ge3N0cmluZ30gYXR0cmlidXRlXG4gKiBAcGFyYW0ge3N0cmluZ30gW3ZhbHVlXVxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhdHRyKG5vZGUsIGF0dHJpYnV0ZSwgdmFsdWUpIHtcblx0aWYgKHZhbHVlID09IG51bGwpIG5vZGUucmVtb3ZlQXR0cmlidXRlKGF0dHJpYnV0ZSk7XG5cdGVsc2UgaWYgKG5vZGUuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkgIT09IHZhbHVlKSBub2RlLnNldEF0dHJpYnV0ZShhdHRyaWJ1dGUsIHZhbHVlKTtcbn1cbi8qKlxuICogTGlzdCBvZiBhdHRyaWJ1dGVzIHRoYXQgc2hvdWxkIGFsd2F5cyBiZSBzZXQgdGhyb3VnaCB0aGUgYXR0ciBtZXRob2QsXG4gKiBiZWNhdXNlIHVwZGF0aW5nIHRoZW0gdGhyb3VnaCB0aGUgcHJvcGVydHkgc2V0dGVyIGRvZXNuJ3Qgd29yayByZWxpYWJseS5cbiAqIEluIHRoZSBleGFtcGxlIG9mIGB3aWR0aGAvYGhlaWdodGAsIHRoZSBwcm9ibGVtIGlzIHRoYXQgdGhlIHNldHRlciBvbmx5XG4gKiBhY2NlcHRzIG51bWVyaWMgdmFsdWVzLCBidXQgdGhlIGF0dHJpYnV0ZSBjYW4gYWxzbyBiZSBzZXQgdG8gYSBzdHJpbmcgbGlrZSBgNTAlYC5cbiAqIElmIHRoaXMgbGlzdCBiZWNvbWVzIHRvbyBiaWcsIHJldGhpbmsgdGhpcyBhcHByb2FjaC5cbiAqL1xuY29uc3QgYWx3YXlzX3NldF90aHJvdWdoX3NldF9hdHRyaWJ1dGUgPSBbJ3dpZHRoJywgJ2hlaWdodCddO1xuXG4vKipcbiAqIEBwYXJhbSB7RWxlbWVudCAmIEVsZW1lbnRDU1NJbmxpbmVTdHlsZX0gbm9kZVxuICogQHBhcmFtIHt7IFt4OiBzdHJpbmddOiBzdHJpbmcgfX0gYXR0cmlidXRlc1xuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRfYXR0cmlidXRlcyhub2RlLCBhdHRyaWJ1dGVzKSB7XG5cdC8vIEB0cy1pZ25vcmVcblx0Y29uc3QgZGVzY3JpcHRvcnMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhub2RlLl9fcHJvdG9fXyk7XG5cdGZvciAoY29uc3Qga2V5IGluIGF0dHJpYnV0ZXMpIHtcblx0XHRpZiAoYXR0cmlidXRlc1trZXldID09IG51bGwpIHtcblx0XHRcdG5vZGUucmVtb3ZlQXR0cmlidXRlKGtleSk7XG5cdFx0fSBlbHNlIGlmIChrZXkgPT09ICdzdHlsZScpIHtcblx0XHRcdG5vZGUuc3R5bGUuY3NzVGV4dCA9IGF0dHJpYnV0ZXNba2V5XTtcblx0XHR9IGVsc2UgaWYgKGtleSA9PT0gJ19fdmFsdWUnKSB7XG5cdFx0XHQvKiogQHR5cGUge2FueX0gKi8gKG5vZGUpLnZhbHVlID0gbm9kZVtrZXldID0gYXR0cmlidXRlc1trZXldO1xuXHRcdH0gZWxzZSBpZiAoXG5cdFx0XHRkZXNjcmlwdG9yc1trZXldICYmXG5cdFx0XHRkZXNjcmlwdG9yc1trZXldLnNldCAmJlxuXHRcdFx0YWx3YXlzX3NldF90aHJvdWdoX3NldF9hdHRyaWJ1dGUuaW5kZXhPZihrZXkpID09PSAtMVxuXHRcdCkge1xuXHRcdFx0bm9kZVtrZXldID0gYXR0cmlidXRlc1trZXldO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRhdHRyKG5vZGUsIGtleSwgYXR0cmlidXRlc1trZXldKTtcblx0XHR9XG5cdH1cbn1cblxuLyoqXG4gKiBAcGFyYW0ge0VsZW1lbnQgJiBFbGVtZW50Q1NTSW5saW5lU3R5bGV9IG5vZGVcbiAqIEBwYXJhbSB7eyBbeDogc3RyaW5nXTogc3RyaW5nIH19IGF0dHJpYnV0ZXNcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0X3N2Z19hdHRyaWJ1dGVzKG5vZGUsIGF0dHJpYnV0ZXMpIHtcblx0Zm9yIChjb25zdCBrZXkgaW4gYXR0cmlidXRlcykge1xuXHRcdGF0dHIobm9kZSwga2V5LCBhdHRyaWJ1dGVzW2tleV0pO1xuXHR9XG59XG5cbi8qKlxuICogQHBhcmFtIHtSZWNvcmQ8c3RyaW5nLCB1bmtub3duPn0gZGF0YV9tYXBcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0X2N1c3RvbV9lbGVtZW50X2RhdGFfbWFwKG5vZGUsIGRhdGFfbWFwKSB7XG5cdE9iamVjdC5rZXlzKGRhdGFfbWFwKS5mb3JFYWNoKChrZXkpID0+IHtcblx0XHRzZXRfY3VzdG9tX2VsZW1lbnRfZGF0YShub2RlLCBrZXksIGRhdGFfbWFwW2tleV0pO1xuXHR9KTtcbn1cblxuLyoqXG4gKiBAcmV0dXJucyB7dm9pZH0gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRfY3VzdG9tX2VsZW1lbnRfZGF0YShub2RlLCBwcm9wLCB2YWx1ZSkge1xuXHRjb25zdCBsb3dlciA9IHByb3AudG9Mb3dlckNhc2UoKTsgLy8gZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgYmVoYXZpb3Igd2UgZG8gbG93ZXJjYXNlIGZpcnN0XG5cdGlmIChsb3dlciBpbiBub2RlKSB7XG5cdFx0bm9kZVtsb3dlcl0gPSB0eXBlb2Ygbm9kZVtsb3dlcl0gPT09ICdib29sZWFuJyAmJiB2YWx1ZSA9PT0gJycgPyB0cnVlIDogdmFsdWU7XG5cdH0gZWxzZSBpZiAocHJvcCBpbiBub2RlKSB7XG5cdFx0bm9kZVtwcm9wXSA9IHR5cGVvZiBub2RlW3Byb3BdID09PSAnYm9vbGVhbicgJiYgdmFsdWUgPT09ICcnID8gdHJ1ZSA6IHZhbHVlO1xuXHR9IGVsc2Uge1xuXHRcdGF0dHIobm9kZSwgcHJvcCwgdmFsdWUpO1xuXHR9XG59XG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHRhZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0X2R5bmFtaWNfZWxlbWVudF9kYXRhKHRhZykge1xuXHRyZXR1cm4gLy0vLnRlc3QodGFnKSA/IHNldF9jdXN0b21fZWxlbWVudF9kYXRhX21hcCA6IHNldF9hdHRyaWJ1dGVzO1xufVxuXG4vKipcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5leHBvcnQgZnVuY3Rpb24geGxpbmtfYXR0cihub2RlLCBhdHRyaWJ1dGUsIHZhbHVlKSB7XG5cdG5vZGUuc2V0QXR0cmlidXRlTlMoJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnLCBhdHRyaWJ1dGUsIHZhbHVlKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBub2RlXG4gKiBAcmV0dXJucyB7c3RyaW5nfVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0X3N2ZWx0ZV9kYXRhc2V0KG5vZGUpIHtcblx0cmV0dXJuIG5vZGUuZGF0YXNldC5zdmVsdGVIO1xufVxuXG4vKipcbiAqIEByZXR1cm5zIHt1bmtub3duW119ICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0X2JpbmRpbmdfZ3JvdXBfdmFsdWUoZ3JvdXAsIF9fdmFsdWUsIGNoZWNrZWQpIHtcblx0Y29uc3QgdmFsdWUgPSBuZXcgU2V0KCk7XG5cdGZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXAubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRpZiAoZ3JvdXBbaV0uY2hlY2tlZCkgdmFsdWUuYWRkKGdyb3VwW2ldLl9fdmFsdWUpO1xuXHR9XG5cdGlmICghY2hlY2tlZCkge1xuXHRcdHZhbHVlLmRlbGV0ZShfX3ZhbHVlKTtcblx0fVxuXHRyZXR1cm4gQXJyYXkuZnJvbSh2YWx1ZSk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtIVE1MSW5wdXRFbGVtZW50W119IGdyb3VwXG4gKiBAcmV0dXJucyB7eyBwKC4uLmlucHV0czogSFRNTElucHV0RWxlbWVudFtdKTogdm9pZDsgcigpOiB2b2lkOyB9fVxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5pdF9iaW5kaW5nX2dyb3VwKGdyb3VwKSB7XG5cdC8qKlxuXHQgKiBAdHlwZSB7SFRNTElucHV0RWxlbWVudFtdfSAqL1xuXHRsZXQgX2lucHV0cztcblx0cmV0dXJuIHtcblx0XHQvKiBwdXNoICovIHAoLi4uaW5wdXRzKSB7XG5cdFx0XHRfaW5wdXRzID0gaW5wdXRzO1xuXHRcdFx0X2lucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4gZ3JvdXAucHVzaChpbnB1dCkpO1xuXHRcdH0sXG5cdFx0LyogcmVtb3ZlICovIHIoKSB7XG5cdFx0XHRfaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiBncm91cC5zcGxpY2UoZ3JvdXAuaW5kZXhPZihpbnB1dCksIDEpKTtcblx0XHR9XG5cdH07XG59XG5cbi8qKlxuICogQHBhcmFtIHtudW1iZXJbXX0gaW5kZXhlc1xuICogQHJldHVybnMge3sgdShuZXdfaW5kZXhlczogbnVtYmVyW10pOiB2b2lkOyBwKC4uLmlucHV0czogSFRNTElucHV0RWxlbWVudFtdKTogdm9pZDsgcjogKCkgPT4gdm9pZDsgfX1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXRfYmluZGluZ19ncm91cF9keW5hbWljKGdyb3VwLCBpbmRleGVzKSB7XG5cdC8qKlxuXHQgKiBAdHlwZSB7SFRNTElucHV0RWxlbWVudFtdfSAqL1xuXHRsZXQgX2dyb3VwID0gZ2V0X2JpbmRpbmdfZ3JvdXAoZ3JvdXApO1xuXG5cdC8qKlxuXHQgKiBAdHlwZSB7SFRNTElucHV0RWxlbWVudFtdfSAqL1xuXHRsZXQgX2lucHV0cztcblxuXHRmdW5jdGlvbiBnZXRfYmluZGluZ19ncm91cChncm91cCkge1xuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgaW5kZXhlcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0Z3JvdXAgPSBncm91cFtpbmRleGVzW2ldXSA9IGdyb3VwW2luZGV4ZXNbaV1dIHx8IFtdO1xuXHRcdH1cblx0XHRyZXR1cm4gZ3JvdXA7XG5cdH1cblxuXHQvKipcblx0ICogQHJldHVybnMge3ZvaWR9ICovXG5cdGZ1bmN0aW9uIHB1c2goKSB7XG5cdFx0X2lucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4gX2dyb3VwLnB1c2goaW5wdXQpKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAcmV0dXJucyB7dm9pZH0gKi9cblx0ZnVuY3Rpb24gcmVtb3ZlKCkge1xuXHRcdF9pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IF9ncm91cC5zcGxpY2UoX2dyb3VwLmluZGV4T2YoaW5wdXQpLCAxKSk7XG5cdH1cblx0cmV0dXJuIHtcblx0XHQvKiB1cGRhdGUgKi8gdShuZXdfaW5kZXhlcykge1xuXHRcdFx0aW5kZXhlcyA9IG5ld19pbmRleGVzO1xuXHRcdFx0Y29uc3QgbmV3X2dyb3VwID0gZ2V0X2JpbmRpbmdfZ3JvdXAoZ3JvdXApO1xuXHRcdFx0aWYgKG5ld19ncm91cCAhPT0gX2dyb3VwKSB7XG5cdFx0XHRcdHJlbW92ZSgpO1xuXHRcdFx0XHRfZ3JvdXAgPSBuZXdfZ3JvdXA7XG5cdFx0XHRcdHB1c2goKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdC8qIHB1c2ggKi8gcCguLi5pbnB1dHMpIHtcblx0XHRcdF9pbnB1dHMgPSBpbnB1dHM7XG5cdFx0XHRwdXNoKCk7XG5cdFx0fSxcblx0XHQvKiByZW1vdmUgKi8gcjogcmVtb3ZlXG5cdH07XG59XG5cbi8qKiBAcmV0dXJucyB7bnVtYmVyfSAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvX251bWJlcih2YWx1ZSkge1xuXHRyZXR1cm4gdmFsdWUgPT09ICcnID8gbnVsbCA6ICt2YWx1ZTtcbn1cblxuLyoqIEByZXR1cm5zIHthbnlbXX0gKi9cbmV4cG9ydCBmdW5jdGlvbiB0aW1lX3Jhbmdlc190b19hcnJheShyYW5nZXMpIHtcblx0Y29uc3QgYXJyYXkgPSBbXTtcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRhcnJheS5wdXNoKHsgc3RhcnQ6IHJhbmdlcy5zdGFydChpKSwgZW5kOiByYW5nZXMuZW5kKGkpIH0pO1xuXHR9XG5cdHJldHVybiBhcnJheTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnRcbiAqIEByZXR1cm5zIHtDaGlsZE5vZGVbXX1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNoaWxkcmVuKGVsZW1lbnQpIHtcblx0cmV0dXJuIEFycmF5LmZyb20oZWxlbWVudC5jaGlsZE5vZGVzKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge0NoaWxkTm9kZUFycmF5fSBub2Rlc1xuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmZ1bmN0aW9uIGluaXRfY2xhaW1faW5mbyhub2Rlcykge1xuXHRpZiAobm9kZXMuY2xhaW1faW5mbyA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0bm9kZXMuY2xhaW1faW5mbyA9IHsgbGFzdF9pbmRleDogMCwgdG90YWxfY2xhaW1lZDogMCB9O1xuXHR9XG59XG5cbi8qKlxuICogQHRlbXBsYXRlIHtDaGlsZE5vZGVFeH0gUlxuICogQHBhcmFtIHtDaGlsZE5vZGVBcnJheX0gbm9kZXNcbiAqIEBwYXJhbSB7KG5vZGU6IENoaWxkTm9kZUV4KSA9PiBub2RlIGlzIFJ9IHByZWRpY2F0ZVxuICogQHBhcmFtIHsobm9kZTogQ2hpbGROb2RlRXgpID0+IENoaWxkTm9kZUV4IHwgdW5kZWZpbmVkfSBwcm9jZXNzX25vZGVcbiAqIEBwYXJhbSB7KCkgPT4gUn0gY3JlYXRlX25vZGVcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZG9udF91cGRhdGVfbGFzdF9pbmRleFxuICogQHJldHVybnMge1J9XG4gKi9cbmZ1bmN0aW9uIGNsYWltX25vZGUobm9kZXMsIHByZWRpY2F0ZSwgcHJvY2Vzc19ub2RlLCBjcmVhdGVfbm9kZSwgZG9udF91cGRhdGVfbGFzdF9pbmRleCA9IGZhbHNlKSB7XG5cdC8vIFRyeSB0byBmaW5kIG5vZGVzIGluIGFuIG9yZGVyIHN1Y2ggdGhhdCB3ZSBsZW5ndGhlbiB0aGUgbG9uZ2VzdCBpbmNyZWFzaW5nIHN1YnNlcXVlbmNlXG5cdGluaXRfY2xhaW1faW5mbyhub2Rlcyk7XG5cdGNvbnN0IHJlc3VsdF9ub2RlID0gKCgpID0+IHtcblx0XHQvLyBXZSBmaXJzdCB0cnkgdG8gZmluZCBhbiBlbGVtZW50IGFmdGVyIHRoZSBwcmV2aW91cyBvbmVcblx0XHRmb3IgKGxldCBpID0gbm9kZXMuY2xhaW1faW5mby5sYXN0X2luZGV4OyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdGNvbnN0IG5vZGUgPSBub2Rlc1tpXTtcblx0XHRcdGlmIChwcmVkaWNhdGUobm9kZSkpIHtcblx0XHRcdFx0Y29uc3QgcmVwbGFjZW1lbnQgPSBwcm9jZXNzX25vZGUobm9kZSk7XG5cdFx0XHRcdGlmIChyZXBsYWNlbWVudCA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0bm9kZXMuc3BsaWNlKGksIDEpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdG5vZGVzW2ldID0gcmVwbGFjZW1lbnQ7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCFkb250X3VwZGF0ZV9sYXN0X2luZGV4KSB7XG5cdFx0XHRcdFx0bm9kZXMuY2xhaW1faW5mby5sYXN0X2luZGV4ID0gaTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gbm9kZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0Ly8gT3RoZXJ3aXNlLCB3ZSB0cnkgdG8gZmluZCBvbmUgYmVmb3JlXG5cdFx0Ly8gV2UgaXRlcmF0ZSBpbiByZXZlcnNlIHNvIHRoYXQgd2UgZG9uJ3QgZ28gdG9vIGZhciBiYWNrXG5cdFx0Zm9yIChsZXQgaSA9IG5vZGVzLmNsYWltX2luZm8ubGFzdF9pbmRleCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XHRjb25zdCBub2RlID0gbm9kZXNbaV07XG5cdFx0XHRpZiAocHJlZGljYXRlKG5vZGUpKSB7XG5cdFx0XHRcdGNvbnN0IHJlcGxhY2VtZW50ID0gcHJvY2Vzc19ub2RlKG5vZGUpO1xuXHRcdFx0XHRpZiAocmVwbGFjZW1lbnQgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdG5vZGVzLnNwbGljZShpLCAxKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRub2Rlc1tpXSA9IHJlcGxhY2VtZW50O1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICghZG9udF91cGRhdGVfbGFzdF9pbmRleCkge1xuXHRcdFx0XHRcdG5vZGVzLmNsYWltX2luZm8ubGFzdF9pbmRleCA9IGk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmVwbGFjZW1lbnQgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdC8vIFNpbmNlIHdlIHNwbGljZWQgYmVmb3JlIHRoZSBsYXN0X2luZGV4LCB3ZSBkZWNyZWFzZSBpdFxuXHRcdFx0XHRcdG5vZGVzLmNsYWltX2luZm8ubGFzdF9pbmRleC0tO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBub2RlO1xuXHRcdFx0fVxuXHRcdH1cblx0XHQvLyBJZiB3ZSBjYW4ndCBmaW5kIGFueSBtYXRjaGluZyBub2RlLCB3ZSBjcmVhdGUgYSBuZXcgb25lXG5cdFx0cmV0dXJuIGNyZWF0ZV9ub2RlKCk7XG5cdH0pKCk7XG5cdHJlc3VsdF9ub2RlLmNsYWltX29yZGVyID0gbm9kZXMuY2xhaW1faW5mby50b3RhbF9jbGFpbWVkO1xuXHRub2Rlcy5jbGFpbV9pbmZvLnRvdGFsX2NsYWltZWQgKz0gMTtcblx0cmV0dXJuIHJlc3VsdF9ub2RlO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7Q2hpbGROb2RlQXJyYXl9IG5vZGVzXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICogQHBhcmFtIHt7IFtrZXk6IHN0cmluZ106IGJvb2xlYW4gfX0gYXR0cmlidXRlc1xuICogQHBhcmFtIHsobmFtZTogc3RyaW5nKSA9PiBFbGVtZW50IHwgU1ZHRWxlbWVudH0gY3JlYXRlX2VsZW1lbnRcbiAqIEByZXR1cm5zIHtFbGVtZW50IHwgU1ZHRWxlbWVudH1cbiAqL1xuZnVuY3Rpb24gY2xhaW1fZWxlbWVudF9iYXNlKG5vZGVzLCBuYW1lLCBhdHRyaWJ1dGVzLCBjcmVhdGVfZWxlbWVudCkge1xuXHRyZXR1cm4gY2xhaW1fbm9kZShcblx0XHRub2Rlcyxcblx0XHQvKiogQHJldHVybnMge25vZGUgaXMgRWxlbWVudCB8IFNWR0VsZW1lbnR9ICovXG5cdFx0KG5vZGUpID0+IG5vZGUubm9kZU5hbWUgPT09IG5hbWUsXG5cdFx0LyoqIEBwYXJhbSB7RWxlbWVudH0gbm9kZSAqL1xuXHRcdChub2RlKSA9PiB7XG5cdFx0XHRjb25zdCByZW1vdmUgPSBbXTtcblx0XHRcdGZvciAobGV0IGogPSAwOyBqIDwgbm9kZS5hdHRyaWJ1dGVzLmxlbmd0aDsgaisrKSB7XG5cdFx0XHRcdGNvbnN0IGF0dHJpYnV0ZSA9IG5vZGUuYXR0cmlidXRlc1tqXTtcblx0XHRcdFx0aWYgKCFhdHRyaWJ1dGVzW2F0dHJpYnV0ZS5uYW1lXSkge1xuXHRcdFx0XHRcdHJlbW92ZS5wdXNoKGF0dHJpYnV0ZS5uYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmVtb3ZlLmZvckVhY2goKHYpID0+IG5vZGUucmVtb3ZlQXR0cmlidXRlKHYpKTtcblx0XHRcdHJldHVybiB1bmRlZmluZWQ7XG5cdFx0fSxcblx0XHQoKSA9PiBjcmVhdGVfZWxlbWVudChuYW1lKVxuXHQpO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7Q2hpbGROb2RlQXJyYXl9IG5vZGVzXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICogQHBhcmFtIHt7IFtrZXk6IHN0cmluZ106IGJvb2xlYW4gfX0gYXR0cmlidXRlc1xuICogQHJldHVybnMge0VsZW1lbnQgfCBTVkdFbGVtZW50fVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2xhaW1fZWxlbWVudChub2RlcywgbmFtZSwgYXR0cmlidXRlcykge1xuXHRyZXR1cm4gY2xhaW1fZWxlbWVudF9iYXNlKG5vZGVzLCBuYW1lLCBhdHRyaWJ1dGVzLCBlbGVtZW50KTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge0NoaWxkTm9kZUFycmF5fSBub2Rlc1xuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqIEBwYXJhbSB7eyBba2V5OiBzdHJpbmddOiBib29sZWFuIH19IGF0dHJpYnV0ZXNcbiAqIEByZXR1cm5zIHtFbGVtZW50IHwgU1ZHRWxlbWVudH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsYWltX3N2Z19lbGVtZW50KG5vZGVzLCBuYW1lLCBhdHRyaWJ1dGVzKSB7XG5cdHJldHVybiBjbGFpbV9lbGVtZW50X2Jhc2Uobm9kZXMsIG5hbWUsIGF0dHJpYnV0ZXMsIHN2Z19lbGVtZW50KTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge0NoaWxkTm9kZUFycmF5fSBub2Rlc1xuICogQHJldHVybnMge1RleHR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjbGFpbV90ZXh0KG5vZGVzLCBkYXRhKSB7XG5cdHJldHVybiBjbGFpbV9ub2RlKFxuXHRcdG5vZGVzLFxuXHRcdC8qKiBAcmV0dXJucyB7bm9kZSBpcyBUZXh0fSAqL1xuXHRcdChub2RlKSA9PiBub2RlLm5vZGVUeXBlID09PSAzLFxuXHRcdC8qKiBAcGFyYW0ge1RleHR9IG5vZGUgKi9cblx0XHQobm9kZSkgPT4ge1xuXHRcdFx0Y29uc3QgZGF0YV9zdHIgPSAnJyArIGRhdGE7XG5cdFx0XHRpZiAobm9kZS5kYXRhLnN0YXJ0c1dpdGgoZGF0YV9zdHIpKSB7XG5cdFx0XHRcdGlmIChub2RlLmRhdGEubGVuZ3RoICE9PSBkYXRhX3N0ci5sZW5ndGgpIHtcblx0XHRcdFx0XHRyZXR1cm4gbm9kZS5zcGxpdFRleHQoZGF0YV9zdHIubGVuZ3RoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bm9kZS5kYXRhID0gZGF0YV9zdHI7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHQoKSA9PiB0ZXh0KGRhdGEpLFxuXHRcdHRydWUgLy8gVGV4dCBub2RlcyBzaG91bGQgbm90IHVwZGF0ZSBsYXN0IGluZGV4IHNpbmNlIGl0IGlzIGxpa2VseSBub3Qgd29ydGggaXQgdG8gZWxpbWluYXRlIGFuIGluY3JlYXNpbmcgc3Vic2VxdWVuY2Ugb2YgYWN0dWFsIGVsZW1lbnRzXG5cdCk7XG59XG5cbi8qKlxuICogQHJldHVybnMge1RleHR9ICovXG5leHBvcnQgZnVuY3Rpb24gY2xhaW1fc3BhY2Uobm9kZXMpIHtcblx0cmV0dXJuIGNsYWltX3RleHQobm9kZXMsICcgJyk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtDaGlsZE5vZGVBcnJheX0gbm9kZXNcbiAqIEByZXR1cm5zIHtDb21tZW50fVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2xhaW1fY29tbWVudChub2RlcywgZGF0YSkge1xuXHRyZXR1cm4gY2xhaW1fbm9kZShcblx0XHRub2Rlcyxcblx0XHQvKiogQHJldHVybnMge25vZGUgaXMgQ29tbWVudH0gKi9cblx0XHQobm9kZSkgPT4gbm9kZS5ub2RlVHlwZSA9PT0gOCxcblx0XHQvKiogQHBhcmFtIHtDb21tZW50fSBub2RlICovXG5cdFx0KG5vZGUpID0+IHtcblx0XHRcdG5vZGUuZGF0YSA9ICcnICsgZGF0YTtcblx0XHRcdHJldHVybiB1bmRlZmluZWQ7XG5cdFx0fSxcblx0XHQoKSA9PiBjb21tZW50KGRhdGEpLFxuXHRcdHRydWVcblx0KTtcbn1cblxuZnVuY3Rpb24gZ2V0X2NvbW1lbnRfaWR4KG5vZGVzLCB0ZXh0LCBzdGFydCkge1xuXHRmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBub2Rlcy5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdGNvbnN0IG5vZGUgPSBub2Rlc1tpXTtcblx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PT0gOCAvKiBjb21tZW50IG5vZGUgKi8gJiYgbm9kZS50ZXh0Q29udGVudC50cmltKCkgPT09IHRleHQpIHtcblx0XHRcdHJldHVybiBpO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gLTE7XG59XG5cbi8qKlxuICogQHBhcmFtIHtib29sZWFufSBpc19zdmdcbiAqIEByZXR1cm5zIHtIdG1sVGFnSHlkcmF0aW9ufVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2xhaW1faHRtbF90YWcobm9kZXMsIGlzX3N2Zykge1xuXHQvLyBmaW5kIGh0bWwgb3BlbmluZyB0YWdcblx0Y29uc3Qgc3RhcnRfaW5kZXggPSBnZXRfY29tbWVudF9pZHgobm9kZXMsICdIVE1MX1RBR19TVEFSVCcsIDApO1xuXHRjb25zdCBlbmRfaW5kZXggPSBnZXRfY29tbWVudF9pZHgobm9kZXMsICdIVE1MX1RBR19FTkQnLCBzdGFydF9pbmRleCArIDEpO1xuXHRpZiAoc3RhcnRfaW5kZXggPT09IC0xIHx8IGVuZF9pbmRleCA9PT0gLTEpIHtcblx0XHRyZXR1cm4gbmV3IEh0bWxUYWdIeWRyYXRpb24oaXNfc3ZnKTtcblx0fVxuXG5cdGluaXRfY2xhaW1faW5mbyhub2Rlcyk7XG5cdGNvbnN0IGh0bWxfdGFnX25vZGVzID0gbm9kZXMuc3BsaWNlKHN0YXJ0X2luZGV4LCBlbmRfaW5kZXggLSBzdGFydF9pbmRleCArIDEpO1xuXHRkZXRhY2goaHRtbF90YWdfbm9kZXNbMF0pO1xuXHRkZXRhY2goaHRtbF90YWdfbm9kZXNbaHRtbF90YWdfbm9kZXMubGVuZ3RoIC0gMV0pO1xuXHRjb25zdCBjbGFpbWVkX25vZGVzID0gaHRtbF90YWdfbm9kZXMuc2xpY2UoMSwgaHRtbF90YWdfbm9kZXMubGVuZ3RoIC0gMSk7XG5cdGlmIChjbGFpbWVkX25vZGVzLmxlbmd0aCA9PT0gMCkge1xuXHRcdHJldHVybiBuZXcgSHRtbFRhZ0h5ZHJhdGlvbihpc19zdmcpO1xuXHR9XG5cdGZvciAoY29uc3QgbiBvZiBjbGFpbWVkX25vZGVzKSB7XG5cdFx0bi5jbGFpbV9vcmRlciA9IG5vZGVzLmNsYWltX2luZm8udG90YWxfY2xhaW1lZDtcblx0XHRub2Rlcy5jbGFpbV9pbmZvLnRvdGFsX2NsYWltZWQgKz0gMTtcblx0fVxuXHRyZXR1cm4gbmV3IEh0bWxUYWdIeWRyYXRpb24oaXNfc3ZnLCBjbGFpbWVkX25vZGVzKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge1RleHR9IHRleHRcbiAqIEBwYXJhbSB7dW5rbm93bn0gZGF0YVxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRfZGF0YSh0ZXh0LCBkYXRhKSB7XG5cdGRhdGEgPSAnJyArIGRhdGE7XG5cdGlmICh0ZXh0LmRhdGEgPT09IGRhdGEpIHJldHVybjtcblx0dGV4dC5kYXRhID0gLyoqIEB0eXBlIHtzdHJpbmd9ICovIChkYXRhKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge1RleHR9IHRleHRcbiAqIEBwYXJhbSB7dW5rbm93bn0gZGF0YVxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRfZGF0YV9jb250ZW50ZWRpdGFibGUodGV4dCwgZGF0YSkge1xuXHRkYXRhID0gJycgKyBkYXRhO1xuXHRpZiAodGV4dC53aG9sZVRleHQgPT09IGRhdGEpIHJldHVybjtcblx0dGV4dC5kYXRhID0gLyoqIEB0eXBlIHtzdHJpbmd9ICovIChkYXRhKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge1RleHR9IHRleHRcbiAqIEBwYXJhbSB7dW5rbm93bn0gZGF0YVxuICogQHBhcmFtIHtzdHJpbmd9IGF0dHJfdmFsdWVcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0X2RhdGFfbWF5YmVfY29udGVudGVkaXRhYmxlKHRleHQsIGRhdGEsIGF0dHJfdmFsdWUpIHtcblx0aWYgKH5jb250ZW50ZWRpdGFibGVfdHJ1dGh5X3ZhbHVlcy5pbmRleE9mKGF0dHJfdmFsdWUpKSB7XG5cdFx0c2V0X2RhdGFfY29udGVudGVkaXRhYmxlKHRleHQsIGRhdGEpO1xuXHR9IGVsc2Uge1xuXHRcdHNldF9kYXRhKHRleHQsIGRhdGEpO1xuXHR9XG59XG5cbi8qKlxuICogQHJldHVybnMge3ZvaWR9ICovXG5leHBvcnQgZnVuY3Rpb24gc2V0X2lucHV0X3ZhbHVlKGlucHV0LCB2YWx1ZSkge1xuXHRpbnB1dC52YWx1ZSA9IHZhbHVlID09IG51bGwgPyAnJyA6IHZhbHVlO1xufVxuXG4vKipcbiAqIEByZXR1cm5zIHt2b2lkfSAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldF9pbnB1dF90eXBlKGlucHV0LCB0eXBlKSB7XG5cdHRyeSB7XG5cdFx0aW5wdXQudHlwZSA9IHR5cGU7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHQvLyBkbyBub3RoaW5nXG5cdH1cbn1cblxuLyoqXG4gKiBAcmV0dXJucyB7dm9pZH0gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRfc3R5bGUobm9kZSwga2V5LCB2YWx1ZSwgaW1wb3J0YW50KSB7XG5cdGlmICh2YWx1ZSA9PSBudWxsKSB7XG5cdFx0bm9kZS5zdHlsZS5yZW1vdmVQcm9wZXJ0eShrZXkpO1xuXHR9IGVsc2Uge1xuXHRcdG5vZGUuc3R5bGUuc2V0UHJvcGVydHkoa2V5LCB2YWx1ZSwgaW1wb3J0YW50ID8gJ2ltcG9ydGFudCcgOiAnJyk7XG5cdH1cbn1cblxuLyoqXG4gKiBAcmV0dXJucyB7dm9pZH0gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZWxlY3Rfb3B0aW9uKHNlbGVjdCwgdmFsdWUsIG1vdW50aW5nKSB7XG5cdGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0Lm9wdGlvbnMubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRjb25zdCBvcHRpb24gPSBzZWxlY3Qub3B0aW9uc1tpXTtcblx0XHRpZiAob3B0aW9uLl9fdmFsdWUgPT09IHZhbHVlKSB7XG5cdFx0XHRvcHRpb24uc2VsZWN0ZWQgPSB0cnVlO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0fVxuXHRpZiAoIW1vdW50aW5nIHx8IHZhbHVlICE9PSB1bmRlZmluZWQpIHtcblx0XHRzZWxlY3Quc2VsZWN0ZWRJbmRleCA9IC0xOyAvLyBubyBvcHRpb24gc2hvdWxkIGJlIHNlbGVjdGVkXG5cdH1cbn1cblxuLyoqXG4gKiBAcmV0dXJucyB7dm9pZH0gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZWxlY3Rfb3B0aW9ucyhzZWxlY3QsIHZhbHVlKSB7XG5cdGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0Lm9wdGlvbnMubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRjb25zdCBvcHRpb24gPSBzZWxlY3Qub3B0aW9uc1tpXTtcblx0XHRvcHRpb24uc2VsZWN0ZWQgPSB+dmFsdWUuaW5kZXhPZihvcHRpb24uX192YWx1ZSk7XG5cdH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNlbGVjdF92YWx1ZShzZWxlY3QpIHtcblx0Y29uc3Qgc2VsZWN0ZWRfb3B0aW9uID0gc2VsZWN0LnF1ZXJ5U2VsZWN0b3IoJzpjaGVja2VkJyk7XG5cdHJldHVybiBzZWxlY3RlZF9vcHRpb24gJiYgc2VsZWN0ZWRfb3B0aW9uLl9fdmFsdWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZWxlY3RfbXVsdGlwbGVfdmFsdWUoc2VsZWN0KSB7XG5cdHJldHVybiBbXS5tYXAuY2FsbChzZWxlY3QucXVlcnlTZWxlY3RvckFsbCgnOmNoZWNrZWQnKSwgKG9wdGlvbikgPT4gb3B0aW9uLl9fdmFsdWUpO1xufVxuLy8gdW5mb3J0dW5hdGVseSB0aGlzIGNhbid0IGJlIGEgY29uc3RhbnQgYXMgdGhhdCB3b3VsZG4ndCBiZSB0cmVlLXNoYWtlYWJsZVxuLy8gc28gd2UgY2FjaGUgdGhlIHJlc3VsdCBpbnN0ZWFkXG5cbi8qKlxuICogQHR5cGUge2Jvb2xlYW59ICovXG5sZXQgY3Jvc3NvcmlnaW47XG5cbi8qKlxuICogQHJldHVybnMge2Jvb2xlYW59ICovXG5leHBvcnQgZnVuY3Rpb24gaXNfY3Jvc3NvcmlnaW4oKSB7XG5cdGlmIChjcm9zc29yaWdpbiA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0Y3Jvc3NvcmlnaW4gPSBmYWxzZTtcblx0XHR0cnkge1xuXHRcdFx0aWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5wYXJlbnQpIHtcblx0XHRcdFx0dm9pZCB3aW5kb3cucGFyZW50LmRvY3VtZW50O1xuXHRcdFx0fVxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRjcm9zc29yaWdpbiA9IHRydWU7XG5cdFx0fVxuXHR9XG5cdHJldHVybiBjcm9zc29yaWdpbjtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBub2RlXG4gKiBAcGFyYW0geygpID0+IHZvaWR9IGZuXG4gKiBAcmV0dXJucyB7KCkgPT4gdm9pZH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFkZF9pZnJhbWVfcmVzaXplX2xpc3RlbmVyKG5vZGUsIGZuKSB7XG5cdGNvbnN0IGNvbXB1dGVkX3N0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShub2RlKTtcblx0aWYgKGNvbXB1dGVkX3N0eWxlLnBvc2l0aW9uID09PSAnc3RhdGljJykge1xuXHRcdG5vZGUuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xuXHR9XG5cdGNvbnN0IGlmcmFtZSA9IGVsZW1lbnQoJ2lmcmFtZScpO1xuXHRpZnJhbWUuc2V0QXR0cmlidXRlKFxuXHRcdCdzdHlsZScsXG5cdFx0J2Rpc3BsYXk6IGJsb2NrOyBwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgJyArXG5cdFx0XHQnb3ZlcmZsb3c6IGhpZGRlbjsgYm9yZGVyOiAwOyBvcGFjaXR5OiAwOyBwb2ludGVyLWV2ZW50czogbm9uZTsgei1pbmRleDogLTE7J1xuXHQpO1xuXHRpZnJhbWUuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG5cdGlmcmFtZS50YWJJbmRleCA9IC0xO1xuXHRjb25zdCBjcm9zc29yaWdpbiA9IGlzX2Nyb3Nzb3JpZ2luKCk7XG5cblx0LyoqXG5cdCAqIEB0eXBlIHsoKSA9PiB2b2lkfVxuXHQgKi9cblx0bGV0IHVuc3Vic2NyaWJlO1xuXHRpZiAoY3Jvc3NvcmlnaW4pIHtcblx0XHRpZnJhbWUuc3JjID0gXCJkYXRhOnRleHQvaHRtbCw8c2NyaXB0Pm9ucmVzaXplPWZ1bmN0aW9uKCl7cGFyZW50LnBvc3RNZXNzYWdlKDAsJyonKX08L3NjcmlwdD5cIjtcblx0XHR1bnN1YnNjcmliZSA9IGxpc3Rlbihcblx0XHRcdHdpbmRvdyxcblx0XHRcdCdtZXNzYWdlJyxcblx0XHRcdC8qKiBAcGFyYW0ge01lc3NhZ2VFdmVudH0gZXZlbnQgKi8gKGV2ZW50KSA9PiB7XG5cdFx0XHRcdGlmIChldmVudC5zb3VyY2UgPT09IGlmcmFtZS5jb250ZW50V2luZG93KSBmbigpO1xuXHRcdFx0fVxuXHRcdCk7XG5cdH0gZWxzZSB7XG5cdFx0aWZyYW1lLnNyYyA9ICdhYm91dDpibGFuayc7XG5cdFx0aWZyYW1lLm9ubG9hZCA9ICgpID0+IHtcblx0XHRcdHVuc3Vic2NyaWJlID0gbGlzdGVuKGlmcmFtZS5jb250ZW50V2luZG93LCAncmVzaXplJywgZm4pO1xuXHRcdFx0Ly8gbWFrZSBzdXJlIGFuIGluaXRpYWwgcmVzaXplIGV2ZW50IGlzIGZpcmVkIF9hZnRlcl8gdGhlIGlmcmFtZSBpcyBsb2FkZWQgKHdoaWNoIGlzIGFzeW5jaHJvbm91cylcblx0XHRcdC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vc3ZlbHRlanMvc3ZlbHRlL2lzc3Vlcy80MjMzXG5cdFx0XHRmbigpO1xuXHRcdH07XG5cdH1cblx0YXBwZW5kKG5vZGUsIGlmcmFtZSk7XG5cdHJldHVybiAoKSA9PiB7XG5cdFx0aWYgKGNyb3Nzb3JpZ2luKSB7XG5cdFx0XHR1bnN1YnNjcmliZSgpO1xuXHRcdH0gZWxzZSBpZiAodW5zdWJzY3JpYmUgJiYgaWZyYW1lLmNvbnRlbnRXaW5kb3cpIHtcblx0XHRcdHVuc3Vic2NyaWJlKCk7XG5cdFx0fVxuXHRcdGRldGFjaChpZnJhbWUpO1xuXHR9O1xufVxuZXhwb3J0IGNvbnN0IHJlc2l6ZV9vYnNlcnZlcl9jb250ZW50X2JveCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgUmVzaXplT2JzZXJ2ZXJTaW5nbGV0b24oe1xuXHRib3g6ICdjb250ZW50LWJveCdcbn0pO1xuZXhwb3J0IGNvbnN0IHJlc2l6ZV9vYnNlcnZlcl9ib3JkZXJfYm94ID0gLyogQF9fUFVSRV9fICovIG5ldyBSZXNpemVPYnNlcnZlclNpbmdsZXRvbih7XG5cdGJveDogJ2JvcmRlci1ib3gnXG59KTtcbmV4cG9ydCBjb25zdCByZXNpemVfb2JzZXJ2ZXJfZGV2aWNlX3BpeGVsX2NvbnRlbnRfYm94ID0gLyogQF9fUFVSRV9fICovIG5ldyBSZXNpemVPYnNlcnZlclNpbmdsZXRvbihcblx0eyBib3g6ICdkZXZpY2UtcGl4ZWwtY29udGVudC1ib3gnIH1cbik7XG5leHBvcnQgeyBSZXNpemVPYnNlcnZlclNpbmdsZXRvbiB9O1xuXG4vKipcbiAqIEByZXR1cm5zIHt2b2lkfSAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvZ2dsZV9jbGFzcyhlbGVtZW50LCBuYW1lLCB0b2dnbGUpIHtcblx0Ly8gVGhlIGAhIWAgaXMgcmVxdWlyZWQgYmVjYXVzZSBhbiBgdW5kZWZpbmVkYCBmbGFnIG1lYW5zIGZsaXBwaW5nIHRoZSBjdXJyZW50IHN0YXRlLlxuXHRlbGVtZW50LmNsYXNzTGlzdC50b2dnbGUobmFtZSwgISF0b2dnbGUpO1xufVxuXG4vKipcbiAqIEB0ZW1wbGF0ZSBUXG4gKiBAcGFyYW0ge3N0cmluZ30gdHlwZVxuICogQHBhcmFtIHtUfSBbZGV0YWlsXVxuICogQHBhcmFtIHt7IGJ1YmJsZXM/OiBib29sZWFuLCBjYW5jZWxhYmxlPzogYm9vbGVhbiB9fSBbb3B0aW9uc11cbiAqIEByZXR1cm5zIHtDdXN0b21FdmVudDxUPn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGN1c3RvbV9ldmVudCh0eXBlLCBkZXRhaWwsIHsgYnViYmxlcyA9IGZhbHNlLCBjYW5jZWxhYmxlID0gZmFsc2UgfSA9IHt9KSB7XG5cdHJldHVybiBuZXcgQ3VzdG9tRXZlbnQodHlwZSwgeyBkZXRhaWwsIGJ1YmJsZXMsIGNhbmNlbGFibGUgfSk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBwYXJlbnRcbiAqIEByZXR1cm5zIHtDaGlsZE5vZGVBcnJheX1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHF1ZXJ5X3NlbGVjdG9yX2FsbChzZWxlY3RvciwgcGFyZW50ID0gZG9jdW1lbnQuYm9keSkge1xuXHRyZXR1cm4gQXJyYXkuZnJvbShwYXJlbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBub2RlSWRcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGhlYWRcbiAqIEByZXR1cm5zIHthbnlbXX1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhlYWRfc2VsZWN0b3Iobm9kZUlkLCBoZWFkKSB7XG5cdGNvbnN0IHJlc3VsdCA9IFtdO1xuXHRsZXQgc3RhcnRlZCA9IDA7XG5cdGZvciAoY29uc3Qgbm9kZSBvZiBoZWFkLmNoaWxkTm9kZXMpIHtcblx0XHRpZiAobm9kZS5ub2RlVHlwZSA9PT0gOCAvKiBjb21tZW50IG5vZGUgKi8pIHtcblx0XHRcdGNvbnN0IGNvbW1lbnQgPSBub2RlLnRleHRDb250ZW50LnRyaW0oKTtcblx0XHRcdGlmIChjb21tZW50ID09PSBgSEVBRF8ke25vZGVJZH1fRU5EYCkge1xuXHRcdFx0XHRzdGFydGVkIC09IDE7XG5cdFx0XHRcdHJlc3VsdC5wdXNoKG5vZGUpO1xuXHRcdFx0fSBlbHNlIGlmIChjb21tZW50ID09PSBgSEVBRF8ke25vZGVJZH1fU1RBUlRgKSB7XG5cdFx0XHRcdHN0YXJ0ZWQgKz0gMTtcblx0XHRcdFx0cmVzdWx0LnB1c2gobm9kZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIGlmIChzdGFydGVkID4gMCkge1xuXHRcdFx0cmVzdWx0LnB1c2gobm9kZSk7XG5cdFx0fVxuXHR9XG5cdHJldHVybiByZXN1bHQ7XG59XG4vKiogKi9cbmV4cG9ydCBjbGFzcyBIdG1sVGFnIHtcblx0LyoqXG5cdCAqIEBwcml2YXRlXG5cdCAqIEBkZWZhdWx0IGZhbHNlXG5cdCAqL1xuXHRpc19zdmcgPSBmYWxzZTtcblx0LyoqIHBhcmVudCBmb3IgY3JlYXRpbmcgbm9kZSAqL1xuXHRlID0gdW5kZWZpbmVkO1xuXHQvKiogaHRtbCB0YWcgbm9kZXMgKi9cblx0biA9IHVuZGVmaW5lZDtcblx0LyoqIHRhcmdldCAqL1xuXHR0ID0gdW5kZWZpbmVkO1xuXHQvKiogYW5jaG9yICovXG5cdGEgPSB1bmRlZmluZWQ7XG5cdGNvbnN0cnVjdG9yKGlzX3N2ZyA9IGZhbHNlKSB7XG5cdFx0dGhpcy5pc19zdmcgPSBpc19zdmc7XG5cdFx0dGhpcy5lID0gdGhpcy5uID0gbnVsbDtcblx0fVxuXG5cdC8qKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaHRtbFxuXHQgKiBAcmV0dXJucyB7dm9pZH1cblx0ICovXG5cdGMoaHRtbCkge1xuXHRcdHRoaXMuaChodG1sKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaHRtbFxuXHQgKiBAcGFyYW0ge0hUTUxFbGVtZW50IHwgU1ZHRWxlbWVudH0gdGFyZ2V0XG5cdCAqIEBwYXJhbSB7SFRNTEVsZW1lbnQgfCBTVkdFbGVtZW50fSBhbmNob3Jcblx0ICogQHJldHVybnMge3ZvaWR9XG5cdCAqL1xuXHRtKGh0bWwsIHRhcmdldCwgYW5jaG9yID0gbnVsbCkge1xuXHRcdGlmICghdGhpcy5lKSB7XG5cdFx0XHRpZiAodGhpcy5pc19zdmcpXG5cdFx0XHRcdHRoaXMuZSA9IHN2Z19lbGVtZW50KC8qKiBAdHlwZSB7a2V5b2YgU1ZHRWxlbWVudFRhZ05hbWVNYXB9ICovICh0YXJnZXQubm9kZU5hbWUpKTtcblx0XHRcdC8qKiAjNzM2NCAgdGFyZ2V0IGZvciA8dGVtcGxhdGU+IG1heSBiZSBwcm92aWRlZCBhcyAjZG9jdW1lbnQtZnJhZ21lbnQoMTEpICovIGVsc2Vcblx0XHRcdFx0dGhpcy5lID0gZWxlbWVudChcblx0XHRcdFx0XHQvKiogQHR5cGUge2tleW9mIEhUTUxFbGVtZW50VGFnTmFtZU1hcH0gKi8gKFxuXHRcdFx0XHRcdFx0dGFyZ2V0Lm5vZGVUeXBlID09PSAxMSA/ICdURU1QTEFURScgOiB0YXJnZXQubm9kZU5hbWVcblx0XHRcdFx0XHQpXG5cdFx0XHRcdCk7XG5cdFx0XHR0aGlzLnQgPVxuXHRcdFx0XHR0YXJnZXQudGFnTmFtZSAhPT0gJ1RFTVBMQVRFJ1xuXHRcdFx0XHRcdD8gdGFyZ2V0XG5cdFx0XHRcdFx0OiAvKiogQHR5cGUge0hUTUxUZW1wbGF0ZUVsZW1lbnR9ICovICh0YXJnZXQpLmNvbnRlbnQ7XG5cdFx0XHR0aGlzLmMoaHRtbCk7XG5cdFx0fVxuXHRcdHRoaXMuaShhbmNob3IpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBodG1sXG5cdCAqIEByZXR1cm5zIHt2b2lkfVxuXHQgKi9cblx0aChodG1sKSB7XG5cdFx0dGhpcy5lLmlubmVySFRNTCA9IGh0bWw7XG5cdFx0dGhpcy5uID0gQXJyYXkuZnJvbShcblx0XHRcdHRoaXMuZS5ub2RlTmFtZSA9PT0gJ1RFTVBMQVRFJyA/IHRoaXMuZS5jb250ZW50LmNoaWxkTm9kZXMgOiB0aGlzLmUuY2hpbGROb2Rlc1xuXHRcdCk7XG5cdH1cblxuXHQvKipcblx0ICogQHJldHVybnMge3ZvaWR9ICovXG5cdGkoYW5jaG9yKSB7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm4ubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdGluc2VydCh0aGlzLnQsIHRoaXMubltpXSwgYW5jaG9yKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQHBhcmFtIHtzdHJpbmd9IGh0bWxcblx0ICogQHJldHVybnMge3ZvaWR9XG5cdCAqL1xuXHRwKGh0bWwpIHtcblx0XHR0aGlzLmQoKTtcblx0XHR0aGlzLmgoaHRtbCk7XG5cdFx0dGhpcy5pKHRoaXMuYSk7XG5cdH1cblxuXHQvKipcblx0ICogQHJldHVybnMge3ZvaWR9ICovXG5cdGQoKSB7XG5cdFx0dGhpcy5uLmZvckVhY2goZGV0YWNoKTtcblx0fVxufVxuXG5leHBvcnQgY2xhc3MgSHRtbFRhZ0h5ZHJhdGlvbiBleHRlbmRzIEh0bWxUYWcge1xuXHQvKiogQHR5cGUge0VsZW1lbnRbXX0gaHlkcmF0aW9uIGNsYWltZWQgbm9kZXMgKi9cblx0bCA9IHVuZGVmaW5lZDtcblxuXHRjb25zdHJ1Y3Rvcihpc19zdmcgPSBmYWxzZSwgY2xhaW1lZF9ub2Rlcykge1xuXHRcdHN1cGVyKGlzX3N2Zyk7XG5cdFx0dGhpcy5lID0gdGhpcy5uID0gbnVsbDtcblx0XHR0aGlzLmwgPSBjbGFpbWVkX25vZGVzO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBodG1sXG5cdCAqIEByZXR1cm5zIHt2b2lkfVxuXHQgKi9cblx0YyhodG1sKSB7XG5cdFx0aWYgKHRoaXMubCkge1xuXHRcdFx0dGhpcy5uID0gdGhpcy5sO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzdXBlci5jKGh0bWwpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBAcmV0dXJucyB7dm9pZH0gKi9cblx0aShhbmNob3IpIHtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubi5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdFx0aW5zZXJ0X2h5ZHJhdGlvbih0aGlzLnQsIHRoaXMubltpXSwgYW5jaG9yKTtcblx0XHR9XG5cdH1cbn1cblxuLyoqXG4gKiBAcGFyYW0ge05hbWVkTm9kZU1hcH0gYXR0cmlidXRlc1xuICogQHJldHVybnMge3t9fVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXR0cmlidXRlX3RvX29iamVjdChhdHRyaWJ1dGVzKSB7XG5cdGNvbnN0IHJlc3VsdCA9IHt9O1xuXHRmb3IgKGNvbnN0IGF0dHJpYnV0ZSBvZiBhdHRyaWJ1dGVzKSB7XG5cdFx0cmVzdWx0W2F0dHJpYnV0ZS5uYW1lXSA9IGF0dHJpYnV0ZS52YWx1ZTtcblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufVxuXG5jb25zdCBlc2NhcGVkID0ge1xuXHQnXCInOiAnJnF1b3Q7Jyxcblx0JyYnOiAnJmFtcDsnLFxuXHQnPCc6ICcmbHQ7J1xufTtcblxuY29uc3QgcmVnZXhfYXR0cmlidXRlX2NoYXJhY3RlcnNfdG9fZXNjYXBlID0gL1tcIiY8XS9nO1xuXG4vKipcbiAqIE5vdGUgdGhhdCB0aGUgYXR0cmlidXRlIGl0c2VsZiBzaG91bGQgYmUgc3Vycm91bmRlZCBpbiBkb3VibGUgcXVvdGVzXG4gKiBAcGFyYW0ge2FueX0gYXR0cmlidXRlXG4gKi9cbmZ1bmN0aW9uIGVzY2FwZV9hdHRyaWJ1dGUoYXR0cmlidXRlKSB7XG5cdHJldHVybiBTdHJpbmcoYXR0cmlidXRlKS5yZXBsYWNlKHJlZ2V4X2F0dHJpYnV0ZV9jaGFyYWN0ZXJzX3RvX2VzY2FwZSwgKG1hdGNoKSA9PiBlc2NhcGVkW21hdGNoXSk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+fSBhdHRyaWJ1dGVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdHJpbmdpZnlfc3ByZWFkKGF0dHJpYnV0ZXMpIHtcblx0bGV0IHN0ciA9ICcgJztcblx0Zm9yIChjb25zdCBrZXkgaW4gYXR0cmlidXRlcykge1xuXHRcdGlmIChhdHRyaWJ1dGVzW2tleV0gIT0gbnVsbCkge1xuXHRcdFx0c3RyICs9IGAke2tleX09XCIke2VzY2FwZV9hdHRyaWJ1dGUoYXR0cmlidXRlc1trZXldKX1cIiBgO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiBzdHI7XG59XG5cbi8qKlxuICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudFxuICogQHJldHVybnMge3t9fVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0X2N1c3RvbV9lbGVtZW50c19zbG90cyhlbGVtZW50KSB7XG5cdGNvbnN0IHJlc3VsdCA9IHt9O1xuXHRlbGVtZW50LmNoaWxkTm9kZXMuZm9yRWFjaChcblx0XHQvKiogQHBhcmFtIHtFbGVtZW50fSBub2RlICovIChub2RlKSA9PiB7XG5cdFx0XHRyZXN1bHRbbm9kZS5zbG90IHx8ICdkZWZhdWx0J10gPSB0cnVlO1xuXHRcdH1cblx0KTtcblx0cmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbnN0cnVjdF9zdmVsdGVfY29tcG9uZW50KGNvbXBvbmVudCwgcHJvcHMpIHtcblx0cmV0dXJuIG5ldyBjb21wb25lbnQocHJvcHMpO1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtOb2RlICYge1xuICogXHRjbGFpbV9vcmRlcj86IG51bWJlcjtcbiAqIFx0aHlkcmF0ZV9pbml0PzogdHJ1ZTtcbiAqIFx0YWN0dWFsX2VuZF9jaGlsZD86IE5vZGVFeDtcbiAqIFx0Y2hpbGROb2RlczogTm9kZUxpc3RPZjxOb2RlRXg+O1xuICogfX0gTm9kZUV4XG4gKi9cblxuLyoqIEB0eXBlZGVmIHtDaGlsZE5vZGUgJiBOb2RlRXh9IENoaWxkTm9kZUV4ICovXG5cbi8qKiBAdHlwZWRlZiB7Tm9kZUV4ICYgeyBjbGFpbV9vcmRlcjogbnVtYmVyIH19IE5vZGVFeDIgKi9cblxuLyoqXG4gKiBAdHlwZWRlZiB7Q2hpbGROb2RlRXhbXSAmIHtcbiAqIFx0Y2xhaW1faW5mbz86IHtcbiAqIFx0XHRsYXN0X2luZGV4OiBudW1iZXI7XG4gKiBcdFx0dG90YWxfY2xhaW1lZDogbnVtYmVyO1xuICogXHR9O1xuICogfX0gQ2hpbGROb2RlQXJyYXlcbiAqL1xuIiwgImNvbnN0IF9ib29sZWFuX2F0dHJpYnV0ZXMgPSAvKiogQHR5cGUge2NvbnN0fSAqLyAoW1xuXHQnYWxsb3dmdWxsc2NyZWVuJyxcblx0J2FsbG93cGF5bWVudHJlcXVlc3QnLFxuXHQnYXN5bmMnLFxuXHQnYXV0b2ZvY3VzJyxcblx0J2F1dG9wbGF5Jyxcblx0J2NoZWNrZWQnLFxuXHQnY29udHJvbHMnLFxuXHQnZGVmYXVsdCcsXG5cdCdkZWZlcicsXG5cdCdkaXNhYmxlZCcsXG5cdCdmb3Jtbm92YWxpZGF0ZScsXG5cdCdoaWRkZW4nLFxuXHQnaW5lcnQnLFxuXHQnaXNtYXAnLFxuXHQnbG9vcCcsXG5cdCdtdWx0aXBsZScsXG5cdCdtdXRlZCcsXG5cdCdub21vZHVsZScsXG5cdCdub3ZhbGlkYXRlJyxcblx0J29wZW4nLFxuXHQncGxheXNpbmxpbmUnLFxuXHQncmVhZG9ubHknLFxuXHQncmVxdWlyZWQnLFxuXHQncmV2ZXJzZWQnLFxuXHQnc2VsZWN0ZWQnXG5dKTtcblxuLyoqXG4gKiBMaXN0IG9mIEhUTUwgYm9vbGVhbiBhdHRyaWJ1dGVzIChlLmcuIGA8aW5wdXQgZGlzYWJsZWQ+YCkuXG4gKiBTb3VyY2U6IGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2luZGljZXMuaHRtbFxuICpcbiAqIEB0eXBlIHtTZXQ8c3RyaW5nPn1cbiAqL1xuZXhwb3J0IGNvbnN0IGJvb2xlYW5fYXR0cmlidXRlcyA9IG5ldyBTZXQoWy4uLl9ib29sZWFuX2F0dHJpYnV0ZXNdKTtcblxuLyoqIEB0eXBlZGVmIHt0eXBlb2YgX2Jvb2xlYW5fYXR0cmlidXRlc1tudW1iZXJdfSBCb29sZWFuQXR0cmlidXRlcyAqL1xuIiwgImltcG9ydCB7XG5cdGFkZF9yZW5kZXJfY2FsbGJhY2ssXG5cdGZsdXNoLFxuXHRmbHVzaF9yZW5kZXJfY2FsbGJhY2tzLFxuXHRzY2hlZHVsZV91cGRhdGUsXG5cdGRpcnR5X2NvbXBvbmVudHNcbn0gZnJvbSAnLi9zY2hlZHVsZXIuanMnO1xuaW1wb3J0IHsgY3VycmVudF9jb21wb25lbnQsIHNldF9jdXJyZW50X2NvbXBvbmVudCB9IGZyb20gJy4vbGlmZWN5Y2xlLmpzJztcbmltcG9ydCB7IGJsYW5rX29iamVjdCwgaXNfZW1wdHksIGlzX2Z1bmN0aW9uLCBydW4sIHJ1bl9hbGwsIG5vb3AgfSBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB7XG5cdGNoaWxkcmVuLFxuXHRkZXRhY2gsXG5cdHN0YXJ0X2h5ZHJhdGluZyxcblx0ZW5kX2h5ZHJhdGluZyxcblx0Z2V0X2N1c3RvbV9lbGVtZW50c19zbG90cyxcblx0aW5zZXJ0LFxuXHRlbGVtZW50LFxuXHRhdHRyXG59IGZyb20gJy4vZG9tLmpzJztcbmltcG9ydCB7IHRyYW5zaXRpb25faW4gfSBmcm9tICcuL3RyYW5zaXRpb25zLmpzJztcblxuLyoqIEByZXR1cm5zIHt2b2lkfSAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJpbmQoY29tcG9uZW50LCBuYW1lLCBjYWxsYmFjaykge1xuXHRjb25zdCBpbmRleCA9IGNvbXBvbmVudC4kJC5wcm9wc1tuYW1lXTtcblx0aWYgKGluZGV4ICE9PSB1bmRlZmluZWQpIHtcblx0XHRjb21wb25lbnQuJCQuYm91bmRbaW5kZXhdID0gY2FsbGJhY2s7XG5cdFx0Y2FsbGJhY2soY29tcG9uZW50LiQkLmN0eFtpbmRleF0pO1xuXHR9XG59XG5cbi8qKiBAcmV0dXJucyB7dm9pZH0gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVfY29tcG9uZW50KGJsb2NrKSB7XG5cdGJsb2NrICYmIGJsb2NrLmMoKTtcbn1cblxuLyoqIEByZXR1cm5zIHt2b2lkfSAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsYWltX2NvbXBvbmVudChibG9jaywgcGFyZW50X25vZGVzKSB7XG5cdGJsb2NrICYmIGJsb2NrLmwocGFyZW50X25vZGVzKTtcbn1cblxuLyoqIEByZXR1cm5zIHt2b2lkfSAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1vdW50X2NvbXBvbmVudChjb21wb25lbnQsIHRhcmdldCwgYW5jaG9yKSB7XG5cdGNvbnN0IHsgZnJhZ21lbnQsIGFmdGVyX3VwZGF0ZSB9ID0gY29tcG9uZW50LiQkO1xuXHRmcmFnbWVudCAmJiBmcmFnbWVudC5tKHRhcmdldCwgYW5jaG9yKTtcblx0Ly8gb25Nb3VudCBoYXBwZW5zIGJlZm9yZSB0aGUgaW5pdGlhbCBhZnRlclVwZGF0ZVxuXHRhZGRfcmVuZGVyX2NhbGxiYWNrKCgpID0+IHtcblx0XHRjb25zdCBuZXdfb25fZGVzdHJveSA9IGNvbXBvbmVudC4kJC5vbl9tb3VudC5tYXAocnVuKS5maWx0ZXIoaXNfZnVuY3Rpb24pO1xuXHRcdC8vIGlmIHRoZSBjb21wb25lbnQgd2FzIGRlc3Ryb3llZCBpbW1lZGlhdGVseVxuXHRcdC8vIGl0IHdpbGwgdXBkYXRlIHRoZSBgJCQub25fZGVzdHJveWAgcmVmZXJlbmNlIHRvIGBudWxsYC5cblx0XHQvLyB0aGUgZGVzdHJ1Y3R1cmVkIG9uX2Rlc3Ryb3kgbWF5IHN0aWxsIHJlZmVyZW5jZSB0byB0aGUgb2xkIGFycmF5XG5cdFx0aWYgKGNvbXBvbmVudC4kJC5vbl9kZXN0cm95KSB7XG5cdFx0XHRjb21wb25lbnQuJCQub25fZGVzdHJveS5wdXNoKC4uLm5ld19vbl9kZXN0cm95KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gRWRnZSBjYXNlIC0gY29tcG9uZW50IHdhcyBkZXN0cm95ZWQgaW1tZWRpYXRlbHksXG5cdFx0XHQvLyBtb3N0IGxpa2VseSBhcyBhIHJlc3VsdCBvZiBhIGJpbmRpbmcgaW5pdGlhbGlzaW5nXG5cdFx0XHRydW5fYWxsKG5ld19vbl9kZXN0cm95KTtcblx0XHR9XG5cdFx0Y29tcG9uZW50LiQkLm9uX21vdW50ID0gW107XG5cdH0pO1xuXHRhZnRlcl91cGRhdGUuZm9yRWFjaChhZGRfcmVuZGVyX2NhbGxiYWNrKTtcbn1cblxuLyoqIEByZXR1cm5zIHt2b2lkfSAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlc3Ryb3lfY29tcG9uZW50KGNvbXBvbmVudCwgZGV0YWNoaW5nKSB7XG5cdGNvbnN0ICQkID0gY29tcG9uZW50LiQkO1xuXHRpZiAoJCQuZnJhZ21lbnQgIT09IG51bGwpIHtcblx0XHRmbHVzaF9yZW5kZXJfY2FsbGJhY2tzKCQkLmFmdGVyX3VwZGF0ZSk7XG5cdFx0cnVuX2FsbCgkJC5vbl9kZXN0cm95KTtcblx0XHQkJC5mcmFnbWVudCAmJiAkJC5mcmFnbWVudC5kKGRldGFjaGluZyk7XG5cdFx0Ly8gVE9ETyBudWxsIG91dCBvdGhlciByZWZzLCBpbmNsdWRpbmcgY29tcG9uZW50LiQkIChidXQgbmVlZCB0b1xuXHRcdC8vIHByZXNlcnZlIGZpbmFsIHN0YXRlPylcblx0XHQkJC5vbl9kZXN0cm95ID0gJCQuZnJhZ21lbnQgPSBudWxsO1xuXHRcdCQkLmN0eCA9IFtdO1xuXHR9XG59XG5cbi8qKiBAcmV0dXJucyB7dm9pZH0gKi9cbmZ1bmN0aW9uIG1ha2VfZGlydHkoY29tcG9uZW50LCBpKSB7XG5cdGlmIChjb21wb25lbnQuJCQuZGlydHlbMF0gPT09IC0xKSB7XG5cdFx0ZGlydHlfY29tcG9uZW50cy5wdXNoKGNvbXBvbmVudCk7XG5cdFx0c2NoZWR1bGVfdXBkYXRlKCk7XG5cdFx0Y29tcG9uZW50LiQkLmRpcnR5LmZpbGwoMCk7XG5cdH1cblx0Y29tcG9uZW50LiQkLmRpcnR5WyhpIC8gMzEpIHwgMF0gfD0gMSA8PCBpICUgMzE7XG59XG5cbi8vIFRPRE86IERvY3VtZW50IHRoZSBvdGhlciBwYXJhbXNcbi8qKlxuICogQHBhcmFtIHtTdmVsdGVDb21wb25lbnR9IGNvbXBvbmVudFxuICogQHBhcmFtIHtpbXBvcnQoJy4vcHVibGljLmpzJykuQ29tcG9uZW50Q29uc3RydWN0b3JPcHRpb25zfSBvcHRpb25zXG4gKlxuICogQHBhcmFtIHtpbXBvcnQoJy4vdXRpbHMuanMnKVsnbm90X2VxdWFsJ119IG5vdF9lcXVhbCBVc2VkIHRvIGNvbXBhcmUgcHJvcHMgYW5kIHN0YXRlIHZhbHVlcy5cbiAqIEBwYXJhbSB7KHRhcmdldDogRWxlbWVudCB8IFNoYWRvd1Jvb3QpID0+IHZvaWR9IFthcHBlbmRfc3R5bGVzXSBGdW5jdGlvbiB0aGF0IGFwcGVuZHMgc3R5bGVzIHRvIHRoZSBET00gd2hlbiB0aGUgY29tcG9uZW50IGlzIGZpcnN0IGluaXRpYWxpc2VkLlxuICogVGhpcyB3aWxsIGJlIHRoZSBgYWRkX2Nzc2AgZnVuY3Rpb24gZnJvbSB0aGUgY29tcGlsZWQgY29tcG9uZW50LlxuICpcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5pdChcblx0Y29tcG9uZW50LFxuXHRvcHRpb25zLFxuXHRpbnN0YW5jZSxcblx0Y3JlYXRlX2ZyYWdtZW50LFxuXHRub3RfZXF1YWwsXG5cdHByb3BzLFxuXHRhcHBlbmRfc3R5bGVzID0gbnVsbCxcblx0ZGlydHkgPSBbLTFdXG4pIHtcblx0Y29uc3QgcGFyZW50X2NvbXBvbmVudCA9IGN1cnJlbnRfY29tcG9uZW50O1xuXHRzZXRfY3VycmVudF9jb21wb25lbnQoY29tcG9uZW50KTtcblx0LyoqIEB0eXBlIHtpbXBvcnQoJy4vcHJpdmF0ZS5qcycpLlQkJH0gKi9cblx0Y29uc3QgJCQgPSAoY29tcG9uZW50LiQkID0ge1xuXHRcdGZyYWdtZW50OiBudWxsLFxuXHRcdGN0eDogW10sXG5cdFx0Ly8gc3RhdGVcblx0XHRwcm9wcyxcblx0XHR1cGRhdGU6IG5vb3AsXG5cdFx0bm90X2VxdWFsLFxuXHRcdGJvdW5kOiBibGFua19vYmplY3QoKSxcblx0XHQvLyBsaWZlY3ljbGVcblx0XHRvbl9tb3VudDogW10sXG5cdFx0b25fZGVzdHJveTogW10sXG5cdFx0b25fZGlzY29ubmVjdDogW10sXG5cdFx0YmVmb3JlX3VwZGF0ZTogW10sXG5cdFx0YWZ0ZXJfdXBkYXRlOiBbXSxcblx0XHRjb250ZXh0OiBuZXcgTWFwKG9wdGlvbnMuY29udGV4dCB8fCAocGFyZW50X2NvbXBvbmVudCA/IHBhcmVudF9jb21wb25lbnQuJCQuY29udGV4dCA6IFtdKSksXG5cdFx0Ly8gZXZlcnl0aGluZyBlbHNlXG5cdFx0Y2FsbGJhY2tzOiBibGFua19vYmplY3QoKSxcblx0XHRkaXJ0eSxcblx0XHRza2lwX2JvdW5kOiBmYWxzZSxcblx0XHRyb290OiBvcHRpb25zLnRhcmdldCB8fCBwYXJlbnRfY29tcG9uZW50LiQkLnJvb3Rcblx0fSk7XG5cdGFwcGVuZF9zdHlsZXMgJiYgYXBwZW5kX3N0eWxlcygkJC5yb290KTtcblx0bGV0IHJlYWR5ID0gZmFsc2U7XG5cdCQkLmN0eCA9IGluc3RhbmNlXG5cdFx0PyBpbnN0YW5jZShjb21wb25lbnQsIG9wdGlvbnMucHJvcHMgfHwge30sIChpLCByZXQsIC4uLnJlc3QpID0+IHtcblx0XHRcdFx0Y29uc3QgdmFsdWUgPSByZXN0Lmxlbmd0aCA/IHJlc3RbMF0gOiByZXQ7XG5cdFx0XHRcdGlmICgkJC5jdHggJiYgbm90X2VxdWFsKCQkLmN0eFtpXSwgKCQkLmN0eFtpXSA9IHZhbHVlKSkpIHtcblx0XHRcdFx0XHRpZiAoISQkLnNraXBfYm91bmQgJiYgJCQuYm91bmRbaV0pICQkLmJvdW5kW2ldKHZhbHVlKTtcblx0XHRcdFx0XHRpZiAocmVhZHkpIG1ha2VfZGlydHkoY29tcG9uZW50LCBpKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gcmV0O1xuXHRcdCAgfSlcblx0XHQ6IFtdO1xuXHQkJC51cGRhdGUoKTtcblx0cmVhZHkgPSB0cnVlO1xuXHRydW5fYWxsKCQkLmJlZm9yZV91cGRhdGUpO1xuXHQvLyBgZmFsc2VgIGFzIGEgc3BlY2lhbCBjYXNlIG9mIG5vIERPTSBjb21wb25lbnRcblx0JCQuZnJhZ21lbnQgPSBjcmVhdGVfZnJhZ21lbnQgPyBjcmVhdGVfZnJhZ21lbnQoJCQuY3R4KSA6IGZhbHNlO1xuXHRpZiAob3B0aW9ucy50YXJnZXQpIHtcblx0XHRpZiAob3B0aW9ucy5oeWRyYXRlKSB7XG5cdFx0XHRzdGFydF9oeWRyYXRpbmcoKTtcblx0XHRcdC8vIFRPRE86IHdoYXQgaXMgdGhlIGNvcnJlY3QgdHlwZSBoZXJlP1xuXHRcdFx0Ly8gQHRzLWV4cGVjdC1lcnJvclxuXHRcdFx0Y29uc3Qgbm9kZXMgPSBjaGlsZHJlbihvcHRpb25zLnRhcmdldCk7XG5cdFx0XHQkJC5mcmFnbWVudCAmJiAkJC5mcmFnbWVudC5sKG5vZGVzKTtcblx0XHRcdG5vZGVzLmZvckVhY2goZGV0YWNoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cblx0XHRcdCQkLmZyYWdtZW50ICYmICQkLmZyYWdtZW50LmMoKTtcblx0XHR9XG5cdFx0aWYgKG9wdGlvbnMuaW50cm8pIHRyYW5zaXRpb25faW4oY29tcG9uZW50LiQkLmZyYWdtZW50KTtcblx0XHRtb3VudF9jb21wb25lbnQoY29tcG9uZW50LCBvcHRpb25zLnRhcmdldCwgb3B0aW9ucy5hbmNob3IpO1xuXHRcdGVuZF9oeWRyYXRpbmcoKTtcblx0XHRmbHVzaCgpO1xuXHR9XG5cdHNldF9jdXJyZW50X2NvbXBvbmVudChwYXJlbnRfY29tcG9uZW50KTtcbn1cblxuZXhwb3J0IGxldCBTdmVsdGVFbGVtZW50O1xuXG5pZiAodHlwZW9mIEhUTUxFbGVtZW50ID09PSAnZnVuY3Rpb24nKSB7XG5cdFN2ZWx0ZUVsZW1lbnQgPSBjbGFzcyBleHRlbmRzIEhUTUxFbGVtZW50IHtcblx0XHQvKiogVGhlIFN2ZWx0ZSBjb21wb25lbnQgY29uc3RydWN0b3IgKi9cblx0XHQkJGN0b3I7XG5cdFx0LyoqIFNsb3RzICovXG5cdFx0JCRzO1xuXHRcdC8qKiBUaGUgU3ZlbHRlIGNvbXBvbmVudCBpbnN0YW5jZSAqL1xuXHRcdCQkYztcblx0XHQvKiogV2hldGhlciBvciBub3QgdGhlIGN1c3RvbSBlbGVtZW50IGlzIGNvbm5lY3RlZCAqL1xuXHRcdCQkY24gPSBmYWxzZTtcblx0XHQvKiogQ29tcG9uZW50IHByb3BzIGRhdGEgKi9cblx0XHQkJGQgPSB7fTtcblx0XHQvKiogYHRydWVgIGlmIGN1cnJlbnRseSBpbiB0aGUgcHJvY2VzcyBvZiByZWZsZWN0aW5nIGNvbXBvbmVudCBwcm9wcyBiYWNrIHRvIGF0dHJpYnV0ZXMgKi9cblx0XHQkJHIgPSBmYWxzZTtcblx0XHQvKiogQHR5cGUge1JlY29yZDxzdHJpbmcsIEN1c3RvbUVsZW1lbnRQcm9wRGVmaW5pdGlvbj59IFByb3BzIGRlZmluaXRpb24gKG5hbWUsIHJlZmxlY3RlZCwgdHlwZSBldGMpICovXG5cdFx0JCRwX2QgPSB7fTtcblx0XHQvKiogQHR5cGUge1JlY29yZDxzdHJpbmcsIEZ1bmN0aW9uW10+fSBFdmVudCBsaXN0ZW5lcnMgKi9cblx0XHQkJGwgPSB7fTtcblx0XHQvKiogQHR5cGUge01hcDxGdW5jdGlvbiwgRnVuY3Rpb24+fSBFdmVudCBsaXN0ZW5lciB1bnN1YnNjcmliZSBmdW5jdGlvbnMgKi9cblx0XHQkJGxfdSA9IG5ldyBNYXAoKTtcblxuXHRcdGNvbnN0cnVjdG9yKCQkY29tcG9uZW50Q3RvciwgJCRzbG90cywgdXNlX3NoYWRvd19kb20pIHtcblx0XHRcdHN1cGVyKCk7XG5cdFx0XHR0aGlzLiQkY3RvciA9ICQkY29tcG9uZW50Q3Rvcjtcblx0XHRcdHRoaXMuJCRzID0gJCRzbG90cztcblx0XHRcdGlmICh1c2Vfc2hhZG93X2RvbSkge1xuXHRcdFx0XHR0aGlzLmF0dGFjaFNoYWRvdyh7IG1vZGU6ICdvcGVuJyB9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRhZGRFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyLCBvcHRpb25zKSB7XG5cdFx0XHQvLyBXZSBjYW4ndCBkZXRlcm1pbmUgdXBmcm9udCBpZiB0aGUgZXZlbnQgaXMgYSBjdXN0b20gZXZlbnQgb3Igbm90LCBzbyB3ZSBoYXZlIHRvXG5cdFx0XHQvLyBsaXN0ZW4gdG8gYm90aC4gSWYgc29tZW9uZSB1c2VzIGEgY3VzdG9tIGV2ZW50IHdpdGggdGhlIHNhbWUgbmFtZSBhcyBhIHJlZ3VsYXJcblx0XHRcdC8vIGJyb3dzZXIgZXZlbnQsIHRoaXMgZmlyZXMgdHdpY2UgLSB3ZSBjYW4ndCBhdm9pZCB0aGF0LlxuXHRcdFx0dGhpcy4kJGxbdHlwZV0gPSB0aGlzLiQkbFt0eXBlXSB8fCBbXTtcblx0XHRcdHRoaXMuJCRsW3R5cGVdLnB1c2gobGlzdGVuZXIpO1xuXHRcdFx0aWYgKHRoaXMuJCRjKSB7XG5cdFx0XHRcdGNvbnN0IHVuc3ViID0gdGhpcy4kJGMuJG9uKHR5cGUsIGxpc3RlbmVyKTtcblx0XHRcdFx0dGhpcy4kJGxfdS5zZXQobGlzdGVuZXIsIHVuc3ViKTtcblx0XHRcdH1cblx0XHRcdHN1cGVyLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIG9wdGlvbnMpO1xuXHRcdH1cblxuXHRcdHJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIG9wdGlvbnMpIHtcblx0XHRcdHN1cGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIG9wdGlvbnMpO1xuXHRcdFx0aWYgKHRoaXMuJCRjKSB7XG5cdFx0XHRcdGNvbnN0IHVuc3ViID0gdGhpcy4kJGxfdS5nZXQobGlzdGVuZXIpO1xuXHRcdFx0XHRpZiAodW5zdWIpIHtcblx0XHRcdFx0XHR1bnN1YigpO1xuXHRcdFx0XHRcdHRoaXMuJCRsX3UuZGVsZXRlKGxpc3RlbmVyKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGFzeW5jIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuXHRcdFx0dGhpcy4kJGNuID0gdHJ1ZTtcblx0XHRcdGlmICghdGhpcy4kJGMpIHtcblx0XHRcdFx0Ly8gV2Ugd2FpdCBvbmUgdGljayB0byBsZXQgcG9zc2libGUgY2hpbGQgc2xvdCBlbGVtZW50cyBiZSBjcmVhdGVkL21vdW50ZWRcblx0XHRcdFx0YXdhaXQgUHJvbWlzZS5yZXNvbHZlKCk7XG5cdFx0XHRcdGlmICghdGhpcy4kJGNuIHx8IHRoaXMuJCRjKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGZ1bmN0aW9uIGNyZWF0ZV9zbG90KG5hbWUpIHtcblx0XHRcdFx0XHRyZXR1cm4gKCkgPT4ge1xuXHRcdFx0XHRcdFx0bGV0IG5vZGU7XG5cdFx0XHRcdFx0XHRjb25zdCBvYmogPSB7XG5cdFx0XHRcdFx0XHRcdGM6IGZ1bmN0aW9uIGNyZWF0ZSgpIHtcblx0XHRcdFx0XHRcdFx0XHRub2RlID0gZWxlbWVudCgnc2xvdCcpO1xuXHRcdFx0XHRcdFx0XHRcdGlmIChuYW1lICE9PSAnZGVmYXVsdCcpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGF0dHIobm9kZSwgJ25hbWUnLCBuYW1lKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdC8qKlxuXHRcdFx0XHRcdFx0XHQgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSB0YXJnZXRcblx0XHRcdFx0XHRcdFx0ICogQHBhcmFtIHtIVE1MRWxlbWVudH0gW2FuY2hvcl1cblx0XHRcdFx0XHRcdFx0ICovXG5cdFx0XHRcdFx0XHRcdG06IGZ1bmN0aW9uIG1vdW50KHRhcmdldCwgYW5jaG9yKSB7XG5cdFx0XHRcdFx0XHRcdFx0aW5zZXJ0KHRhcmdldCwgbm9kZSwgYW5jaG9yKTtcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0ZDogZnVuY3Rpb24gZGVzdHJveShkZXRhY2hpbmcpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoZGV0YWNoaW5nKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRkZXRhY2gobm9kZSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0cmV0dXJuIG9iajtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNvbnN0ICQkc2xvdHMgPSB7fTtcblx0XHRcdFx0Y29uc3QgZXhpc3Rpbmdfc2xvdHMgPSBnZXRfY3VzdG9tX2VsZW1lbnRzX3Nsb3RzKHRoaXMpO1xuXHRcdFx0XHRmb3IgKGNvbnN0IG5hbWUgb2YgdGhpcy4kJHMpIHtcblx0XHRcdFx0XHRpZiAobmFtZSBpbiBleGlzdGluZ19zbG90cykge1xuXHRcdFx0XHRcdFx0JCRzbG90c1tuYW1lXSA9IFtjcmVhdGVfc2xvdChuYW1lKV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGZvciAoY29uc3QgYXR0cmlidXRlIG9mIHRoaXMuYXR0cmlidXRlcykge1xuXHRcdFx0XHRcdC8vIHRoaXMuJCRkYXRhIHRha2VzIHByZWNlZGVuY2Ugb3ZlciB0aGlzLmF0dHJpYnV0ZXNcblx0XHRcdFx0XHRjb25zdCBuYW1lID0gdGhpcy4kJGdfcChhdHRyaWJ1dGUubmFtZSk7XG5cdFx0XHRcdFx0aWYgKCEobmFtZSBpbiB0aGlzLiQkZCkpIHtcblx0XHRcdFx0XHRcdHRoaXMuJCRkW25hbWVdID0gZ2V0X2N1c3RvbV9lbGVtZW50X3ZhbHVlKG5hbWUsIGF0dHJpYnV0ZS52YWx1ZSwgdGhpcy4kJHBfZCwgJ3RvUHJvcCcpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBQb3J0IG92ZXIgcHJvcHMgdGhhdCB3ZXJlIHNldCBwcm9ncmFtbWF0aWNhbGx5IGJlZm9yZSBjZSB3YXMgaW5pdGlhbGl6ZWRcblx0XHRcdFx0Zm9yIChjb25zdCBrZXkgaW4gdGhpcy4kJHBfZCkge1xuXHRcdFx0XHRcdGlmICghKGtleSBpbiB0aGlzLiQkZCkgJiYgdGhpc1trZXldICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdHRoaXMuJCRkW2tleV0gPSB0aGlzW2tleV07IC8vIGRvbid0IHRyYW5zZm9ybSwgdGhlc2Ugd2VyZSBzZXQgdGhyb3VnaCBKYXZhU2NyaXB0XG5cdFx0XHRcdFx0XHRkZWxldGUgdGhpc1trZXldOyAvLyByZW1vdmUgdGhlIHByb3BlcnR5IHRoYXQgc2hhZG93cyB0aGUgZ2V0dGVyL3NldHRlclxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHR0aGlzLiQkYyA9IG5ldyB0aGlzLiQkY3Rvcih7XG5cdFx0XHRcdFx0dGFyZ2V0OiB0aGlzLnNoYWRvd1Jvb3QgfHwgdGhpcyxcblx0XHRcdFx0XHRwcm9wczoge1xuXHRcdFx0XHRcdFx0Li4udGhpcy4kJGQsXG5cdFx0XHRcdFx0XHQkJHNsb3RzLFxuXHRcdFx0XHRcdFx0JCRzY29wZToge1xuXHRcdFx0XHRcdFx0XHRjdHg6IFtdXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHQvLyBSZWZsZWN0IGNvbXBvbmVudCBwcm9wcyBhcyBhdHRyaWJ1dGVzXG5cdFx0XHRcdGNvbnN0IHJlZmxlY3RfYXR0cmlidXRlcyA9ICgpID0+IHtcblx0XHRcdFx0XHR0aGlzLiQkciA9IHRydWU7XG5cdFx0XHRcdFx0Zm9yIChjb25zdCBrZXkgaW4gdGhpcy4kJHBfZCkge1xuXHRcdFx0XHRcdFx0dGhpcy4kJGRba2V5XSA9IHRoaXMuJCRjLiQkLmN0eFt0aGlzLiQkYy4kJC5wcm9wc1trZXldXTtcblx0XHRcdFx0XHRcdGlmICh0aGlzLiQkcF9kW2tleV0ucmVmbGVjdCkge1xuXHRcdFx0XHRcdFx0XHRjb25zdCBhdHRyaWJ1dGVfdmFsdWUgPSBnZXRfY3VzdG9tX2VsZW1lbnRfdmFsdWUoXG5cdFx0XHRcdFx0XHRcdFx0a2V5LFxuXHRcdFx0XHRcdFx0XHRcdHRoaXMuJCRkW2tleV0sXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy4kJHBfZCxcblx0XHRcdFx0XHRcdFx0XHQndG9BdHRyaWJ1dGUnXG5cdFx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHRcdGlmIChhdHRyaWJ1dGVfdmFsdWUgPT0gbnVsbCkge1xuXHRcdFx0XHRcdFx0XHRcdHRoaXMucmVtb3ZlQXR0cmlidXRlKHRoaXMuJCRwX2Rba2V5XS5hdHRyaWJ1dGUgfHwga2V5KTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHR0aGlzLnNldEF0dHJpYnV0ZSh0aGlzLiQkcF9kW2tleV0uYXR0cmlidXRlIHx8IGtleSwgYXR0cmlidXRlX3ZhbHVlKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHR0aGlzLiQkciA9IGZhbHNlO1xuXHRcdFx0XHR9O1xuXHRcdFx0XHR0aGlzLiQkYy4kJC5hZnRlcl91cGRhdGUucHVzaChyZWZsZWN0X2F0dHJpYnV0ZXMpO1xuXHRcdFx0XHRyZWZsZWN0X2F0dHJpYnV0ZXMoKTsgLy8gb25jZSBpbml0aWFsbHkgYmVjYXVzZSBhZnRlcl91cGRhdGUgaXMgYWRkZWQgdG9vIGxhdGUgZm9yIGZpcnN0IHJlbmRlclxuXG5cdFx0XHRcdGZvciAoY29uc3QgdHlwZSBpbiB0aGlzLiQkbCkge1xuXHRcdFx0XHRcdGZvciAoY29uc3QgbGlzdGVuZXIgb2YgdGhpcy4kJGxbdHlwZV0pIHtcblx0XHRcdFx0XHRcdGNvbnN0IHVuc3ViID0gdGhpcy4kJGMuJG9uKHR5cGUsIGxpc3RlbmVyKTtcblx0XHRcdFx0XHRcdHRoaXMuJCRsX3Uuc2V0KGxpc3RlbmVyLCB1bnN1Yik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdHRoaXMuJCRsID0ge307XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gV2UgZG9uJ3QgbmVlZCB0aGlzIHdoZW4gd29ya2luZyB3aXRoaW4gU3ZlbHRlIGNvZGUsIGJ1dCBmb3IgY29tcGF0aWJpbGl0eSBvZiBwZW9wbGUgdXNpbmcgdGhpcyBvdXRzaWRlIG9mIFN2ZWx0ZVxuXHRcdC8vIGFuZCBzZXR0aW5nIGF0dHJpYnV0ZXMgdGhyb3VnaCBzZXRBdHRyaWJ1dGUgZXRjLCB0aGlzIGlzIGhlbHBmdWxcblx0XHRhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2soYXR0ciwgX29sZFZhbHVlLCBuZXdWYWx1ZSkge1xuXHRcdFx0aWYgKHRoaXMuJCRyKSByZXR1cm47XG5cdFx0XHRhdHRyID0gdGhpcy4kJGdfcChhdHRyKTtcblx0XHRcdHRoaXMuJCRkW2F0dHJdID0gZ2V0X2N1c3RvbV9lbGVtZW50X3ZhbHVlKGF0dHIsIG5ld1ZhbHVlLCB0aGlzLiQkcF9kLCAndG9Qcm9wJyk7XG5cdFx0XHR0aGlzLiQkYz8uJHNldCh7IFthdHRyXTogdGhpcy4kJGRbYXR0cl0gfSk7XG5cdFx0fVxuXG5cdFx0ZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG5cdFx0XHR0aGlzLiQkY24gPSBmYWxzZTtcblx0XHRcdC8vIEluIGEgbWljcm90YXNrLCBiZWNhdXNlIHRoaXMgY291bGQgYmUgYSBtb3ZlIHdpdGhpbiB0aGUgRE9NXG5cdFx0XHRQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpID0+IHtcblx0XHRcdFx0aWYgKCF0aGlzLiQkY24gJiYgdGhpcy4kJGMpIHtcblx0XHRcdFx0XHR0aGlzLiQkYy4kZGVzdHJveSgpO1xuXHRcdFx0XHRcdHRoaXMuJCRjID0gdW5kZWZpbmVkO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHQkJGdfcChhdHRyaWJ1dGVfbmFtZSkge1xuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0T2JqZWN0LmtleXModGhpcy4kJHBfZCkuZmluZChcblx0XHRcdFx0XHQoa2V5KSA9PlxuXHRcdFx0XHRcdFx0dGhpcy4kJHBfZFtrZXldLmF0dHJpYnV0ZSA9PT0gYXR0cmlidXRlX25hbWUgfHxcblx0XHRcdFx0XHRcdCghdGhpcy4kJHBfZFtrZXldLmF0dHJpYnV0ZSAmJiBrZXkudG9Mb3dlckNhc2UoKSA9PT0gYXR0cmlidXRlX25hbWUpXG5cdFx0XHRcdCkgfHwgYXR0cmlidXRlX25hbWVcblx0XHRcdCk7XG5cdFx0fVxuXHR9O1xufVxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wXG4gKiBAcGFyYW0ge2FueX0gdmFsdWVcbiAqIEBwYXJhbSB7UmVjb3JkPHN0cmluZywgQ3VzdG9tRWxlbWVudFByb3BEZWZpbml0aW9uPn0gcHJvcHNfZGVmaW5pdGlvblxuICogQHBhcmFtIHsndG9BdHRyaWJ1dGUnIHwgJ3RvUHJvcCd9IFt0cmFuc2Zvcm1dXG4gKi9cbmZ1bmN0aW9uIGdldF9jdXN0b21fZWxlbWVudF92YWx1ZShwcm9wLCB2YWx1ZSwgcHJvcHNfZGVmaW5pdGlvbiwgdHJhbnNmb3JtKSB7XG5cdGNvbnN0IHR5cGUgPSBwcm9wc19kZWZpbml0aW9uW3Byb3BdPy50eXBlO1xuXHR2YWx1ZSA9IHR5cGUgPT09ICdCb29sZWFuJyAmJiB0eXBlb2YgdmFsdWUgIT09ICdib29sZWFuJyA/IHZhbHVlICE9IG51bGwgOiB2YWx1ZTtcblx0aWYgKCF0cmFuc2Zvcm0gfHwgIXByb3BzX2RlZmluaXRpb25bcHJvcF0pIHtcblx0XHRyZXR1cm4gdmFsdWU7XG5cdH0gZWxzZSBpZiAodHJhbnNmb3JtID09PSAndG9BdHRyaWJ1dGUnKSB7XG5cdFx0c3dpdGNoICh0eXBlKSB7XG5cdFx0XHRjYXNlICdPYmplY3QnOlxuXHRcdFx0Y2FzZSAnQXJyYXknOlxuXHRcdFx0XHRyZXR1cm4gdmFsdWUgPT0gbnVsbCA/IG51bGwgOiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG5cdFx0XHRjYXNlICdCb29sZWFuJzpcblx0XHRcdFx0cmV0dXJuIHZhbHVlID8gJycgOiBudWxsO1xuXHRcdFx0Y2FzZSAnTnVtYmVyJzpcblx0XHRcdFx0cmV0dXJuIHZhbHVlID09IG51bGwgPyBudWxsIDogdmFsdWU7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdHN3aXRjaCAodHlwZSkge1xuXHRcdFx0Y2FzZSAnT2JqZWN0Jzpcblx0XHRcdGNhc2UgJ0FycmF5Jzpcblx0XHRcdFx0cmV0dXJuIHZhbHVlICYmIEpTT04ucGFyc2UodmFsdWUpO1xuXHRcdFx0Y2FzZSAnQm9vbGVhbic6XG5cdFx0XHRcdHJldHVybiB2YWx1ZTsgLy8gY29udmVyc2lvbiBhbHJlYWR5IGhhbmRsZWQgYWJvdmVcblx0XHRcdGNhc2UgJ051bWJlcic6XG5cdFx0XHRcdHJldHVybiB2YWx1ZSAhPSBudWxsID8gK3ZhbHVlIDogdmFsdWU7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fVxuXHR9XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKlxuICogVHVybiBhIFN2ZWx0ZSBjb21wb25lbnQgaW50byBhIGN1c3RvbSBlbGVtZW50LlxuICogQHBhcmFtIHtpbXBvcnQoJy4vcHVibGljLmpzJykuQ29tcG9uZW50VHlwZX0gQ29tcG9uZW50ICBBIFN2ZWx0ZSBjb21wb25lbnQgY29uc3RydWN0b3JcbiAqIEBwYXJhbSB7UmVjb3JkPHN0cmluZywgQ3VzdG9tRWxlbWVudFByb3BEZWZpbml0aW9uPn0gcHJvcHNfZGVmaW5pdGlvbiAgVGhlIHByb3BzIHRvIG9ic2VydmVcbiAqIEBwYXJhbSB7c3RyaW5nW119IHNsb3RzICBUaGUgc2xvdHMgdG8gY3JlYXRlXG4gKiBAcGFyYW0ge3N0cmluZ1tdfSBhY2Nlc3NvcnMgIE90aGVyIGFjY2Vzc29ycyBiZXNpZGVzIHRoZSBvbmVzIGZvciBwcm9wcyB0aGUgY29tcG9uZW50IGhhc1xuICogQHBhcmFtIHtib29sZWFufSB1c2Vfc2hhZG93X2RvbSAgV2hldGhlciB0byB1c2Ugc2hhZG93IERPTVxuICogQHBhcmFtIHsoY2U6IG5ldyAoKSA9PiBIVE1MRWxlbWVudCkgPT4gbmV3ICgpID0+IEhUTUxFbGVtZW50fSBbZXh0ZW5kXVxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlX2N1c3RvbV9lbGVtZW50KFxuXHRDb21wb25lbnQsXG5cdHByb3BzX2RlZmluaXRpb24sXG5cdHNsb3RzLFxuXHRhY2Nlc3NvcnMsXG5cdHVzZV9zaGFkb3dfZG9tLFxuXHRleHRlbmRcbikge1xuXHRsZXQgQ2xhc3MgPSBjbGFzcyBleHRlbmRzIFN2ZWx0ZUVsZW1lbnQge1xuXHRcdGNvbnN0cnVjdG9yKCkge1xuXHRcdFx0c3VwZXIoQ29tcG9uZW50LCBzbG90cywgdXNlX3NoYWRvd19kb20pO1xuXHRcdFx0dGhpcy4kJHBfZCA9IHByb3BzX2RlZmluaXRpb247XG5cdFx0fVxuXHRcdHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkge1xuXHRcdFx0cmV0dXJuIE9iamVjdC5rZXlzKHByb3BzX2RlZmluaXRpb24pLm1hcCgoa2V5KSA9PlxuXHRcdFx0XHQocHJvcHNfZGVmaW5pdGlvbltrZXldLmF0dHJpYnV0ZSB8fCBrZXkpLnRvTG93ZXJDYXNlKClcblx0XHRcdCk7XG5cdFx0fVxuXHR9O1xuXHRPYmplY3Qua2V5cyhwcm9wc19kZWZpbml0aW9uKS5mb3JFYWNoKChwcm9wKSA9PiB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KENsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuXHRcdFx0Z2V0KCkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy4kJGMgJiYgcHJvcCBpbiB0aGlzLiQkYyA/IHRoaXMuJCRjW3Byb3BdIDogdGhpcy4kJGRbcHJvcF07XG5cdFx0XHR9LFxuXHRcdFx0c2V0KHZhbHVlKSB7XG5cdFx0XHRcdHZhbHVlID0gZ2V0X2N1c3RvbV9lbGVtZW50X3ZhbHVlKHByb3AsIHZhbHVlLCBwcm9wc19kZWZpbml0aW9uKTtcblx0XHRcdFx0dGhpcy4kJGRbcHJvcF0gPSB2YWx1ZTtcblx0XHRcdFx0dGhpcy4kJGM/LiRzZXQoeyBbcHJvcF06IHZhbHVlIH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTtcblx0YWNjZXNzb3JzLmZvckVhY2goKGFjY2Vzc29yKSA9PiB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KENsYXNzLnByb3RvdHlwZSwgYWNjZXNzb3IsIHtcblx0XHRcdGdldCgpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuJCRjPy5bYWNjZXNzb3JdO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTtcblx0aWYgKGV4dGVuZCkge1xuXHRcdC8vIEB0cy1leHBlY3QtZXJyb3IgLSBhc3NpZ25pbmcgaGVyZSBpcyBmaW5lXG5cdFx0Q2xhc3MgPSBleHRlbmQoQ2xhc3MpO1xuXHR9XG5cdENvbXBvbmVudC5lbGVtZW50ID0gLyoqIEB0eXBlIHthbnl9ICovIChDbGFzcyk7XG5cdHJldHVybiBDbGFzcztcbn1cblxuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBTdmVsdGUgY29tcG9uZW50cy4gVXNlZCB3aGVuIGRldj1mYWxzZS5cbiAqXG4gKiBAdGVtcGxhdGUge1JlY29yZDxzdHJpbmcsIGFueT59IFtQcm9wcz1hbnldXG4gKiBAdGVtcGxhdGUge1JlY29yZDxzdHJpbmcsIGFueT59IFtFdmVudHM9YW55XVxuICovXG5leHBvcnQgY2xhc3MgU3ZlbHRlQ29tcG9uZW50IHtcblx0LyoqXG5cdCAqICMjIyBQUklWQVRFIEFQSVxuXHQgKlxuXHQgKiBEbyBub3QgdXNlLCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lXG5cdCAqXG5cdCAqIEB0eXBlIHthbnl9XG5cdCAqL1xuXHQkJCA9IHVuZGVmaW5lZDtcblx0LyoqXG5cdCAqICMjIyBQUklWQVRFIEFQSVxuXHQgKlxuXHQgKiBEbyBub3QgdXNlLCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lXG5cdCAqXG5cdCAqIEB0eXBlIHthbnl9XG5cdCAqL1xuXHQkJHNldCA9IHVuZGVmaW5lZDtcblxuXHQvKiogQHJldHVybnMge3ZvaWR9ICovXG5cdCRkZXN0cm95KCkge1xuXHRcdGRlc3Ryb3lfY29tcG9uZW50KHRoaXMsIDEpO1xuXHRcdHRoaXMuJGRlc3Ryb3kgPSBub29wO1xuXHR9XG5cblx0LyoqXG5cdCAqIEB0ZW1wbGF0ZSB7RXh0cmFjdDxrZXlvZiBFdmVudHMsIHN0cmluZz59IEtcblx0ICogQHBhcmFtIHtLfSB0eXBlXG5cdCAqIEBwYXJhbSB7KChlOiBFdmVudHNbS10pID0+IHZvaWQpIHwgbnVsbCB8IHVuZGVmaW5lZH0gY2FsbGJhY2tcblx0ICogQHJldHVybnMgeygpID0+IHZvaWR9XG5cdCAqL1xuXHQkb24odHlwZSwgY2FsbGJhY2spIHtcblx0XHRpZiAoIWlzX2Z1bmN0aW9uKGNhbGxiYWNrKSkge1xuXHRcdFx0cmV0dXJuIG5vb3A7XG5cdFx0fVxuXHRcdGNvbnN0IGNhbGxiYWNrcyA9IHRoaXMuJCQuY2FsbGJhY2tzW3R5cGVdIHx8ICh0aGlzLiQkLmNhbGxiYWNrc1t0eXBlXSA9IFtdKTtcblx0XHRjYWxsYmFja3MucHVzaChjYWxsYmFjayk7XG5cdFx0cmV0dXJuICgpID0+IHtcblx0XHRcdGNvbnN0IGluZGV4ID0gY2FsbGJhY2tzLmluZGV4T2YoY2FsbGJhY2spO1xuXHRcdFx0aWYgKGluZGV4ICE9PSAtMSkgY2FsbGJhY2tzLnNwbGljZShpbmRleCwgMSk7XG5cdFx0fTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAcGFyYW0ge1BhcnRpYWw8UHJvcHM+fSBwcm9wc1xuXHQgKiBAcmV0dXJucyB7dm9pZH1cblx0ICovXG5cdCRzZXQocHJvcHMpIHtcblx0XHRpZiAodGhpcy4kJHNldCAmJiAhaXNfZW1wdHkocHJvcHMpKSB7XG5cdFx0XHR0aGlzLiQkLnNraXBfYm91bmQgPSB0cnVlO1xuXHRcdFx0dGhpcy4kJHNldChwcm9wcyk7XG5cdFx0XHR0aGlzLiQkLnNraXBfYm91bmQgPSBmYWxzZTtcblx0XHR9XG5cdH1cbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBDdXN0b21FbGVtZW50UHJvcERlZmluaXRpb25cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbYXR0cmlidXRlXVxuICogQHByb3BlcnR5IHtib29sZWFufSBbcmVmbGVjdF1cbiAqIEBwcm9wZXJ0eSB7J1N0cmluZyd8J0Jvb2xlYW4nfCdOdW1iZXInfCdBcnJheSd8J09iamVjdCd9IFt0eXBlXVxuICovXG4iLCAiaW1wb3J0IHsgcnVuX2FsbCwgaXNfZnVuY3Rpb24sIG5vb3AsIGlkZW50aXR5LCB0aWNrLCBTdmVsdGVDb21wb25lbnQsIGluaXQsIHNhZmVfbm90X2VxdWFsLCBlbnN1cmVfYXJyYXlfbGlrZSwgZW1wdHksIGluc2VydCwgZGV0YWNoLCBkZXN0cm95X2VhY2gsIGNvbXBvbmVudF9zdWJzY3JpYmUsIHNldF9zdG9yZV92YWx1ZSwgZWxlbWVudCwgdGV4dCwgYXR0ciwgYXBwZW5kLCBsaXN0ZW4sIHNldF9kYXRhLCBhY3Rpb25fZGVzdHJveWVyLCB0cmFuc2l0aW9uX2luLCBncm91cF9vdXRyb3MsIGNoZWNrX291dHJvcywgdHJhbnNpdGlvbl9vdXQsIHNwYWNlLCBjcmVhdGVfY29tcG9uZW50LCBtb3VudF9jb21wb25lbnQsIGRlc3Ryb3lfY29tcG9uZW50LCBjb25zdHJ1Y3Rfc3ZlbHRlX2NvbXBvbmVudCwgc2V0X3N0eWxlLCBnZXRfY3VycmVudF9jb21wb25lbnQgfSBmcm9tICdzdmVsdGUvaW50ZXJuYWwnO1xuaW1wb3J0IHsgZ2V0Q29udGV4dCwgc2V0Q29udGV4dCwgYmVmb3JlVXBkYXRlLCBhZnRlclVwZGF0ZSB9IGZyb20gJ3N2ZWx0ZSc7XG5pbXBvcnQgeyBkZXJpdmVkLCBnZXQsIHdyaXRhYmxlLCByZWFkYWJsZSB9IGZyb20gJ3N2ZWx0ZS9zdG9yZSc7XG5cbmZ1bmN0aW9uIGtleUVudGVyKGZuKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBlLmtleSA9PT0gJ0VudGVyJyB8fCBlLmtleSA9PT0gJyAnICYmICFlLnByZXZlbnREZWZhdWx0KCkgIC8vIHByZXZlbnQgcGFnZSBzY3JvbGwgZG93blxuICAgICAgICAgICAgPyBmbi5jYWxsKHRoaXMsIGUpXG4gICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBzZXRDb250ZW50KG5vZGUsIGNvbnRlbnQpIHtcbiAgICBsZXQgYWN0aW9ucyA9IHtcbiAgICAgICAgdXBkYXRlKGNvbnRlbnQpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29udGVudCA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIG5vZGUuaW5uZXJUZXh0ID0gY29udGVudDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGVudD8uZG9tTm9kZXMpIHtcbiAgICAgICAgICAgICAgICBub2RlLnJlcGxhY2VDaGlsZHJlbiguLi5jb250ZW50LmRvbU5vZGVzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGVudD8uaHRtbCkge1xuICAgICAgICAgICAgICAgIG5vZGUuaW5uZXJIVE1MID0gY29udGVudC5odG1sO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBhY3Rpb25zLnVwZGF0ZShjb250ZW50KTtcblxuICAgIHJldHVybiBhY3Rpb25zO1xufVxuXG4vKiogRGlzcGF0Y2ggZXZlbnQgb2NjdXJyZWQgb3V0c2lkZSBvZiBub2RlICovXG5mdW5jdGlvbiBvdXRzaWRlRXZlbnQobm9kZSwgdHlwZSkge1xuXG4gICAgY29uc3QgaGFuZGxlUG9pbnRlckRvd24gPSBqc0V2ZW50ID0+IHtcbiAgICAgICAgaWYgKG5vZGUgJiYgIW5vZGUuY29udGFpbnMoanNFdmVudC50YXJnZXQpKSB7XG4gICAgICAgICAgICBub2RlLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgICAgICAgbmV3IEN1c3RvbUV2ZW50KHR5cGUgKyAnb3V0c2lkZScsIHtkZXRhaWw6IHtqc0V2ZW50fX0pXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlUG9pbnRlckRvd24sIHRydWUpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZGVzdHJveSgpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlUG9pbnRlckRvd24sIHRydWUpO1xuICAgICAgICB9XG4gICAgfTtcbn1cblxuY29uc3QgREFZX0lOX1NFQ09ORFMgPSA4NjQwMDtcblxuZnVuY3Rpb24gY3JlYXRlRGF0ZShpbnB1dCA9IHVuZGVmaW5lZCkge1xuICAgIGlmIChpbnB1dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiBpbnB1dCBpbnN0YW5jZW9mIERhdGUgPyBfZnJvbUxvY2FsRGF0ZShpbnB1dCkgOiBfZnJvbUlTT1N0cmluZyhpbnB1dCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIF9mcm9tTG9jYWxEYXRlKG5ldyBEYXRlKCkpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVEdXJhdGlvbihpbnB1dCkge1xuICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGlucHV0ID0ge3NlY29uZHM6IGlucHV0fTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgLy8gRXhwZWN0ZWQgZm9ybWF0IGhoWzptbVs6c3NdXVxuICAgICAgICBsZXQgc2Vjb25kcyA9IDAsIGV4cCA9IDI7XG4gICAgICAgIGZvciAobGV0IHBhcnQgb2YgaW5wdXQuc3BsaXQoJzonLCAzKSkge1xuICAgICAgICAgICAgc2Vjb25kcyArPSBwYXJzZUludChwYXJ0LCAxMCkgKiBNYXRoLnBvdyg2MCwgZXhwLS0pO1xuICAgICAgICB9XG4gICAgICAgIGlucHV0ID0ge3NlY29uZHN9O1xuICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgIGlucHV0ID0ge2hvdXJzOiBpbnB1dC5nZXRVVENIb3VycygpLCBtaW51dGVzOiBpbnB1dC5nZXRVVENNaW51dGVzKCksIHNlY29uZHM6IGlucHV0LmdldFVUQ1NlY29uZHMoKX07XG4gICAgfVxuXG4gICAgbGV0IHdlZWtzID0gaW5wdXQud2Vla3MgfHwgaW5wdXQud2VlayB8fCAwO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgeWVhcnM6IGlucHV0LnllYXJzIHx8IGlucHV0LnllYXIgfHwgMCxcbiAgICAgICAgbW9udGhzOiBpbnB1dC5tb250aHMgfHwgaW5wdXQubW9udGggfHwgMCxcbiAgICAgICAgZGF5czogd2Vla3MgKiA3ICsgKGlucHV0LmRheXMgfHwgaW5wdXQuZGF5IHx8IDApLFxuICAgICAgICBzZWNvbmRzOiAoaW5wdXQuaG91cnMgfHwgaW5wdXQuaG91ciB8fCAwKSAqIDYwICogNjAgK1xuICAgICAgICAgICAgKGlucHV0Lm1pbnV0ZXMgfHwgaW5wdXQubWludXRlIHx8IDApICogNjAgK1xuICAgICAgICAgICAgKGlucHV0LnNlY29uZHMgfHwgaW5wdXQuc2Vjb25kIHx8IDApLFxuICAgICAgICBpbldlZWtzOiAhIXdlZWtzXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gY2xvbmVEYXRlKGRhdGUpIHtcbiAgICByZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xufVxuXG5mdW5jdGlvbiBhZGREdXJhdGlvbihkYXRlLCBkdXJhdGlvbiwgeCA9IDEpIHtcbiAgICBkYXRlLnNldFVUQ0Z1bGxZZWFyKGRhdGUuZ2V0VVRDRnVsbFllYXIoKSArIHggKiBkdXJhdGlvbi55ZWFycyk7XG4gICAgbGV0IG1vbnRoID0gZGF0ZS5nZXRVVENNb250aCgpICsgeCAqIGR1cmF0aW9uLm1vbnRocztcbiAgICBkYXRlLnNldFVUQ01vbnRoKG1vbnRoKTtcbiAgICBtb250aCAlPSAxMjtcbiAgICBpZiAobW9udGggPCAwKSB7XG4gICAgICAgIG1vbnRoICs9IDEyO1xuICAgIH1cbiAgICB3aGlsZSAoZGF0ZS5nZXRVVENNb250aCgpICE9PSBtb250aCkge1xuICAgICAgICBzdWJ0cmFjdERheShkYXRlKTtcbiAgICB9XG4gICAgZGF0ZS5zZXRVVENEYXRlKGRhdGUuZ2V0VVRDRGF0ZSgpICsgeCAqIGR1cmF0aW9uLmRheXMpO1xuICAgIGRhdGUuc2V0VVRDU2Vjb25kcyhkYXRlLmdldFVUQ1NlY29uZHMoKSArIHggKiBkdXJhdGlvbi5zZWNvbmRzKTtcblxuICAgIHJldHVybiBkYXRlO1xufVxuXG5mdW5jdGlvbiBzdWJ0cmFjdER1cmF0aW9uKGRhdGUsIGR1cmF0aW9uLCB4ID0gMSkge1xuICAgIHJldHVybiBhZGREdXJhdGlvbihkYXRlLCBkdXJhdGlvbiwgLXgpO1xufVxuXG5mdW5jdGlvbiBhZGREYXkoZGF0ZSwgeCA9IDEpIHtcbiAgICBkYXRlLnNldFVUQ0RhdGUoZGF0ZS5nZXRVVENEYXRlKCkgKyB4KTtcblxuICAgIHJldHVybiBkYXRlO1xufVxuXG5mdW5jdGlvbiBzdWJ0cmFjdERheShkYXRlLCB4ID0gMSkge1xuICAgIHJldHVybiBhZGREYXkoZGF0ZSwgLXgpO1xufVxuXG5mdW5jdGlvbiBzZXRNaWRuaWdodChkYXRlKSB7XG4gICAgZGF0ZS5zZXRVVENIb3VycygwLCAwLCAwLCAwKTtcblxuICAgIHJldHVybiBkYXRlO1xufVxuXG5mdW5jdGlvbiB0b0xvY2FsRGF0ZShkYXRlKSB7XG4gICAgcmV0dXJuIG5ldyBEYXRlKFxuICAgICAgICBkYXRlLmdldFVUQ0Z1bGxZZWFyKCksXG4gICAgICAgIGRhdGUuZ2V0VVRDTW9udGgoKSxcbiAgICAgICAgZGF0ZS5nZXRVVENEYXRlKCksXG4gICAgICAgIGRhdGUuZ2V0VVRDSG91cnMoKSxcbiAgICAgICAgZGF0ZS5nZXRVVENNaW51dGVzKCksXG4gICAgICAgIGRhdGUuZ2V0VVRDU2Vjb25kcygpXG4gICAgKTtcbn1cblxuZnVuY3Rpb24gdG9JU09TdHJpbmcoZGF0ZSwgbGVuID0gMTkpIHtcbiAgICByZXR1cm4gZGF0ZS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCBsZW4pO1xufVxuXG5mdW5jdGlvbiBkYXRlc0VxdWFsKGRhdGUxLCAuLi5kYXRlczIpIHtcbiAgICByZXR1cm4gZGF0ZXMyLmV2ZXJ5KGRhdGUyID0+IGRhdGUxLmdldFRpbWUoKSA9PT0gZGF0ZTIuZ2V0VGltZSgpKTtcbn1cblxuZnVuY3Rpb24gbmV4dENsb3Nlc3REYXkoZGF0ZSwgZGF5KSB7XG4gICAgbGV0IGRpZmYgPSBkYXkgLSBkYXRlLmdldFVUQ0RheSgpO1xuICAgIGRhdGUuc2V0VVRDRGF0ZShkYXRlLmdldFVUQ0RhdGUoKSArIChkaWZmID49IDAgPyBkaWZmIDogZGlmZiArIDcpKTtcbiAgICByZXR1cm4gZGF0ZTtcbn1cblxuZnVuY3Rpb24gcHJldkNsb3Nlc3REYXkoZGF0ZSwgZGF5KSB7XG4gICAgbGV0IGRpZmYgPSBkYXkgLSBkYXRlLmdldFVUQ0RheSgpO1xuICAgIGRhdGUuc2V0VVRDRGF0ZShkYXRlLmdldFVUQ0RhdGUoKSArIChkaWZmIDw9IDAgPyBkaWZmIDogZGlmZiAtIDcpKTtcbiAgICByZXR1cm4gZGF0ZTtcbn1cblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIGdpdmVuIGRhdGUgaXMgc3RyaW5nIHdoaWNoIGNvbnRhaW5zIG5vIHRpbWUgcGFydFxuICAqL1xuZnVuY3Rpb24gbm9UaW1lUGFydChkYXRlKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBkYXRlID09PSAnc3RyaW5nJyAmJiBkYXRlLmxlbmd0aCA8PSAxMDtcbn1cblxuLyoqXG4gKiBDb3B5IHRpbWUgZnJvbSBvbmUgZGF0ZSB0byBhbm90aGVyXG4gKi9cbmZ1bmN0aW9uIGNvcHlUaW1lKHRvRGF0ZSwgZnJvbURhdGUpIHtcbiAgICB0b0RhdGUuc2V0VVRDSG91cnMoZnJvbURhdGUuZ2V0VVRDSG91cnMoKSwgZnJvbURhdGUuZ2V0VVRDTWludXRlcygpLCBmcm9tRGF0ZS5nZXRVVENTZWNvbmRzKCksIDApO1xuXG4gICAgcmV0dXJuIHRvRGF0ZTtcbn1cblxuLyoqXG4gKiBHZXQgZHVyYXRpb24gdmFsdWUgaW4gc2Vjb25kcyBvciBkZWZhdWx0IHZhbHVlIGlmIGR1cmF0aW9uIGlzIHVuZGVmaW5lZFxuICovXG5mdW5jdGlvbiB0b1NlY29uZHMoZHVyYXRpb24sIGRlZmF1bHRWYWx1ZSA9IDApIHtcbiAgICByZXR1cm4gZHVyYXRpb24/LnNlY29uZHMgPz8gZGVmYXVsdFZhbHVlO1xufVxuXG4vKipcbiAqIFByaXZhdGUgZnVuY3Rpb25zXG4gKi9cblxuZnVuY3Rpb24gX2Zyb21Mb2NhbERhdGUoZGF0ZSkge1xuICAgIHJldHVybiBuZXcgRGF0ZShEYXRlLlVUQyhcbiAgICAgICAgZGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgICAgICBkYXRlLmdldE1vbnRoKCksXG4gICAgICAgIGRhdGUuZ2V0RGF0ZSgpLFxuICAgICAgICBkYXRlLmdldEhvdXJzKCksXG4gICAgICAgIGRhdGUuZ2V0TWludXRlcygpLFxuICAgICAgICBkYXRlLmdldFNlY29uZHMoKVxuICAgICkpO1xufVxuXG5mdW5jdGlvbiBfZnJvbUlTT1N0cmluZyhzdHIpIHtcbiAgICBjb25zdCBwYXJ0cyA9IHN0ci5tYXRjaCgvXFxkKy9nKTtcbiAgICByZXR1cm4gbmV3IERhdGUoRGF0ZS5VVEMoXG4gICAgICAgIE51bWJlcihwYXJ0c1swXSksXG4gICAgICAgIE51bWJlcihwYXJ0c1sxXSkgLSAxLFxuICAgICAgICBOdW1iZXIocGFydHNbMl0pLFxuICAgICAgICBOdW1iZXIocGFydHNbM10gfHwgMCksXG4gICAgICAgIE51bWJlcihwYXJ0c1s0XSB8fCAwKSxcbiAgICAgICAgTnVtYmVyKHBhcnRzWzVdIHx8IDApXG4gICAgKSk7XG59XG5cbmZ1bmN0aW9uIGRlYm91bmNlKGZuLCBoYW5kbGUsIHF1ZXVlU3RvcmUpIHtcbiAgICBxdWV1ZVN0b3JlLnVwZGF0ZShxdWV1ZSA9PiBxdWV1ZS5zZXQoaGFuZGxlLCBmbikpO1xufVxuXG5mdW5jdGlvbiBmbHVzaERlYm91bmNlKHF1ZXVlKSB7XG4gICAgcnVuX2FsbChxdWV1ZSk7XG4gICAgcXVldWUuY2xlYXIoKTtcbn1cblxuZnVuY3Rpb24gdGFzayhmbiwgaGFuZGxlLCB0YXNrcykge1xuICAgIGhhbmRsZSA/Pz0gZm47XG4gICAgaWYgKCF0YXNrcy5oYXMoaGFuZGxlKSkge1xuICAgICAgICB0YXNrcy5zZXQoaGFuZGxlLCBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRhc2tzLmRlbGV0ZShoYW5kbGUpO1xuICAgICAgICAgICAgZm4oKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gYXNzaWduKC4uLmFyZ3MpIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbiguLi5hcmdzKTtcbn1cblxuZnVuY3Rpb24ga2V5cyhvYmplY3QpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqZWN0KTtcbn1cblxuZnVuY3Rpb24gZmxvb3IodmFsdWUpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcih2YWx1ZSk7XG59XG5cbmZ1bmN0aW9uIGNlaWwodmFsdWUpIHtcbiAgICByZXR1cm4gTWF0aC5jZWlsKHZhbHVlKTtcbn1cblxuZnVuY3Rpb24gbWluKC4uLmFyZ3MpIHtcbiAgICByZXR1cm4gTWF0aC5taW4oLi4uYXJncyk7XG59XG5cbmZ1bmN0aW9uIG1heCguLi5hcmdzKSB7XG4gICAgcmV0dXJuIE1hdGgubWF4KC4uLmFyZ3MpO1xufVxuXG5mdW5jdGlvbiBzeW1ib2woKSB7XG4gICAgcmV0dXJuIFN5bWJvbCgnZWMnKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRWxlbWVudCh0YWcsIGNsYXNzTmFtZSwgY29udGVudCwgYXR0cnMgPSBbXSkge1xuICAgIGxldCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICBlbC5jbGFzc05hbWUgPSBjbGFzc05hbWU7XG4gICAgaWYgKHR5cGVvZiBjb250ZW50ID09ICdzdHJpbmcnKSB7XG4gICAgICAgIGVsLmlubmVyVGV4dCA9IGNvbnRlbnQ7XG4gICAgfSBlbHNlIGlmIChjb250ZW50LmRvbU5vZGVzKSB7XG4gICAgICAgIGVsLnJlcGxhY2VDaGlsZHJlbiguLi5jb250ZW50LmRvbU5vZGVzKTtcbiAgICB9IGVsc2UgaWYgKGNvbnRlbnQuaHRtbCkge1xuICAgICAgICBlbC5pbm5lckhUTUwgPSBjb250ZW50Lmh0bWw7XG4gICAgfVxuICAgIGZvciAobGV0IGF0dHIgb2YgYXR0cnMpIHtcbiAgICAgICAgZWwuc2V0QXR0cmlidXRlKC4uLmF0dHIpO1xuICAgIH1cbiAgICByZXR1cm4gZWw7XG59XG5cbmZ1bmN0aW9uIGhhc1lTY3JvbGwoZWwpIHtcbiAgICByZXR1cm4gZWwuc2Nyb2xsSGVpZ2h0ID4gZWwuY2xpZW50SGVpZ2h0O1xufVxuXG5mdW5jdGlvbiByZWN0KGVsKSB7XG4gICAgcmV0dXJuIGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xufVxuXG5mdW5jdGlvbiBhbmNlc3RvcihlbCwgdXApIHtcbiAgICB3aGlsZSAodXAtLSkge1xuICAgICAgICBlbCA9IGVsLnBhcmVudEVsZW1lbnQ7XG4gICAgfVxuICAgIHJldHVybiBlbDtcbn1cblxuZnVuY3Rpb24gaGVpZ2h0KGVsKSB7XG4gICAgcmV0dXJuIHJlY3QoZWwpLmhlaWdodDtcbn1cblxubGV0IHBheWxvYWRQcm9wID0gc3ltYm9sKCk7XG5mdW5jdGlvbiBzZXRQYXlsb2FkKGVsLCBwYXlsb2FkKSB7XG4gICAgZWxbcGF5bG9hZFByb3BdID0gcGF5bG9hZDtcbn1cblxuZnVuY3Rpb24gaGFzUGF5bG9hZChlbCkge1xuICAgIHJldHVybiAhIWVsPy5bcGF5bG9hZFByb3BdO1xufVxuXG5mdW5jdGlvbiBnZXRQYXlsb2FkKGVsKSB7XG4gICAgcmV0dXJuIGVsW3BheWxvYWRQcm9wXTtcbn1cblxuZnVuY3Rpb24gZ2V0RWxlbWVudFdpdGhQYXlsb2FkKHgsIHksIHJvb3QgPSBkb2N1bWVudCkge1xuICAgIGZvciAobGV0IGVsIG9mIHJvb3QuZWxlbWVudHNGcm9tUG9pbnQoeCwgeSkpIHtcbiAgICAgICAgaWYgKGhhc1BheWxvYWQoZWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gZWw7XG4gICAgICAgIH1cbiAgICAgICAgLyoqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3ZrdXJrby9jYWxlbmRhci9pc3N1ZXMvMTQyICovXG4gICAgICAgIGlmIChlbC5zaGFkb3dSb290KSB7XG4gICAgICAgICAgICBsZXQgc2hhZG93RWwgPSBnZXRFbGVtZW50V2l0aFBheWxvYWQoeCwgeSwgZWwuc2hhZG93Um9vdCk7XG4gICAgICAgICAgICBpZiAoc2hhZG93RWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2hhZG93RWw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVZpZXcodmlldywgX3ZpZXdUaXRsZSwgX2N1cnJlbnRSYW5nZSwgX2FjdGl2ZVJhbmdlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogdmlldyxcbiAgICAgICAgdGl0bGU6IF92aWV3VGl0bGUsXG4gICAgICAgIGN1cnJlbnRTdGFydDogX2N1cnJlbnRSYW5nZS5zdGFydCxcbiAgICAgICAgY3VycmVudEVuZDogX2N1cnJlbnRSYW5nZS5lbmQsXG4gICAgICAgIGFjdGl2ZVN0YXJ0OiBfYWN0aXZlUmFuZ2Uuc3RhcnQsXG4gICAgICAgIGFjdGl2ZUVuZDogX2FjdGl2ZVJhbmdlLmVuZCxcbiAgICAgICAgY2FsZW5kYXI6IHVuZGVmaW5lZFxuICAgIH07XG59XG5cbmZ1bmN0aW9uIHRvVmlld1dpdGhMb2NhbERhdGVzKHZpZXcpIHtcbiAgICB2aWV3ID0gYXNzaWduKHt9LCB2aWV3KTtcbiAgICB2aWV3LmN1cnJlbnRTdGFydCA9IHRvTG9jYWxEYXRlKHZpZXcuY3VycmVudFN0YXJ0KTtcbiAgICB2aWV3LmN1cnJlbnRFbmQgPSB0b0xvY2FsRGF0ZSh2aWV3LmN1cnJlbnRFbmQpO1xuICAgIHZpZXcuYWN0aXZlU3RhcnQgPSB0b0xvY2FsRGF0ZSh2aWV3LmFjdGl2ZVN0YXJ0KTtcbiAgICB2aWV3LmFjdGl2ZUVuZCA9IHRvTG9jYWxEYXRlKHZpZXcuYWN0aXZlRW5kKTtcblxuICAgIHJldHVybiB2aWV3O1xufVxuXG5mdW5jdGlvbiBsaXN0Vmlldyh2aWV3KSB7XG4gICAgcmV0dXJuIHZpZXcuc3RhcnRzV2l0aCgnbGlzdCcpO1xufVxuXG5mdW5jdGlvbiB0aW1lbGluZVZpZXcodmlldykge1xuICAgIHJldHVybiB2aWV3LmluY2x1ZGVzKCdUaW1lbGluZScpO1xufVxuXG5sZXQgZXZlbnRJZCA9IDE7XG5mdW5jdGlvbiBjcmVhdGVFdmVudHMoaW5wdXQpIHtcbiAgICByZXR1cm4gaW5wdXQubWFwKGV2ZW50ID0+IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgIGlkOiAnaWQnIGluIGV2ZW50ID8gU3RyaW5nKGV2ZW50LmlkKSA6IGB7Z2VuZXJhdGVkLSR7ZXZlbnRJZCsrfX1gLFxuICAgICAgICAgICAgcmVzb3VyY2VJZHM6IEFycmF5LmlzQXJyYXkoZXZlbnQucmVzb3VyY2VJZHMpXG4gICAgICAgICAgICAgICAgPyBldmVudC5yZXNvdXJjZUlkcy5tYXAoU3RyaW5nKVxuICAgICAgICAgICAgICAgIDogKCdyZXNvdXJjZUlkJyBpbiBldmVudCA/IFtTdHJpbmcoZXZlbnQucmVzb3VyY2VJZCldIDogW10pLFxuICAgICAgICAgICAgYWxsRGF5OiBldmVudC5hbGxEYXkgPz8gKG5vVGltZVBhcnQoZXZlbnQuc3RhcnQpICYmIG5vVGltZVBhcnQoZXZlbnQuZW5kKSksXG4gICAgICAgICAgICBzdGFydDogY3JlYXRlRGF0ZShldmVudC5zdGFydCksXG4gICAgICAgICAgICBlbmQ6IGNyZWF0ZURhdGUoZXZlbnQuZW5kKSxcbiAgICAgICAgICAgIHRpdGxlOiBldmVudC50aXRsZSB8fCAnJyxcbiAgICAgICAgICAgIHRpdGxlSFRNTDogZXZlbnQudGl0bGVIVE1MIHx8ICcnLFxuICAgICAgICAgICAgZWRpdGFibGU6IGV2ZW50LmVkaXRhYmxlLFxuICAgICAgICAgICAgc3RhcnRFZGl0YWJsZTogZXZlbnQuc3RhcnRFZGl0YWJsZSxcbiAgICAgICAgICAgIGR1cmF0aW9uRWRpdGFibGU6IGV2ZW50LmR1cmF0aW9uRWRpdGFibGUsXG4gICAgICAgICAgICBkaXNwbGF5OiBldmVudC5kaXNwbGF5IHx8ICdhdXRvJyxcbiAgICAgICAgICAgIGV4dGVuZGVkUHJvcHM6IGV2ZW50LmV4dGVuZGVkUHJvcHMgfHwge30sXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGV2ZW50LmJhY2tncm91bmRDb2xvciB8fCBldmVudC5jb2xvcixcbiAgICAgICAgICAgIHRleHRDb2xvcjogZXZlbnQudGV4dENvbG9yXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHJlc3VsdC5hbGxEYXkpIHtcbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBhbGwtZGF5IGV2ZW50cyBzdGFydCBhbmQgZW5kIGF0IG1pZG5pZ2h0XG4gICAgICAgICAgICBzZXRNaWRuaWdodChyZXN1bHQuc3RhcnQpO1xuICAgICAgICAgICAgbGV0IGVuZCA9IGNsb25lRGF0ZShyZXN1bHQuZW5kKTtcbiAgICAgICAgICAgIHNldE1pZG5pZ2h0KHJlc3VsdC5lbmQpO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICFkYXRlc0VxdWFsKHJlc3VsdC5lbmQsIGVuZCkgfHxcbiAgICAgICAgICAgICAgICBkYXRlc0VxdWFsKHJlc3VsdC5lbmQsIHJlc3VsdC5zdGFydCkgIC8qKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS92a3Vya28vY2FsZW5kYXIvaXNzdWVzLzUwICovXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBhZGREYXkocmVzdWx0LmVuZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVFdmVudFNvdXJjZXMoaW5wdXQpIHtcbiAgICByZXR1cm4gaW5wdXQubWFwKHNvdXJjZSA9PiAoe1xuICAgICAgICBldmVudHM6IHNvdXJjZS5ldmVudHMsXG4gICAgICAgIHVybDogKHNvdXJjZS51cmwgJiYgc291cmNlLnVybC50cmltRW5kKCcmJykpIHx8ICcnLFxuICAgICAgICBtZXRob2Q6IChzb3VyY2UubWV0aG9kICYmIHNvdXJjZS5tZXRob2QudG9VcHBlckNhc2UoKSkgfHwgJ0dFVCcsXG4gICAgICAgIGV4dHJhUGFyYW1zOiBzb3VyY2UuZXh0cmFQYXJhbXMgfHwge31cbiAgICB9KSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUV2ZW50Q2h1bmsoZXZlbnQsIHN0YXJ0LCBlbmQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBzdGFydDogZXZlbnQuc3RhcnQgPiBzdGFydCA/IGV2ZW50LnN0YXJ0IDogc3RhcnQsXG4gICAgICAgIGVuZDogZXZlbnQuZW5kIDwgZW5kID8gZXZlbnQuZW5kIDogZW5kLFxuICAgICAgICBldmVudFxuICAgIH07XG59XG5cbmZ1bmN0aW9uIHNvcnRFdmVudENodW5rcyhjaHVua3MpIHtcbiAgICAvLyBTb3J0IGJ5IHN0YXJ0IGRhdGUgKGFsbC1kYXkgZXZlbnRzIGFsd2F5cyBvbiB0b3ApXG4gICAgY2h1bmtzLnNvcnQoKGEsIGIpID0+IGEuc3RhcnQgLSBiLnN0YXJ0IHx8IGIuZXZlbnQuYWxsRGF5IC0gYS5ldmVudC5hbGxEYXkpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVFdmVudENvbnRlbnQoY2h1bmssIGRpc3BsYXlFdmVudEVuZCwgZXZlbnRDb250ZW50LCB0aGVtZSwgX2ludGxFdmVudFRpbWUsIF92aWV3KSB7XG4gICAgbGV0IHRpbWVUZXh0ID0gX2ludGxFdmVudFRpbWUuZm9ybWF0UmFuZ2UoXG4gICAgICAgIGNodW5rLnN0YXJ0LFxuICAgICAgICBkaXNwbGF5RXZlbnRFbmQgJiYgY2h1bmsuZXZlbnQuZGlzcGxheSAhPT0gJ3BvaW50ZXInXG4gICAgICAgICAgICA/IGNvcHlUaW1lKGNsb25lRGF0ZShjaHVuay5zdGFydCksIGNodW5rLmVuZCkgIC8vIG1ha2UgSW50bC5mb3JtYXRSYW5nZSBvdXRwdXQgb25seSB0aGUgdGltZSBwYXJ0XG4gICAgICAgICAgICA6IGNodW5rLnN0YXJ0XG4gICAgKTtcbiAgICBsZXQgY29udGVudDtcblxuICAgIGlmIChldmVudENvbnRlbnQpIHtcbiAgICAgICAgY29udGVudCA9IGlzX2Z1bmN0aW9uKGV2ZW50Q29udGVudClcbiAgICAgICAgICAgID8gZXZlbnRDb250ZW50KHtcbiAgICAgICAgICAgICAgICBldmVudDogdG9FdmVudFdpdGhMb2NhbERhdGVzKGNodW5rLmV2ZW50KSxcbiAgICAgICAgICAgICAgICB0aW1lVGV4dCxcbiAgICAgICAgICAgICAgICB2aWV3OiB0b1ZpZXdXaXRoTG9jYWxEYXRlcyhfdmlldylcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA6IGV2ZW50Q29udGVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgZG9tTm9kZXM7XG4gICAgICAgIHN3aXRjaCAoY2h1bmsuZXZlbnQuZGlzcGxheSkge1xuICAgICAgICAgICAgY2FzZSAnYmFja2dyb3VuZCc6XG4gICAgICAgICAgICAgICAgZG9tTm9kZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3BvaW50ZXInOlxuICAgICAgICAgICAgICAgIGRvbU5vZGVzID0gW2NyZWF0ZVRpbWVFbGVtZW50KHRpbWVUZXh0LCBjaHVuaywgdGhlbWUpXTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgZG9tTm9kZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgIC4uLmNodW5rLmV2ZW50LmFsbERheSA/IFtdIDogW2NyZWF0ZVRpbWVFbGVtZW50KHRpbWVUZXh0LCBjaHVuaywgdGhlbWUpXSxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlRWxlbWVudCgnaDQnLCB0aGVtZS5ldmVudFRpdGxlLCBjaHVuay5ldmVudC50aXRsZSlcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRlbnQgPSB7ZG9tTm9kZXN9O1xuICAgIH1cblxuICAgIHJldHVybiBbdGltZVRleHQsIGNvbnRlbnRdO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUaW1lRWxlbWVudCh0aW1lVGV4dCwgY2h1bmssIHRoZW1lKSB7XG4gICAgcmV0dXJuIGNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICd0aW1lJyxcbiAgICAgICAgdGhlbWUuZXZlbnRUaW1lLFxuICAgICAgICB0aW1lVGV4dCxcbiAgICAgICAgW1snZGF0ZXRpbWUnLCB0b0lTT1N0cmluZyhjaHVuay5zdGFydCldXVxuICAgICk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUV2ZW50Q2xhc3NlcyhldmVudENsYXNzTmFtZXMsIGV2ZW50LCBfdmlldykge1xuICAgIGlmIChldmVudENsYXNzTmFtZXMpIHtcbiAgICAgICAgaWYgKGlzX2Z1bmN0aW9uKGV2ZW50Q2xhc3NOYW1lcykpIHtcbiAgICAgICAgICAgIGV2ZW50Q2xhc3NOYW1lcyA9IGV2ZW50Q2xhc3NOYW1lcyh7XG4gICAgICAgICAgICAgICAgZXZlbnQ6IHRvRXZlbnRXaXRoTG9jYWxEYXRlcyhldmVudCksXG4gICAgICAgICAgICAgICAgdmlldzogdG9WaWV3V2l0aExvY2FsRGF0ZXMoX3ZpZXcpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShldmVudENsYXNzTmFtZXMpID8gZXZlbnRDbGFzc05hbWVzIDogW2V2ZW50Q2xhc3NOYW1lc107XG4gICAgfVxuICAgIHJldHVybiBbXTtcbn1cblxuZnVuY3Rpb24gdG9FdmVudFdpdGhMb2NhbERhdGVzKGV2ZW50KSB7XG4gICAgcmV0dXJuIF9jbG9uZUV2ZW50KGV2ZW50LCB0b0xvY2FsRGF0ZSk7XG59XG5cbmZ1bmN0aW9uIGNsb25lRXZlbnQoZXZlbnQpIHtcbiAgICByZXR1cm4gX2Nsb25lRXZlbnQoZXZlbnQsIGNsb25lRGF0ZSk7XG59XG5cbmZ1bmN0aW9uIF9jbG9uZUV2ZW50KGV2ZW50LCBkYXRlRm4pIHtcbiAgICBldmVudCA9IGFzc2lnbih7fSwgZXZlbnQpO1xuICAgIGV2ZW50LnN0YXJ0ID0gZGF0ZUZuKGV2ZW50LnN0YXJ0KTtcbiAgICBldmVudC5lbmQgPSBkYXRlRm4oZXZlbnQuZW5kKTtcblxuICAgIHJldHVybiBldmVudDtcbn1cblxuLyoqXG4gKiBQcmVwYXJlIGV2ZW50IGNodW5rcyBmb3IgbW9udGggdmlldyBhbmQgYWxsLWRheSBzbG90IGluIHdlZWsgdmlld1xuICovXG5mdW5jdGlvbiBwcmVwYXJlRXZlbnRDaHVua3MoY2h1bmtzLCBoaWRkZW5EYXlzKSB7XG4gICAgbGV0IGxvbmdDaHVua3MgPSB7fTtcblxuICAgIGlmIChjaHVua3MubGVuZ3RoKSB7XG4gICAgICAgIHNvcnRFdmVudENodW5rcyhjaHVua3MpO1xuXG4gICAgICAgIGxldCBwcmV2Q2h1bms7XG4gICAgICAgIGZvciAobGV0IGNodW5rIG9mIGNodW5rcykge1xuICAgICAgICAgICAgbGV0IGRhdGVzID0gW107XG4gICAgICAgICAgICBsZXQgZGF0ZSA9IHNldE1pZG5pZ2h0KGNsb25lRGF0ZShjaHVuay5zdGFydCkpO1xuICAgICAgICAgICAgd2hpbGUgKGNodW5rLmVuZCA+IGRhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWhpZGRlbkRheXMuaW5jbHVkZXMoZGF0ZS5nZXRVVENEYXkoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0ZXMucHVzaChjbG9uZURhdGUoZGF0ZSkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0ZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGtleSA9IGRhdGUuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvbmdDaHVua3Nba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdDaHVua3Nba2V5XS5jaHVua3MucHVzaChjaHVuayk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdDaHVua3Nba2V5XSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtzOiBbY2h1bmtdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhZGREYXkoZGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGF0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY2h1bmsuZGF0ZSA9IGRhdGVzWzBdO1xuICAgICAgICAgICAgICAgIGNodW5rLmRheXMgPSBkYXRlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgY2h1bmsuZGF0ZXMgPSBkYXRlcztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2h1bmsuZGF0ZSA9IHNldE1pZG5pZ2h0KGNsb25lRGF0ZShjaHVuay5zdGFydCkpO1xuICAgICAgICAgICAgICAgIGNodW5rLmRheXMgPSAxO1xuICAgICAgICAgICAgICAgIGNodW5rLmRhdGVzID0gW2NodW5rLmRhdGVdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJldkNodW5rICYmIGRhdGVzRXF1YWwocHJldkNodW5rLmRhdGUsIGNodW5rLmRhdGUpKSB7XG4gICAgICAgICAgICAgICAgY2h1bmsucHJldiA9IHByZXZDaHVuaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByZXZDaHVuayA9IGNodW5rO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGxvbmdDaHVua3M7XG59XG5cbmZ1bmN0aW9uIHJlcG9zaXRpb25FdmVudChjaHVuaywgbG9uZ0NodW5rcywgaGVpZ2h0KSB7XG4gICAgY2h1bmsudG9wID0gMDtcbiAgICBpZiAoY2h1bmsucHJldikge1xuICAgICAgICBjaHVuay50b3AgPSBjaHVuay5wcmV2LmJvdHRvbSArIDE7XG4gICAgfVxuICAgIGNodW5rLmJvdHRvbSA9IGNodW5rLnRvcCArIGhlaWdodDtcbiAgICBsZXQgbWFyZ2luID0gMTtcbiAgICBsZXQga2V5ID0gY2h1bmsuZGF0ZS5nZXRUaW1lKCk7XG4gICAgaWYgKGxvbmdDaHVua3Nba2V5XSkge1xuICAgICAgICBpZiAoIWxvbmdDaHVua3Nba2V5XS5zb3J0ZWQpIHtcbiAgICAgICAgICAgIGxvbmdDaHVua3Nba2V5XS5jaHVua3Muc29ydCgoYSwgYikgPT4gYS50b3AgLSBiLnRvcCk7XG4gICAgICAgICAgICBsb25nQ2h1bmtzW2tleV0uc29ydGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBsb25nQ2h1bmsgb2YgbG9uZ0NodW5rc1trZXldLmNodW5rcykge1xuICAgICAgICAgICAgaWYgKGNodW5rLnRvcCA8IGxvbmdDaHVuay5ib3R0b20gJiYgY2h1bmsuYm90dG9tID4gbG9uZ0NodW5rLnRvcCkge1xuICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgPSBsb25nQ2h1bmsuYm90dG9tIC0gY2h1bmsudG9wICsgMTtcbiAgICAgICAgICAgICAgICBtYXJnaW4gKz0gb2Zmc2V0O1xuICAgICAgICAgICAgICAgIGNodW5rLnRvcCArPSBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgY2h1bmsuYm90dG9tICs9IG9mZnNldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBtYXJnaW47XG59XG5cbmZ1bmN0aW9uIHJ1blJlcG9zaXRpb24ocmVmcywgZGF0YSkge1xuICAgIHJlZnMubGVuZ3RoID0gZGF0YS5sZW5ndGg7XG4gICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgIGZvciAobGV0IHJlZiBvZiByZWZzKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHJlZj8ucmVwb3NpdGlvbj8uKCkpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIENoZWNrIHdoZXRoZXIgdGhlIGV2ZW50IGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gZGF0ZSByYW5nZSBhbmQgcmVzb3VyY2VcbiAqIEBwYXJhbSBldmVudFxuICogQHBhcmFtIHN0YXJ0XG4gKiBAcGFyYW0gZW5kXG4gKiBAcGFyYW0gW3Jlc291cmNlXVxuICogQHJldHVybiBib29sZWFuXG4gKi9cbmZ1bmN0aW9uIGV2ZW50SW50ZXJzZWN0cyhldmVudCwgc3RhcnQsIGVuZCwgcmVzb3VyY2UpIHtcbiAgICByZXR1cm4gZXZlbnQuc3RhcnQgPCBlbmQgJiYgZXZlbnQuZW5kID4gc3RhcnQgJiYgKFxuICAgICAgICByZXNvdXJjZSA9PT0gdW5kZWZpbmVkIHx8IGV2ZW50LnJlc291cmNlSWRzLmluY2x1ZGVzKHJlc291cmNlLmlkKVxuICAgICk7XG59XG5cbmZ1bmN0aW9uIGhlbHBlckV2ZW50KGRpc3BsYXkpIHtcbiAgICByZXR1cm4gcHJldmlld0V2ZW50KGRpc3BsYXkpIHx8IGdob3N0RXZlbnQoZGlzcGxheSkgfHwgcG9pbnRlckV2ZW50KGRpc3BsYXkpO1xufVxuXG5mdW5jdGlvbiBiZ0V2ZW50KGRpc3BsYXkpIHtcbiAgICByZXR1cm4gZGlzcGxheSA9PT0gJ2JhY2tncm91bmQnO1xufVxuXG5mdW5jdGlvbiBwcmV2aWV3RXZlbnQoZGlzcGxheSkge1xuICAgIHJldHVybiBkaXNwbGF5ID09PSAncHJldmlldyc7XG59XG5cbmZ1bmN0aW9uIGdob3N0RXZlbnQoZGlzcGxheSkge1xuICAgIHJldHVybiBkaXNwbGF5ID09PSAnZ2hvc3QnO1xufVxuXG5mdW5jdGlvbiBwb2ludGVyRXZlbnQoZGlzcGxheSkge1xuICAgIHJldHVybiBkaXNwbGF5ID09PSAncG9pbnRlcic7XG59XG5cbmZ1bmN0aW9uIGJ0blRleHREYXkodGV4dCkge1xuICAgIHJldHVybiBidG5UZXh0KHRleHQsICdkYXknKTtcbn1cblxuZnVuY3Rpb24gYnRuVGV4dFdlZWsodGV4dCkge1xuICAgIHJldHVybiBidG5UZXh0KHRleHQsICd3ZWVrJyk7XG59XG5cbmZ1bmN0aW9uIGJ0blRleHRNb250aCh0ZXh0KSB7XG4gICAgcmV0dXJuIGJ0blRleHQodGV4dCwgJ21vbnRoJyk7XG59XG5cbmZ1bmN0aW9uIGJ0blRleHRZZWFyKHRleHQpIHtcbiAgICByZXR1cm4gYnRuVGV4dCh0ZXh0LCAneWVhcicpO1xufVxuXG5mdW5jdGlvbiBidG5UZXh0KHRleHQsIHBlcmlvZCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRleHQsXG4gICAgICAgIG5leHQ6ICdOZXh0ICcgKyBwZXJpb2QsXG4gICAgICAgIHByZXY6ICdQcmV2aW91cyAnICsgcGVyaW9kXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gdGhlbWVWaWV3KHZpZXcpIHtcbiAgICByZXR1cm4gdGhlbWUgPT4gKHsuLi50aGVtZSwgdmlld30pO1xufVxuXG5mdW5jdGlvbiBpbnRsKGxvY2FsZSwgZm9ybWF0KSB7XG4gICAgcmV0dXJuIGRlcml2ZWQoW2xvY2FsZSwgZm9ybWF0XSwgKFskbG9jYWxlLCAkZm9ybWF0XSkgPT4ge1xuICAgICAgICBsZXQgaW50bCA9IGlzX2Z1bmN0aW9uKCRmb3JtYXQpXG4gICAgICAgICAgICA/IHtmb3JtYXQ6ICRmb3JtYXR9XG4gICAgICAgICAgICA6IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KCRsb2NhbGUsICRmb3JtYXQpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZm9ybWF0OiBkYXRlID0+IGludGwuZm9ybWF0KHRvTG9jYWxEYXRlKGRhdGUpKVxuICAgICAgICB9O1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBpbnRsUmFuZ2UobG9jYWxlLCBmb3JtYXQpIHtcbiAgICByZXR1cm4gZGVyaXZlZChbbG9jYWxlLCBmb3JtYXRdLCAoWyRsb2NhbGUsICRmb3JtYXRdKSA9PiB7XG4gICAgICAgIGxldCBmb3JtYXRSYW5nZTtcbiAgICAgICAgaWYgKGlzX2Z1bmN0aW9uKCRmb3JtYXQpKSB7XG4gICAgICAgICAgICBmb3JtYXRSYW5nZSA9ICRmb3JtYXQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgaW50bCA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KCRsb2NhbGUsICRmb3JtYXQpO1xuICAgICAgICAgICAgZm9ybWF0UmFuZ2UgPSAoc3RhcnQsIGVuZCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChzdGFydCA8PSBlbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludGwuZm9ybWF0UmFuZ2Uoc3RhcnQsIGVuZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSW4gaU9TIDE2IGFuZCBvbGRlciwgaW50bC5mb3JtYXRSYW5nZSgpIHRocm93cyBhbiBleGNlcHRpb24gaWYgdGhlIHN0YXJ0IGRhdGUgaXMgbGF0ZXIgdGhhbiB0aGUgZW5kIGRhdGUuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZXJlZm9yZSwgd2UgZmlyc3Qgc3dhcCB0aGUgcGFyYW1ldGVycywgYW5kIHRoZW4gc3dhcCB0aGUgcmVzdWx0aW5nIHBhcnRzLlxuICAgICAgICAgICAgICAgICAgICAvKiogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vdmt1cmtvL2NhbGVuZGFyL2lzc3Vlcy8yMjcgKi9cbiAgICAgICAgICAgICAgICAgICAgbGV0IHBhcnRzID0gaW50bC5mb3JtYXRSYW5nZVRvUGFydHMoZW5kLCBzdGFydCk7XG4gICAgICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNvdXJjZXMgPSBbJ3N0YXJ0UmFuZ2UnLCAnZW5kUmFuZ2UnXTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHByb2Nlc3NlZCA9IFtmYWxzZSwgZmFsc2VdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBwYXJ0IG9mIHBhcnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaSA9IHNvdXJjZXMuaW5kZXhPZihwYXJ0LnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwcm9jZXNzZWRbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IF9nZXRQYXJ0cyhzb3VyY2VzWzEgLSBpXSwgcGFydHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWRbaV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhcnQudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmb3JtYXRSYW5nZTogKHN0YXJ0LCBlbmQpID0+IGZvcm1hdFJhbmdlKHRvTG9jYWxEYXRlKHN0YXJ0KSwgdG9Mb2NhbERhdGUoZW5kKSlcbiAgICAgICAgfTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gX2dldFBhcnRzKHNvdXJjZSwgcGFydHMpIHtcbiAgICBsZXQgcmVzdWx0ID0gJyc7XG4gICAgZm9yIChsZXQgcGFydCBvZiBwYXJ0cykge1xuICAgICAgICBpZiAocGFydC5zb3VyY2UgPT0gc291cmNlKSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gcGFydC52YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVUaW1lcyhkYXRlLCAkc2xvdER1cmF0aW9uLCAkX3Nsb3RUaW1lTGltaXRzLCAkX2ludGxTbG90TGFiZWwsICRfaW50bERheUhlYWRlckFMKSB7XG4gICAgZGF0ZSA9IGNsb25lRGF0ZShkYXRlKTtcbiAgICBsZXQgY29tcGFjdCA9ICRzbG90RHVyYXRpb24uc2Vjb25kcyA8IDM2MDA7XG4gICAgbGV0IHRpbWVzID0gW107XG4gICAgbGV0IGVuZCA9IGNsb25lRGF0ZShkYXRlKTtcbiAgICBsZXQgaSA9IDE7XG4gICAgYWRkRHVyYXRpb24oZGF0ZSwgJF9zbG90VGltZUxpbWl0cy5taW4pO1xuICAgIGFkZER1cmF0aW9uKGVuZCwgJF9zbG90VGltZUxpbWl0cy5tYXgpO1xuICAgIHdoaWxlIChkYXRlIDwgZW5kKSB7XG4gICAgICAgIHRpbWVzLnB1c2goW1xuICAgICAgICAgICAgdG9JU09TdHJpbmcoZGF0ZSksXG4gICAgICAgICAgICAkX2ludGxTbG90TGFiZWwuZm9ybWF0KGRhdGUpLFxuICAgICAgICAgICAgdGltZXMubGVuZ3RoICYmIChpIHx8ICFjb21wYWN0KSxcbiAgICAgICAgICAgICRfaW50bERheUhlYWRlckFMICYmICRfaW50bERheUhlYWRlckFMLmZvcm1hdChkYXRlKVxuICAgICAgICBdKTtcbiAgICAgICAgYWRkRHVyYXRpb24oZGF0ZSwgJHNsb3REdXJhdGlvbik7XG4gICAgICAgIGkgPSAxIC0gaTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGltZXM7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNsb3RUaW1lTGltaXRzKCRzbG90TWluVGltZSwgJHNsb3RNYXhUaW1lLCAkZmxleGlibGVTbG90VGltZUxpbWl0cywgJF92aWV3RGF0ZXMsICRfZXZlbnRzKSB7XG4gICAgbGV0IG1pbiQxID0gY3JlYXRlRHVyYXRpb24oJHNsb3RNaW5UaW1lKTtcbiAgICBsZXQgbWF4JDEgPSBjcmVhdGVEdXJhdGlvbigkc2xvdE1heFRpbWUpO1xuXG4gICAgaWYgKCRmbGV4aWJsZVNsb3RUaW1lTGltaXRzKSB7XG4gICAgICAgIC8vIElmIHNsb3RNYXhUaW1lIGdvZXMgcGFzdCBtaWRuaWdodCwgdGhlbiBleHRlbmQgaXQgYmFjayBieSBhIG1heGltdW0gb2YgMjQgaG91cnNcbiAgICAgICAgbGV0IG1pbk1pbiA9IGNyZWF0ZUR1cmF0aW9uKG1pbih0b1NlY29uZHMobWluJDEpLCBtYXgoMCwgdG9TZWNvbmRzKG1heCQxKSAtIERBWV9JTl9TRUNPTkRTKSkpO1xuICAgICAgICBsZXQgbWF4TWF4ID0gY3JlYXRlRHVyYXRpb24obWF4KHRvU2Vjb25kcyhtYXgkMSksIHRvU2Vjb25kcyhtaW5NaW4pICsgREFZX0lOX1NFQ09ORFMpKTtcbiAgICAgICAgbGV0IGZpbHRlciA9IGlzX2Z1bmN0aW9uKCRmbGV4aWJsZVNsb3RUaW1lTGltaXRzPy5ldmVudEZpbHRlcilcbiAgICAgICAgICAgID8gJGZsZXhpYmxlU2xvdFRpbWVMaW1pdHMuZXZlbnRGaWx0ZXJcbiAgICAgICAgICAgIDogZXZlbnQgPT4gIWJnRXZlbnQoZXZlbnQuZGlzcGxheSk7XG4gICAgICAgIGxvb3A6IGZvciAobGV0IGRhdGUgb2YgJF92aWV3RGF0ZXMpIHtcbiAgICAgICAgICAgIGxldCBzdGFydCA9IGFkZER1cmF0aW9uKGNsb25lRGF0ZShkYXRlKSwgbWluJDEpO1xuICAgICAgICAgICAgbGV0IGVuZCA9IGFkZER1cmF0aW9uKGNsb25lRGF0ZShkYXRlKSwgbWF4JDEpO1xuICAgICAgICAgICAgbGV0IG1pblN0YXJ0ID0gYWRkRHVyYXRpb24oY2xvbmVEYXRlKGRhdGUpLCBtaW5NaW4pO1xuICAgICAgICAgICAgbGV0IG1heEVuZCA9IGFkZER1cmF0aW9uKGNsb25lRGF0ZShkYXRlKSwgbWF4TWF4KTtcbiAgICAgICAgICAgIGZvciAobGV0IGV2ZW50IG9mICRfZXZlbnRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFldmVudC5hbGxEYXkgJiYgZmlsdGVyKGV2ZW50KSAmJiBldmVudC5zdGFydCA8IG1heEVuZCAmJiBldmVudC5lbmQgPiBtaW5TdGFydCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuc3RhcnQgPCBzdGFydCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNlY29uZHMgPSBtYXgoKGV2ZW50LnN0YXJ0IC0gZGF0ZSkgLyAxMDAwLCB0b1NlY29uZHMobWluTWluKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Vjb25kcyA8IHRvU2Vjb25kcyhtaW4kMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW4kMS5zZWNvbmRzID0gc2Vjb25kcztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZW5kID4gZW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2Vjb25kcyA9IG1pbigoZXZlbnQuZW5kIC0gZGF0ZSkgLyAxMDAwLCB0b1NlY29uZHMobWF4TWF4KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Vjb25kcyA+IHRvU2Vjb25kcyhtYXgkMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXgkMS5zZWNvbmRzID0gc2Vjb25kcztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodG9TZWNvbmRzKG1pbiQxKSA9PT0gdG9TZWNvbmRzKG1pbk1pbikgJiYgdG9TZWNvbmRzKG1heCQxKSA9PT0gdG9TZWNvbmRzKG1heE1heCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGxvb3A7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge21pbjogbWluJDEsIG1heDogbWF4JDF9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVPcHRpb25zKHBsdWdpbnMpIHtcbiAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgICAgYWxsRGF5Q29udGVudDogdW5kZWZpbmVkLFxuICAgICAgICBhbGxEYXlTbG90OiB0cnVlLFxuICAgICAgICBidXR0b25UZXh0OiB7XG4gICAgICAgICAgICB0b2RheTogJ3RvZGF5JyxcbiAgICAgICAgfSxcbiAgICAgICAgY3VzdG9tQnV0dG9uczoge30sXG4gICAgICAgIGRhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgIGRhdGVzU2V0OiB1bmRlZmluZWQsXG4gICAgICAgIGRheUhlYWRlckZvcm1hdDoge1xuICAgICAgICAgICAgd2Vla2RheTogJ3Nob3J0JyxcbiAgICAgICAgICAgIG1vbnRoOiAnbnVtZXJpYycsXG4gICAgICAgICAgICBkYXk6ICdudW1lcmljJ1xuICAgICAgICB9LFxuICAgICAgICBkYXlIZWFkZXJBcmlhTGFiZWxGb3JtYXQ6IHtcbiAgICAgICAgICAgIGRhdGVTdHlsZTogJ2xvbmcnXG4gICAgICAgIH0sXG4gICAgICAgIGRpc3BsYXlFdmVudEVuZDogdHJ1ZSxcbiAgICAgICAgZHVyYXRpb246IHt3ZWVrczogMX0sXG4gICAgICAgIGV2ZW50czogW10sXG4gICAgICAgIGV2ZW50QWxsVXBkYXRlZDogdW5kZWZpbmVkLFxuICAgICAgICBldmVudEJhY2tncm91bmRDb2xvcjogdW5kZWZpbmVkLFxuICAgICAgICBldmVudFRleHRDb2xvcjogdW5kZWZpbmVkLFxuICAgICAgICBldmVudENsYXNzTmFtZXM6IHVuZGVmaW5lZCxcbiAgICAgICAgZXZlbnRDbGljazogdW5kZWZpbmVkLFxuICAgICAgICBldmVudENvbG9yOiB1bmRlZmluZWQsXG4gICAgICAgIGV2ZW50Q29udGVudDogdW5kZWZpbmVkLFxuICAgICAgICBldmVudERpZE1vdW50OiB1bmRlZmluZWQsXG4gICAgICAgIGV2ZW50TW91c2VFbnRlcjogdW5kZWZpbmVkLFxuICAgICAgICBldmVudE1vdXNlTGVhdmU6IHVuZGVmaW5lZCxcbiAgICAgICAgZXZlbnRTb3VyY2VzOiBbXSxcbiAgICAgICAgZXZlbnRUaW1lRm9ybWF0OiB7XG4gICAgICAgICAgICBob3VyOiAnbnVtZXJpYycsXG4gICAgICAgICAgICBtaW51dGU6ICcyLWRpZ2l0J1xuICAgICAgICB9LFxuICAgICAgICBmaXJzdERheTogMCxcbiAgICAgICAgZmxleGlibGVTbG90VGltZUxpbWl0czogZmFsc2UsICAvLyBlYyBvcHRpb25cbiAgICAgICAgaGVhZGVyVG9vbGJhcjoge1xuICAgICAgICAgICAgc3RhcnQ6ICd0aXRsZScsXG4gICAgICAgICAgICBjZW50ZXI6ICcnLFxuICAgICAgICAgICAgZW5kOiAndG9kYXkgcHJldixuZXh0J1xuICAgICAgICB9LFxuICAgICAgICBoZWlnaHQ6IHVuZGVmaW5lZCxcbiAgICAgICAgaGlkZGVuRGF5czogW10sXG4gICAgICAgIGhpZ2hsaWdodGVkRGF0ZXM6IFtdLCAgLy8gZWMgb3B0aW9uXG4gICAgICAgIGxhenlGZXRjaGluZzogdHJ1ZSxcbiAgICAgICAgbG9hZGluZzogdW5kZWZpbmVkLFxuICAgICAgICBsb2NhbGU6IHVuZGVmaW5lZCxcbiAgICAgICAgbm93SW5kaWNhdG9yOiBmYWxzZSxcbiAgICAgICAgcmVzb3VyY2VMYWJlbENvbnRlbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgcmVzb3VyY2VMYWJlbERpZE1vdW50OiB1bmRlZmluZWQsXG4gICAgICAgIHJlc291cmNlczogW10sXG4gICAgICAgIHNlbGVjdGFibGU6IGZhbHNlLFxuICAgICAgICBzY3JvbGxUaW1lOiAnMDY6MDA6MDAnLFxuICAgICAgICBzbG90RHVyYXRpb246ICcwMDozMDowMCcsXG4gICAgICAgIHNsb3RFdmVudE92ZXJsYXA6IHRydWUsXG4gICAgICAgIHNsb3RIZWlnaHQ6IDI0LCAgLy8gZWMgb3B0aW9uXG4gICAgICAgIHNsb3RMYWJlbEZvcm1hdDoge1xuICAgICAgICAgICAgaG91cjogJ251bWVyaWMnLFxuICAgICAgICAgICAgbWludXRlOiAnMi1kaWdpdCdcbiAgICAgICAgfSxcbiAgICAgICAgc2xvdE1heFRpbWU6ICcyNDowMDowMCcsXG4gICAgICAgIHNsb3RNaW5UaW1lOiAnMDA6MDA6MDAnLFxuICAgICAgICBzbG90V2lkdGg6IDUyLFxuICAgICAgICB0aGVtZToge1xuICAgICAgICAgICAgYWxsRGF5OiAnZWMtYWxsLWRheScsXG4gICAgICAgICAgICBhY3RpdmU6ICdlYy1hY3RpdmUnLFxuICAgICAgICAgICAgYmdFdmVudDogJ2VjLWJnLWV2ZW50JyxcbiAgICAgICAgICAgIGJnRXZlbnRzOiAnZWMtYmctZXZlbnRzJyxcbiAgICAgICAgICAgIGJvZHk6ICdlYy1ib2R5JyxcbiAgICAgICAgICAgIGJ1dHRvbjogJ2VjLWJ1dHRvbicsXG4gICAgICAgICAgICBidXR0b25Hcm91cDogJ2VjLWJ1dHRvbi1ncm91cCcsXG4gICAgICAgICAgICBjYWxlbmRhcjogJ2VjJyxcbiAgICAgICAgICAgIGNvbXBhY3Q6ICdlYy1jb21wYWN0JyxcbiAgICAgICAgICAgIGNvbnRlbnQ6ICdlYy1jb250ZW50JyxcbiAgICAgICAgICAgIGRheTogJ2VjLWRheScsXG4gICAgICAgICAgICBkYXlIZWFkOiAnZWMtZGF5LWhlYWQnLFxuICAgICAgICAgICAgZGF5czogJ2VjLWRheXMnLFxuICAgICAgICAgICAgZXZlbnQ6ICdlYy1ldmVudCcsXG4gICAgICAgICAgICBldmVudEJvZHk6ICdlYy1ldmVudC1ib2R5JyxcbiAgICAgICAgICAgIGV2ZW50VGltZTogJ2VjLWV2ZW50LXRpbWUnLFxuICAgICAgICAgICAgZXZlbnRUaXRsZTogJ2VjLWV2ZW50LXRpdGxlJyxcbiAgICAgICAgICAgIGV2ZW50czogJ2VjLWV2ZW50cycsXG4gICAgICAgICAgICBleHRyYTogJ2VjLWV4dHJhJyxcbiAgICAgICAgICAgIGhhbmRsZTogJ2VjLWhhbmRsZScsXG4gICAgICAgICAgICBoZWFkZXI6ICdlYy1oZWFkZXInLFxuICAgICAgICAgICAgaGlkZGVuU2Nyb2xsOiAnZWMtaGlkZGVuLXNjcm9sbCcsXG4gICAgICAgICAgICBoaWdobGlnaHQ6ICdlYy1oaWdobGlnaHQnLFxuICAgICAgICAgICAgaWNvbjogJ2VjLWljb24nLFxuICAgICAgICAgICAgbGluZTogJ2VjLWxpbmUnLFxuICAgICAgICAgICAgbGluZXM6ICdlYy1saW5lcycsXG4gICAgICAgICAgICBub3dJbmRpY2F0b3I6ICdlYy1ub3ctaW5kaWNhdG9yJyxcbiAgICAgICAgICAgIG90aGVyTW9udGg6ICdlYy1vdGhlci1tb250aCcsXG4gICAgICAgICAgICByZXNvdXJjZTogJ2VjLXJlc291cmNlJyxcbiAgICAgICAgICAgIHNpZGViYXI6ICdlYy1zaWRlYmFyJyxcbiAgICAgICAgICAgIHNpZGViYXJUaXRsZTogJ2VjLXNpZGViYXItdGl0bGUnLFxuICAgICAgICAgICAgdG9kYXk6ICdlYy10b2RheScsXG4gICAgICAgICAgICB0aW1lOiAnZWMtdGltZScsXG4gICAgICAgICAgICB0aXRsZTogJ2VjLXRpdGxlJyxcbiAgICAgICAgICAgIHRvb2xiYXI6ICdlYy10b29sYmFyJyxcbiAgICAgICAgICAgIHZpZXc6ICcnLFxuICAgICAgICAgICAgd2Vla2RheXM6IFsnZWMtc3VuJywgJ2VjLW1vbicsICdlYy10dWUnLCAnZWMtd2VkJywgJ2VjLXRodScsICdlYy1mcmknLCAnZWMtc2F0J10sXG4gICAgICAgICAgICB3aXRoU2Nyb2xsOiAnZWMtd2l0aC1zY3JvbGwnXG4gICAgICAgIH0sXG4gICAgICAgIHRpdGxlRm9ybWF0OiB7XG4gICAgICAgICAgICB5ZWFyOiAnbnVtZXJpYycsXG4gICAgICAgICAgICBtb250aDogJ3Nob3J0JyxcbiAgICAgICAgICAgIGRheTogJ251bWVyaWMnXG4gICAgICAgIH0sXG4gICAgICAgIHZpZXc6IHVuZGVmaW5lZCxcbiAgICAgICAgdmlld0RpZE1vdW50OiB1bmRlZmluZWQsXG4gICAgICAgIHZpZXdzOiB7fVxuICAgIH07XG5cbiAgICBmb3IgKGxldCBwbHVnaW4gb2YgcGx1Z2lucykge1xuICAgICAgICBwbHVnaW4uY3JlYXRlT3B0aW9ucz8uKG9wdGlvbnMpO1xuICAgIH1cblxuICAgIHJldHVybiBvcHRpb25zO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVQYXJzZXJzKHBsdWdpbnMpIHtcbiAgICBsZXQgcGFyc2VycyA9IHtcbiAgICAgICAgZGF0ZTogZGF0ZSA9PiBzZXRNaWRuaWdodChjcmVhdGVEYXRlKGRhdGUpKSxcbiAgICAgICAgZHVyYXRpb246IGNyZWF0ZUR1cmF0aW9uLFxuICAgICAgICBldmVudHM6IGNyZWF0ZUV2ZW50cyxcbiAgICAgICAgZXZlbnRTb3VyY2VzOiBjcmVhdGVFdmVudFNvdXJjZXMsXG4gICAgICAgIGhpZGRlbkRheXM6IGRheXMgPT4gWy4uLm5ldyBTZXQoZGF5cyldLFxuICAgICAgICBoaWdobGlnaHRlZERhdGVzOiBkYXRlcyA9PiBkYXRlcy5tYXAoY3JlYXRlRGF0ZSksXG4gICAgICAgIHNjcm9sbFRpbWU6IGNyZWF0ZUR1cmF0aW9uLFxuICAgICAgICBzbG90RHVyYXRpb246IGNyZWF0ZUR1cmF0aW9uLFxuICAgICAgICBzbG90TWF4VGltZTogY3JlYXRlRHVyYXRpb24sXG4gICAgICAgIHNsb3RNaW5UaW1lOiBjcmVhdGVEdXJhdGlvblxuICAgIH07XG5cbiAgICBmb3IgKGxldCBwbHVnaW4gb2YgcGx1Z2lucykge1xuICAgICAgICBwbHVnaW4uY3JlYXRlUGFyc2Vycz8uKHBhcnNlcnMpO1xuICAgIH1cblxuICAgIHJldHVybiBwYXJzZXJzO1xufVxuXG5mdW5jdGlvbiBkaWZmKG9wdGlvbnMsIHByZXZPcHRpb25zKSB7XG4gICAgbGV0IGRpZmYgPSBbXTtcbiAgICBmb3IgKGxldCBrZXkgb2Yga2V5cyhvcHRpb25zKSkge1xuICAgICAgICBpZiAob3B0aW9uc1trZXldICE9PSBwcmV2T3B0aW9uc1trZXldKSB7XG4gICAgICAgICAgICBkaWZmLnB1c2goW2tleSwgb3B0aW9uc1trZXldXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXNzaWduKHByZXZPcHRpb25zLCBvcHRpb25zKTtcblxuICAgIHJldHVybiBkaWZmO1xufVxuXG5mdW5jdGlvbiBkYXlHcmlkKHN0YXRlKSB7XG4gICAgcmV0dXJuIGRlcml2ZWQoc3RhdGUudmlldywgJHZpZXcgPT4gJHZpZXc/LnN0YXJ0c1dpdGgoJ2RheUdyaWQnKSk7XG59XG5cbmZ1bmN0aW9uIGFjdGl2ZVJhbmdlKHN0YXRlKSB7XG4gICAgcmV0dXJuIGRlcml2ZWQoXG4gICAgICAgIFtzdGF0ZS5fY3VycmVudFJhbmdlLCBzdGF0ZS5maXJzdERheSwgc3RhdGUuc2xvdE1heFRpbWUsIHN0YXRlLl9kYXlHcmlkXSxcbiAgICAgICAgKFskX2N1cnJlbnRSYW5nZSwgJGZpcnN0RGF5LCAkc2xvdE1heFRpbWUsICRfZGF5R3JpZF0pID0+IHtcbiAgICAgICAgICAgIGxldCBzdGFydCA9IGNsb25lRGF0ZSgkX2N1cnJlbnRSYW5nZS5zdGFydCk7XG4gICAgICAgICAgICBsZXQgZW5kID0gY2xvbmVEYXRlKCRfY3VycmVudFJhbmdlLmVuZCk7XG5cbiAgICAgICAgICAgIGlmICgkX2RheUdyaWQpIHtcbiAgICAgICAgICAgICAgICAvLyBGaXJzdCBkYXkgb2Ygd2Vla1xuICAgICAgICAgICAgICAgIHByZXZDbG9zZXN0RGF5KHN0YXJ0LCAkZmlyc3REYXkpO1xuICAgICAgICAgICAgICAgIG5leHRDbG9zZXN0RGF5KGVuZCwgJGZpcnN0RGF5KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJHNsb3RNYXhUaW1lLmRheXMgfHwgJHNsb3RNYXhUaW1lLnNlY29uZHMgPiBEQVlfSU5fU0VDT05EUykge1xuICAgICAgICAgICAgICAgIGFkZER1cmF0aW9uKHN1YnRyYWN0RGF5KGVuZCksICRzbG90TWF4VGltZSk7XG4gICAgICAgICAgICAgICAgbGV0IHN0YXJ0MiA9IHN1YnRyYWN0RGF5KGNsb25lRGF0ZShlbmQpKTtcbiAgICAgICAgICAgICAgICBpZiAoc3RhcnQyIDwgc3RhcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBzdGFydDI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge3N0YXJ0LCBlbmR9O1xuICAgICAgICB9XG4gICAgKTtcbn1cblxuZnVuY3Rpb24gY3VycmVudFJhbmdlKHN0YXRlKSB7XG4gICAgcmV0dXJuIGRlcml2ZWQoXG4gICAgICAgIFtzdGF0ZS5kYXRlLCBzdGF0ZS5kdXJhdGlvbiwgc3RhdGUuZmlyc3REYXksIHN0YXRlLl9kYXlHcmlkXSxcbiAgICAgICAgKFskZGF0ZSwgJGR1cmF0aW9uLCAkZmlyc3REYXksICRfZGF5R3JpZF0pID0+IHtcbiAgICAgICAgICAgIGxldCBzdGFydCA9IGNsb25lRGF0ZSgkZGF0ZSksIGVuZDtcbiAgICAgICAgICAgIGlmICgkX2RheUdyaWQpIHtcbiAgICAgICAgICAgICAgICBzdGFydC5zZXRVVENEYXRlKDEpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkZHVyYXRpb24uaW5XZWVrcykge1xuICAgICAgICAgICAgICAgIC8vIEZpcnN0IGRheSBvZiB3ZWVrXG4gICAgICAgICAgICAgICAgcHJldkNsb3Nlc3REYXkoc3RhcnQsICRmaXJzdERheSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbmQgPSBhZGREdXJhdGlvbihjbG9uZURhdGUoc3RhcnQpLCAkZHVyYXRpb24pO1xuXG4gICAgICAgICAgICByZXR1cm4ge3N0YXJ0LCBlbmR9O1xuICAgICAgICB9XG4gICAgKTtcbn1cblxuZnVuY3Rpb24gdmlld0RhdGVzKHN0YXRlKSB7XG4gICAgcmV0dXJuIGRlcml2ZWQoW3N0YXRlLl9hY3RpdmVSYW5nZSwgc3RhdGUuaGlkZGVuRGF5c10sIChbJF9hY3RpdmVSYW5nZSwgJGhpZGRlbkRheXNdKSA9PiB7XG4gICAgICAgIGxldCBkYXRlcyA9IFtdO1xuICAgICAgICBsZXQgZGF0ZSA9IHNldE1pZG5pZ2h0KGNsb25lRGF0ZSgkX2FjdGl2ZVJhbmdlLnN0YXJ0KSk7XG4gICAgICAgIGxldCBlbmQgPSBzZXRNaWRuaWdodChjbG9uZURhdGUoJF9hY3RpdmVSYW5nZS5lbmQpKTtcbiAgICAgICAgd2hpbGUgKGRhdGUgPCBlbmQpIHtcbiAgICAgICAgICAgIGlmICghJGhpZGRlbkRheXMuaW5jbHVkZXMoZGF0ZS5nZXRVVENEYXkoKSkpIHtcbiAgICAgICAgICAgICAgICBkYXRlcy5wdXNoKGNsb25lRGF0ZShkYXRlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhZGREYXkoZGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkYXRlcy5sZW5ndGggJiYgJGhpZGRlbkRheXMubGVuZ3RoICYmICRoaWRkZW5EYXlzLmxlbmd0aCA8IDcpIHtcbiAgICAgICAgICAgIC8vIFRyeSB0byBtb3ZlIHRoZSBkYXRlXG4gICAgICAgICAgICBzdGF0ZS5kYXRlLnVwZGF0ZShkYXRlID0+IHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoJGhpZGRlbkRheXMuaW5jbHVkZXMoZGF0ZS5nZXRVVENEYXkoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkRGF5KGRhdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGF0ZXMgPSBnZXQoc3RhdGUuX3ZpZXdEYXRlcyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGF0ZXM7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHZpZXdUaXRsZShzdGF0ZSkge1xuICAgIHJldHVybiBkZXJpdmVkKFxuICAgICAgICBbc3RhdGUuZGF0ZSwgc3RhdGUuX2FjdGl2ZVJhbmdlLCBzdGF0ZS5faW50bFRpdGxlLCBzdGF0ZS5fZGF5R3JpZF0sXG4gICAgICAgIChbJGRhdGUsICRfYWN0aXZlUmFuZ2UsICRfaW50bFRpdGxlLCAkX2RheUdyaWRdKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gJF9kYXlHcmlkXG4gICAgICAgICAgICAgICAgPyAkX2ludGxUaXRsZS5mb3JtYXRSYW5nZSgkZGF0ZSwgJGRhdGUpXG4gICAgICAgICAgICAgICAgOiAkX2ludGxUaXRsZS5mb3JtYXRSYW5nZSgkX2FjdGl2ZVJhbmdlLnN0YXJ0LCBzdWJ0cmFjdERheShjbG9uZURhdGUoJF9hY3RpdmVSYW5nZS5lbmQpKSk7XG4gICAgICAgIH1cbiAgICApO1xufVxuXG5mdW5jdGlvbiB2aWV3KHN0YXRlKSB7XG4gICAgcmV0dXJuIGRlcml2ZWQoW3N0YXRlLnZpZXcsIHN0YXRlLl92aWV3VGl0bGUsIHN0YXRlLl9jdXJyZW50UmFuZ2UsIHN0YXRlLl9hY3RpdmVSYW5nZV0sIGFyZ3MgPT4gY3JlYXRlVmlldyguLi5hcmdzKSk7XG59XG5cbmZ1bmN0aW9uIGV2ZW50cyhzdGF0ZSkge1xuICAgIGxldCBfZXZlbnRzID0gd3JpdGFibGUoW10pO1xuICAgIGxldCBhYm9ydENvbnRyb2xsZXI7XG4gICAgbGV0IGZldGNoaW5nID0gMDtcbiAgICBsZXQgZGVib3VuY2VIYW5kbGUgPSB7fTtcbiAgICBkZXJpdmVkKFxuICAgICAgICBbc3RhdGUuZXZlbnRzLCBzdGF0ZS5ldmVudFNvdXJjZXMsIHN0YXRlLl9hY3RpdmVSYW5nZSwgc3RhdGUuX2ZldGNoZWRSYW5nZSwgc3RhdGUubGF6eUZldGNoaW5nLCBzdGF0ZS5sb2FkaW5nXSxcbiAgICAgICAgKHZhbHVlcywgc2V0KSA9PiBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICAgICAgICBsZXQgWyRldmVudHMsICRldmVudFNvdXJjZXMsICRfYWN0aXZlUmFuZ2UsICRfZmV0Y2hlZFJhbmdlLCAkbGF6eUZldGNoaW5nLCAkbG9hZGluZ10gPSB2YWx1ZXM7XG4gICAgICAgICAgICBpZiAoISRldmVudFNvdXJjZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgc2V0KCRldmVudHMpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIERvIG5vdCBmZXRjaCBpZiBuZXcgcmFuZ2UgaXMgd2l0aGluIHRoZSBwcmV2aW91cyBvbmVcbiAgICAgICAgICAgIGlmICghJF9mZXRjaGVkUmFuZ2Uuc3RhcnQgfHwgJF9mZXRjaGVkUmFuZ2Uuc3RhcnQgPiAkX2FjdGl2ZVJhbmdlLnN0YXJ0IHx8ICRfZmV0Y2hlZFJhbmdlLmVuZCA8ICRfYWN0aXZlUmFuZ2UuZW5kIHx8ICEkbGF6eUZldGNoaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFib3J0Q29udHJvbGxlcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBBYm9ydCBwcmV2aW91cyByZXF1ZXN0XG4gICAgICAgICAgICAgICAgICAgIGFib3J0Q29udHJvbGxlci5hYm9ydCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgbmV3IGFib3J0IGNvbnRyb2xsZXJcbiAgICAgICAgICAgICAgICBhYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgICAgICAgICAgICAgLy8gQ2FsbCBsb2FkaW5nIGhvb2tcbiAgICAgICAgICAgICAgICBpZiAoaXNfZnVuY3Rpb24oJGxvYWRpbmcpICYmICFmZXRjaGluZykge1xuICAgICAgICAgICAgICAgICAgICAkbG9hZGluZyh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IHN0b3BMb2FkaW5nID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoLS1mZXRjaGluZyA9PT0gMCAmJiBpc19mdW5jdGlvbigkbG9hZGluZykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgbGV0IGV2ZW50cyA9IFtdO1xuICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgaGFuZGxlcnNcbiAgICAgICAgICAgICAgICBsZXQgZmFpbHVyZSA9IGUgPT4gc3RvcExvYWRpbmcoKTtcbiAgICAgICAgICAgICAgICBsZXQgc3VjY2VzcyA9IGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KGNyZWF0ZUV2ZW50cyhkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgIHNldChldmVudHMpO1xuICAgICAgICAgICAgICAgICAgICBzdG9wTG9hZGluZygpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgLy8gUHJlcGFyZSBvdGhlciBzdHVmZlxuICAgICAgICAgICAgICAgIGxldCBzdGFydFN0ciA9IHRvSVNPU3RyaW5nKCRfYWN0aXZlUmFuZ2Uuc3RhcnQpO1xuICAgICAgICAgICAgICAgIGxldCBlbmRTdHIgPSB0b0lTT1N0cmluZygkX2FjdGl2ZVJhbmdlLmVuZCk7XG4gICAgICAgICAgICAgICAgLy8gTG9vcCBvdmVyIGV2ZW50IHNvdXJjZXNcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBzb3VyY2Ugb2YgJGV2ZW50U291cmNlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNfZnVuY3Rpb24oc291cmNlLmV2ZW50cykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV2ZW50cyBhcyBhIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gc291cmNlLmV2ZW50cyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IHRvTG9jYWxEYXRlKCRfYWN0aXZlUmFuZ2Uuc3RhcnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogdG9Mb2NhbERhdGUoJF9hY3RpdmVSYW5nZS5lbmQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0U3RyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZFN0clxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgc3VjY2VzcywgZmFpbHVyZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9taXNlLnJlc29sdmUocmVzdWx0KS50aGVuKHN1Y2Nlc3MsIGZhaWx1cmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXZlbnRzIGFzIGEgSlNPTiBmZWVkXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmVwYXJlIHBhcmFtc1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmFtcyA9IGlzX2Z1bmN0aW9uKHNvdXJjZS5leHRyYVBhcmFtcykgPyBzb3VyY2UuZXh0cmFQYXJhbXMoKSA6IGFzc2lnbih7fSwgc291cmNlLmV4dHJhUGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy5zdGFydCA9IHN0YXJ0U3RyO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmVuZCA9IGVuZFN0cjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgZmV0Y2hcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB1cmwgPSBzb3VyY2UudXJsLCBoZWFkZXJzID0ge30sIGJvZHk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoWydHRVQnLCAnSEVBRCddLmluY2x1ZGVzKHNvdXJjZS5tZXRob2QpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsICs9ICh1cmwuaW5jbHVkZXMoJz8nKSA/ICcmJyA6ICc/JykgKyBwYXJhbXM7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDtjaGFyc2V0PVVURi04JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5ID0gU3RyaW5nKHBhcmFtcyk7ICAvLyBTYWZhcmkgMTAuMSBkb2Vzbid0IGNvbnZlcnQgdG8gc3RyaW5nIGF1dG9tYXRpY2FsbHlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvIHRoZSBmZXRjaFxuICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2godXJsLCB7bWV0aG9kOiBzb3VyY2UubWV0aG9kLCBoZWFkZXJzLCBib2R5LCBzaWduYWw6IGFib3J0Q29udHJvbGxlci5zaWduYWwsIGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oc3VjY2VzcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZmFpbHVyZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKytmZXRjaGluZztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gU2F2ZSBjdXJyZW50IHJhbmdlIGZvciBmdXR1cmUgcmVxdWVzdHNcbiAgICAgICAgICAgICAgICAkX2ZldGNoZWRSYW5nZS5zdGFydCA9ICRfYWN0aXZlUmFuZ2Uuc3RhcnQ7XG4gICAgICAgICAgICAgICAgJF9mZXRjaGVkUmFuZ2UuZW5kID0gJF9hY3RpdmVSYW5nZS5lbmQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGRlYm91bmNlSGFuZGxlLCBzdGF0ZS5fcXVldWUpLFxuICAgICAgICBbXVxuICAgICkuc3Vic2NyaWJlKF9ldmVudHMuc2V0KTtcblxuICAgIHJldHVybiBfZXZlbnRzO1xufVxuXG5mdW5jdGlvbiBub3coKSB7XG4gICAgcmV0dXJuIHJlYWRhYmxlKGNyZWF0ZURhdGUoKSwgc2V0ID0+IHtcbiAgICAgICAgbGV0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgc2V0KGNyZWF0ZURhdGUoKSk7XG4gICAgICAgIH0sIDEwMDApO1xuXG4gICAgICAgIHJldHVybiAoKSA9PiBjbGVhckludGVydmFsKGludGVydmFsKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gdG9kYXkoc3RhdGUpIHtcbiAgICByZXR1cm4gZGVyaXZlZChzdGF0ZS5fbm93LCAkX25vdyA9PiBzZXRNaWRuaWdodChjbG9uZURhdGUoJF9ub3cpKSk7XG59XG5cbmNsYXNzIFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihwbHVnaW5zLCBpbnB1dCkge1xuICAgICAgICBwbHVnaW5zID0gcGx1Z2lucyB8fCBbXTtcblxuICAgICAgICAvLyBDcmVhdGUgb3B0aW9uc1xuICAgICAgICBsZXQgb3B0aW9ucyA9IGNyZWF0ZU9wdGlvbnMocGx1Z2lucyk7XG4gICAgICAgIGxldCBwYXJzZXJzID0gY3JlYXRlUGFyc2VycyhwbHVnaW5zKTtcblxuICAgICAgICAvLyBQYXJzZSBvcHRpb25zXG4gICAgICAgIG9wdGlvbnMgPSBwYXJzZU9wdHMob3B0aW9ucywgcGFyc2Vycyk7XG4gICAgICAgIGlucHV0ID0gcGFyc2VPcHRzKGlucHV0LCBwYXJzZXJzKTtcblxuICAgICAgICAvLyBDcmVhdGUgc3RvcmVzIGZvciBvcHRpb25zXG4gICAgICAgIGZvciAobGV0IFtvcHRpb24sIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhvcHRpb25zKSkge1xuICAgICAgICAgICAgdGhpc1tvcHRpb25dID0gd3JpdGFibGUodmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUHJpdmF0ZSBzdG9yZXNcbiAgICAgICAgdGhpcy5fcXVldWUgPSB3cml0YWJsZShuZXcgTWFwKCkpOyAgLy8gZGVib3VuY2UgcXVldWUgKGJlZm9yZVVwZGF0ZSlcbiAgICAgICAgdGhpcy5fcXVldWUyID0gd3JpdGFibGUobmV3IE1hcCgpKTsgIC8vIGRlYm91bmNlIHF1ZXVlIChhZnRlclVwZGF0ZSlcbiAgICAgICAgdGhpcy5fdGFza3MgPSBuZXcgTWFwKCk7ICAvLyB0aW1lb3V0IElEcyBmb3IgdGFza3NcbiAgICAgICAgdGhpcy5fYXV4aWxpYXJ5ID0gd3JpdGFibGUoW10pOyAgLy8gYXV4aWxpYXJ5IGNvbXBvbmVudHNcbiAgICAgICAgdGhpcy5fZGF5R3JpZCA9IGRheUdyaWQodGhpcyk7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRSYW5nZSA9IGN1cnJlbnRSYW5nZSh0aGlzKTtcbiAgICAgICAgdGhpcy5fYWN0aXZlUmFuZ2UgPSBhY3RpdmVSYW5nZSh0aGlzKTtcbiAgICAgICAgdGhpcy5fZmV0Y2hlZFJhbmdlID0gd3JpdGFibGUoe3N0YXJ0OiB1bmRlZmluZWQsIGVuZDogdW5kZWZpbmVkfSk7XG4gICAgICAgIHRoaXMuX2V2ZW50cyA9IGV2ZW50cyh0aGlzKTtcbiAgICAgICAgdGhpcy5fbm93ID0gbm93KCk7XG4gICAgICAgIHRoaXMuX3RvZGF5ID0gdG9kYXkodGhpcyk7XG4gICAgICAgIHRoaXMuX2ludGxFdmVudFRpbWUgPSBpbnRsUmFuZ2UodGhpcy5sb2NhbGUsIHRoaXMuZXZlbnRUaW1lRm9ybWF0KTtcbiAgICAgICAgdGhpcy5faW50bFNsb3RMYWJlbCA9IGludGwodGhpcy5sb2NhbGUsIHRoaXMuc2xvdExhYmVsRm9ybWF0KTtcbiAgICAgICAgdGhpcy5faW50bERheUhlYWRlciA9IGludGwodGhpcy5sb2NhbGUsIHRoaXMuZGF5SGVhZGVyRm9ybWF0KTtcbiAgICAgICAgdGhpcy5faW50bERheUhlYWRlckFMID0gaW50bCh0aGlzLmxvY2FsZSwgdGhpcy5kYXlIZWFkZXJBcmlhTGFiZWxGb3JtYXQpO1xuICAgICAgICB0aGlzLl9pbnRsVGl0bGUgPSBpbnRsUmFuZ2UodGhpcy5sb2NhbGUsIHRoaXMudGl0bGVGb3JtYXQpO1xuICAgICAgICB0aGlzLl9ib2R5RWwgPSB3cml0YWJsZSh1bmRlZmluZWQpO1xuICAgICAgICB0aGlzLl9zY3JvbGxhYmxlID0gd3JpdGFibGUoZmFsc2UpO1xuICAgICAgICB0aGlzLl92aWV3VGl0bGUgPSB2aWV3VGl0bGUodGhpcyk7XG4gICAgICAgIHRoaXMuX3ZpZXdEYXRlcyA9IHZpZXdEYXRlcyh0aGlzKTtcbiAgICAgICAgdGhpcy5fdmlldyA9IHZpZXcodGhpcyk7XG4gICAgICAgIHRoaXMuX3ZpZXdDb21wb25lbnQgPSB3cml0YWJsZSh1bmRlZmluZWQpO1xuICAgICAgICAvLyBSZXNvdXJjZXNcbiAgICAgICAgdGhpcy5fcmVzQmdDb2xvciA9IHdyaXRhYmxlKG5vb3ApO1xuICAgICAgICB0aGlzLl9yZXNUeHRDb2xvciA9IHdyaXRhYmxlKG5vb3ApO1xuICAgICAgICAvLyBJbnRlcmFjdGlvblxuICAgICAgICB0aGlzLl9pbnRlcmFjdGlvbiA9IHdyaXRhYmxlKHt9KTtcbiAgICAgICAgdGhpcy5faUV2ZW50cyA9IHdyaXRhYmxlKFtudWxsLCBudWxsXSk7ICAvLyBpbnRlcmFjdGlvbiBldmVudHM6IFtkcmFnL3Jlc2l6ZSwgcG9pbnRlcl1cbiAgICAgICAgdGhpcy5faUNsYXNzZXMgPSB3cml0YWJsZShpZGVudGl0eSk7ICAvLyBpbnRlcmFjdGlvbiBldmVudCBjc3MgY2xhc3Nlc1xuICAgICAgICB0aGlzLl9pQ2xhc3MgPSB3cml0YWJsZSh1bmRlZmluZWQpOyAgLy8gaW50ZXJhY3Rpb24gY3NzIGNsYXNzIGZvciBlbnRpcmUgY2FsZW5kYXJcblxuICAgICAgICAvLyBTZXQgJiBHZXRcbiAgICAgICAgdGhpcy5fc2V0ID0gKGtleSwgdmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmICh2YWxpZEtleShrZXksIHRoaXMpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlcnNba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlcnNba2V5XSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXNba2V5XS5zZXQodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9nZXQgPSBrZXkgPT4gdmFsaWRLZXkoa2V5LCB0aGlzKSA/IGdldCh0aGlzW2tleV0pIDogdW5kZWZpbmVkO1xuXG4gICAgICAgIC8vIExldCBwbHVnaW5zIGNyZWF0ZSB0aGVpciBwcml2YXRlIHN0b3Jlc1xuICAgICAgICBmb3IgKGxldCBwbHVnaW4gb2YgcGx1Z2lucykge1xuICAgICAgICAgICAgcGx1Z2luLmNyZWF0ZVN0b3Jlcz8uKHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlucHV0LnZpZXcpIHtcbiAgICAgICAgICAgIC8vIFNldCBpbml0aWFsIHZpZXcgYmFzZWQgb24gaW5wdXRcbiAgICAgICAgICAgIHRoaXMudmlldy5zZXQoaW5wdXQudmlldyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgb3B0aW9ucyBmb3IgZWFjaCB2aWV3XG4gICAgICAgIGxldCB2aWV3cyA9IG5ldyBTZXQoWy4uLmtleXMob3B0aW9ucy52aWV3cyksIC4uLmtleXMoaW5wdXQudmlld3MgPz8ge30pXSk7XG4gICAgICAgIGZvciAobGV0IHZpZXcgb2Ygdmlld3MpIHtcbiAgICAgICAgICAgIGxldCBkZWZPcHRzID0gbWVyZ2VPcHRzKG9wdGlvbnMsIG9wdGlvbnMudmlld3Nbdmlld10gPz8ge30pO1xuICAgICAgICAgICAgbGV0IG9wdHMgPSBtZXJnZU9wdHMoZGVmT3B0cywgaW5wdXQsIGlucHV0LnZpZXdzPy5bdmlld10gPz8ge30pO1xuICAgICAgICAgICAgbGV0IGNvbXBvbmVudCA9IG9wdHMuY29tcG9uZW50O1xuICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHdlIGRlYWwgd2l0aCB2YWxpZCBvcHRzIGZyb20gbm93IG9uXG4gICAgICAgICAgICBmaWx0ZXJPcHRzKG9wdHMsIHRoaXMpO1xuICAgICAgICAgICAgLy8gUHJvY2VzcyBvcHRpb25zXG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgb2Yga2V5cyhvcHRzKSkge1xuICAgICAgICAgICAgICAgIGxldCB7c2V0LCBfc2V0ID0gc2V0LCAuLi5yZXN0fSA9IHRoaXNba2V5XTtcblxuICAgICAgICAgICAgICAgIHRoaXNba2V5XSA9IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHZhbHVlIGluIGFsbCB2aWV3c1xuICAgICAgICAgICAgICAgICAgICBzZXQ6IFsnYnV0dG9uVGV4dCcsICd0aGVtZSddLmluY2x1ZGVzKGtleSlcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc19mdW5jdGlvbih2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHZhbHVlKGRlZk9wdHNba2V5XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdHNba2V5XSA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0KHNldCA9PT0gX3NldCA/IHJlc3VsdCA6IHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0KHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICA6IHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgX3NldCxcbiAgICAgICAgICAgICAgICAgICAgLi4ucmVzdFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBXaGVuIHZpZXcgY2hhbmdlcy4uLlxuICAgICAgICAgICAgdGhpcy52aWV3LnN1YnNjcmliZShuZXdWaWV3ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobmV3VmlldyA9PT0gdmlldykge1xuICAgICAgICAgICAgICAgICAgICAvLyBzd2l0Y2ggdmlldyBjb21wb25lbnRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdmlld0NvbXBvbmVudC5zZXQoY29tcG9uZW50KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzX2Z1bmN0aW9uKG9wdHMudmlld0RpZE1vdW50KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGljaygpLnRoZW4oKCkgPT4gb3B0cy52aWV3RGlkTW91bnQoZ2V0KHRoaXMuX3ZpZXcpKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHN0b3JlIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBrZXkgb2Yga2V5cyhvcHRzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1trZXldLl9zZXQob3B0c1trZXldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBwYXJzZU9wdHMob3B0cywgcGFyc2Vycykge1xuICAgIGxldCByZXN1bHQgPSB7Li4ub3B0c307XG4gICAgZm9yIChsZXQga2V5IG9mIGtleXMocGFyc2VycykpIHtcbiAgICAgICAgaWYgKGtleSBpbiByZXN1bHQpIHtcbiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gcGFyc2Vyc1trZXldKHJlc3VsdFtrZXldKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAob3B0cy52aWV3cykge1xuICAgICAgICByZXN1bHQudmlld3MgPSB7fTtcbiAgICAgICAgZm9yIChsZXQgdmlldyBvZiBrZXlzKG9wdHMudmlld3MpKSB7XG4gICAgICAgICAgICByZXN1bHQudmlld3Nbdmlld10gPSBwYXJzZU9wdHMob3B0cy52aWV3c1t2aWV3XSwgcGFyc2Vycyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gbWVyZ2VPcHRzKC4uLmFyZ3MpIHtcbiAgICBsZXQgcmVzdWx0ID0ge307XG4gICAgZm9yIChsZXQgb3B0cyBvZiBhcmdzKSB7XG4gICAgICAgIGxldCBvdmVycmlkZSA9IHt9O1xuICAgICAgICBmb3IgKGxldCBrZXkgb2YgWydidXR0b25UZXh0JywgJ3RoZW1lJ10pIHtcbiAgICAgICAgICAgIGlmIChpc19mdW5jdGlvbihvcHRzW2tleV0pKSB7XG4gICAgICAgICAgICAgICAgb3ZlcnJpZGVba2V5XSA9IG9wdHNba2V5XShyZXN1bHRba2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0ID0ge1xuICAgICAgICAgICAgLi4ucmVzdWx0LFxuICAgICAgICAgICAgLi4ub3B0cyxcbiAgICAgICAgICAgIC4uLm92ZXJyaWRlXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGZpbHRlck9wdHMob3B0cywgc3RhdGUpIHtcbiAgICBrZXlzKG9wdHMpXG4gICAgICAgIC5maWx0ZXIoa2V5ID0+ICF2YWxpZEtleShrZXksIHN0YXRlKSB8fCBrZXkgPT0gJ3ZpZXcnKVxuICAgICAgICAuZm9yRWFjaChrZXkgPT4gZGVsZXRlIG9wdHNba2V5XSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkS2V5KGtleSwgc3RhdGUpIHtcbiAgICByZXR1cm4gc3RhdGUuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBrZXlbMF0gIT09ICdfJztcbn1cblxuLyogcGFja2FnZXMvY29yZS9zcmMvQnV0dG9ucy5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjE2ICovXG5cbmZ1bmN0aW9uIGdldF9lYWNoX2NvbnRleHQkMihjdHgsIGxpc3QsIGkpIHtcblx0Y29uc3QgY2hpbGRfY3R4ID0gY3R4LnNsaWNlKCk7XG5cdGNoaWxkX2N0eFsyNV0gPSBsaXN0W2ldO1xuXHRyZXR1cm4gY2hpbGRfY3R4O1xufVxuXG4vLyAoNTc6MjcpIFxuZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrXzUoY3R4KSB7XG5cdGxldCBidXR0b25fMTtcblx0bGV0IHRfdmFsdWUgPSAvKiRidXR0b25UZXh0Ki8gY3R4WzVdWy8qYnV0dG9uKi8gY3R4WzI1XV0gKyBcIlwiO1xuXHRsZXQgdDtcblx0bGV0IGJ1dHRvbl8xX2NsYXNzX3ZhbHVlO1xuXHRsZXQgbW91bnRlZDtcblx0bGV0IGRpc3Bvc2U7XG5cblx0ZnVuY3Rpb24gY2xpY2tfaGFuZGxlcl8xKCkge1xuXHRcdHJldHVybiAvKmNsaWNrX2hhbmRsZXJfMSovIGN0eFsyMl0oLypidXR0b24qLyBjdHhbMjVdKTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0YygpIHtcblx0XHRcdGJ1dHRvbl8xID0gZWxlbWVudChcImJ1dHRvblwiKTtcblx0XHRcdHQgPSB0ZXh0KHRfdmFsdWUpO1xuXG5cdFx0XHRhdHRyKGJ1dHRvbl8xLCBcImNsYXNzXCIsIGJ1dHRvbl8xX2NsYXNzX3ZhbHVlID0gXCJcIiArICgvKiR0aGVtZSovIGN0eFszXS5idXR0b24gKyAoLyokdmlldyovIGN0eFs3XSA9PT0gLypidXR0b24qLyBjdHhbMjVdXG5cdFx0XHQ/ICcgJyArIC8qJHRoZW1lKi8gY3R4WzNdLmFjdGl2ZVxuXHRcdFx0OiAnJykgKyBcIiBlYy1cIiArIC8qYnV0dG9uKi8gY3R4WzI1XSkpO1xuXHRcdH0sXG5cdFx0bSh0YXJnZXQsIGFuY2hvcikge1xuXHRcdFx0aW5zZXJ0KHRhcmdldCwgYnV0dG9uXzEsIGFuY2hvcik7XG5cdFx0XHRhcHBlbmQoYnV0dG9uXzEsIHQpO1xuXG5cdFx0XHRpZiAoIW1vdW50ZWQpIHtcblx0XHRcdFx0ZGlzcG9zZSA9IGxpc3RlbihidXR0b25fMSwgXCJjbGlja1wiLCBjbGlja19oYW5kbGVyXzEpO1xuXHRcdFx0XHRtb3VudGVkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdHAobmV3X2N0eCwgZGlydHkpIHtcblx0XHRcdGN0eCA9IG5ld19jdHg7XG5cdFx0XHRpZiAoZGlydHkgJiAvKiRidXR0b25UZXh0LCBidXR0b25zKi8gMzMgJiYgdF92YWx1ZSAhPT0gKHRfdmFsdWUgPSAvKiRidXR0b25UZXh0Ki8gY3R4WzVdWy8qYnV0dG9uKi8gY3R4WzI1XV0gKyBcIlwiKSkgc2V0X2RhdGEodCwgdF92YWx1ZSk7XG5cblx0XHRcdGlmIChkaXJ0eSAmIC8qJHRoZW1lLCAkdmlldywgYnV0dG9ucyovIDEzNyAmJiBidXR0b25fMV9jbGFzc192YWx1ZSAhPT0gKGJ1dHRvbl8xX2NsYXNzX3ZhbHVlID0gXCJcIiArICgvKiR0aGVtZSovIGN0eFszXS5idXR0b24gKyAoLyokdmlldyovIGN0eFs3XSA9PT0gLypidXR0b24qLyBjdHhbMjVdXG5cdFx0XHQ/ICcgJyArIC8qJHRoZW1lKi8gY3R4WzNdLmFjdGl2ZVxuXHRcdFx0OiAnJykgKyBcIiBlYy1cIiArIC8qYnV0dG9uKi8gY3R4WzI1XSkpKSB7XG5cdFx0XHRcdGF0dHIoYnV0dG9uXzEsIFwiY2xhc3NcIiwgYnV0dG9uXzFfY2xhc3NfdmFsdWUpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0ZChkZXRhY2hpbmcpIHtcblx0XHRcdGlmIChkZXRhY2hpbmcpIHtcblx0XHRcdFx0ZGV0YWNoKGJ1dHRvbl8xKTtcblx0XHRcdH1cblxuXHRcdFx0bW91bnRlZCA9IGZhbHNlO1xuXHRcdFx0ZGlzcG9zZSgpO1xuXHRcdH1cblx0fTtcbn1cblxuLy8gKDUyOjM3KSBcbmZ1bmN0aW9uIGNyZWF0ZV9pZl9ibG9ja180KGN0eCkge1xuXHRsZXQgYnV0dG9uXzE7XG5cdGxldCB0X3ZhbHVlID0gLyokY3VzdG9tQnV0dG9ucyovIGN0eFs2XVsvKmJ1dHRvbiovIGN0eFsyNV1dLnRleHQgKyBcIlwiO1xuXHRsZXQgdDtcblx0bGV0IGJ1dHRvbl8xX2NsYXNzX3ZhbHVlO1xuXHRsZXQgbW91bnRlZDtcblx0bGV0IGRpc3Bvc2U7XG5cblx0cmV0dXJuIHtcblx0XHRjKCkge1xuXHRcdFx0YnV0dG9uXzEgPSBlbGVtZW50KFwiYnV0dG9uXCIpO1xuXHRcdFx0dCA9IHRleHQodF92YWx1ZSk7XG5cdFx0XHRhdHRyKGJ1dHRvbl8xLCBcImNsYXNzXCIsIGJ1dHRvbl8xX2NsYXNzX3ZhbHVlID0gXCJcIiArICgvKiR0aGVtZSovIGN0eFszXS5idXR0b24gKyBcIiBlYy1cIiArIC8qYnV0dG9uKi8gY3R4WzI1XSkpO1xuXHRcdH0sXG5cdFx0bSh0YXJnZXQsIGFuY2hvcikge1xuXHRcdFx0aW5zZXJ0KHRhcmdldCwgYnV0dG9uXzEsIGFuY2hvcik7XG5cdFx0XHRhcHBlbmQoYnV0dG9uXzEsIHQpO1xuXG5cdFx0XHRpZiAoIW1vdW50ZWQpIHtcblx0XHRcdFx0ZGlzcG9zZSA9IGxpc3RlbihidXR0b25fMSwgXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0aWYgKGlzX2Z1bmN0aW9uKC8qJGN1c3RvbUJ1dHRvbnMqLyBjdHhbNl1bLypidXR0b24qLyBjdHhbMjVdXS5jbGljaykpIC8qJGN1c3RvbUJ1dHRvbnMqLyBjdHhbNl1bLypidXR0b24qLyBjdHhbMjVdXS5jbGljay5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRtb3VudGVkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdHAobmV3X2N0eCwgZGlydHkpIHtcblx0XHRcdGN0eCA9IG5ld19jdHg7XG5cdFx0XHRpZiAoZGlydHkgJiAvKiRjdXN0b21CdXR0b25zLCBidXR0b25zKi8gNjUgJiYgdF92YWx1ZSAhPT0gKHRfdmFsdWUgPSAvKiRjdXN0b21CdXR0b25zKi8gY3R4WzZdWy8qYnV0dG9uKi8gY3R4WzI1XV0udGV4dCArIFwiXCIpKSBzZXRfZGF0YSh0LCB0X3ZhbHVlKTtcblxuXHRcdFx0aWYgKGRpcnR5ICYgLyokdGhlbWUsIGJ1dHRvbnMqLyA5ICYmIGJ1dHRvbl8xX2NsYXNzX3ZhbHVlICE9PSAoYnV0dG9uXzFfY2xhc3NfdmFsdWUgPSBcIlwiICsgKC8qJHRoZW1lKi8gY3R4WzNdLmJ1dHRvbiArIFwiIGVjLVwiICsgLypidXR0b24qLyBjdHhbMjVdKSkpIHtcblx0XHRcdFx0YXR0cihidXR0b25fMSwgXCJjbGFzc1wiLCBidXR0b25fMV9jbGFzc192YWx1ZSk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRkKGRldGFjaGluZykge1xuXHRcdFx0aWYgKGRldGFjaGluZykge1xuXHRcdFx0XHRkZXRhY2goYnV0dG9uXzEpO1xuXHRcdFx0fVxuXG5cdFx0XHRtb3VudGVkID0gZmFsc2U7XG5cdFx0XHRkaXNwb3NlKCk7XG5cdFx0fVxuXHR9O1xufVxuXG4vLyAoNDY6MzIpIFxuZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrXzMoY3R4KSB7XG5cdGxldCBidXR0b25fMTtcblx0bGV0IHRfdmFsdWUgPSAvKiRidXR0b25UZXh0Ki8gY3R4WzVdWy8qYnV0dG9uKi8gY3R4WzI1XV0gKyBcIlwiO1xuXHRsZXQgdDtcblx0bGV0IGJ1dHRvbl8xX2NsYXNzX3ZhbHVlO1xuXHRsZXQgbW91bnRlZDtcblx0bGV0IGRpc3Bvc2U7XG5cblx0cmV0dXJuIHtcblx0XHRjKCkge1xuXHRcdFx0YnV0dG9uXzEgPSBlbGVtZW50KFwiYnV0dG9uXCIpO1xuXHRcdFx0dCA9IHRleHQodF92YWx1ZSk7XG5cdFx0XHRhdHRyKGJ1dHRvbl8xLCBcImNsYXNzXCIsIGJ1dHRvbl8xX2NsYXNzX3ZhbHVlID0gXCJcIiArICgvKiR0aGVtZSovIGN0eFszXS5idXR0b24gKyBcIiBlYy1cIiArIC8qYnV0dG9uKi8gY3R4WzI1XSkpO1xuXHRcdFx0YnV0dG9uXzEuZGlzYWJsZWQgPSAvKmlzVG9kYXkqLyBjdHhbMV07XG5cdFx0fSxcblx0XHRtKHRhcmdldCwgYW5jaG9yKSB7XG5cdFx0XHRpbnNlcnQodGFyZ2V0LCBidXR0b25fMSwgYW5jaG9yKTtcblx0XHRcdGFwcGVuZChidXR0b25fMSwgdCk7XG5cblx0XHRcdGlmICghbW91bnRlZCkge1xuXHRcdFx0XHRkaXNwb3NlID0gbGlzdGVuKGJ1dHRvbl8xLCBcImNsaWNrXCIsIC8qY2xpY2tfaGFuZGxlciovIGN0eFsyMV0pO1xuXHRcdFx0XHRtb3VudGVkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdHAoY3R4LCBkaXJ0eSkge1xuXHRcdFx0aWYgKGRpcnR5ICYgLyokYnV0dG9uVGV4dCwgYnV0dG9ucyovIDMzICYmIHRfdmFsdWUgIT09ICh0X3ZhbHVlID0gLyokYnV0dG9uVGV4dCovIGN0eFs1XVsvKmJ1dHRvbiovIGN0eFsyNV1dICsgXCJcIikpIHNldF9kYXRhKHQsIHRfdmFsdWUpO1xuXG5cdFx0XHRpZiAoZGlydHkgJiAvKiR0aGVtZSwgYnV0dG9ucyovIDkgJiYgYnV0dG9uXzFfY2xhc3NfdmFsdWUgIT09IChidXR0b25fMV9jbGFzc192YWx1ZSA9IFwiXCIgKyAoLyokdGhlbWUqLyBjdHhbM10uYnV0dG9uICsgXCIgZWMtXCIgKyAvKmJ1dHRvbiovIGN0eFsyNV0pKSkge1xuXHRcdFx0XHRhdHRyKGJ1dHRvbl8xLCBcImNsYXNzXCIsIGJ1dHRvbl8xX2NsYXNzX3ZhbHVlKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGRpcnR5ICYgLyppc1RvZGF5Ki8gMikge1xuXHRcdFx0XHRidXR0b25fMS5kaXNhYmxlZCA9IC8qaXNUb2RheSovIGN0eFsxXTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGQoZGV0YWNoaW5nKSB7XG5cdFx0XHRpZiAoZGV0YWNoaW5nKSB7XG5cdFx0XHRcdGRldGFjaChidXR0b25fMSk7XG5cdFx0XHR9XG5cblx0XHRcdG1vdW50ZWQgPSBmYWxzZTtcblx0XHRcdGRpc3Bvc2UoKTtcblx0XHR9XG5cdH07XG59XG5cbi8vICgzOTozMSkgXG5mdW5jdGlvbiBjcmVhdGVfaWZfYmxvY2tfMihjdHgpIHtcblx0bGV0IGJ1dHRvbl8xO1xuXHRsZXQgaTtcblx0bGV0IGlfY2xhc3NfdmFsdWU7XG5cdGxldCBidXR0b25fMV9jbGFzc192YWx1ZTtcblx0bGV0IGJ1dHRvbl8xX2FyaWFfbGFiZWxfdmFsdWU7XG5cdGxldCBidXR0b25fMV90aXRsZV92YWx1ZTtcblx0bGV0IG1vdW50ZWQ7XG5cdGxldCBkaXNwb3NlO1xuXG5cdHJldHVybiB7XG5cdFx0YygpIHtcblx0XHRcdGJ1dHRvbl8xID0gZWxlbWVudChcImJ1dHRvblwiKTtcblx0XHRcdGkgPSBlbGVtZW50KFwiaVwiKTtcblx0XHRcdGF0dHIoaSwgXCJjbGFzc1wiLCBpX2NsYXNzX3ZhbHVlID0gXCJcIiArICgvKiR0aGVtZSovIGN0eFszXS5pY29uICsgXCIgZWMtXCIgKyAvKmJ1dHRvbiovIGN0eFsyNV0pKTtcblx0XHRcdGF0dHIoYnV0dG9uXzEsIFwiY2xhc3NcIiwgYnV0dG9uXzFfY2xhc3NfdmFsdWUgPSBcIlwiICsgKC8qJHRoZW1lKi8gY3R4WzNdLmJ1dHRvbiArIFwiIGVjLVwiICsgLypidXR0b24qLyBjdHhbMjVdKSk7XG5cdFx0XHRhdHRyKGJ1dHRvbl8xLCBcImFyaWEtbGFiZWxcIiwgYnV0dG9uXzFfYXJpYV9sYWJlbF92YWx1ZSA9IC8qJGJ1dHRvblRleHQqLyBjdHhbNV0ubmV4dCk7XG5cdFx0XHRhdHRyKGJ1dHRvbl8xLCBcInRpdGxlXCIsIGJ1dHRvbl8xX3RpdGxlX3ZhbHVlID0gLyokYnV0dG9uVGV4dCovIGN0eFs1XS5uZXh0KTtcblx0XHR9LFxuXHRcdG0odGFyZ2V0LCBhbmNob3IpIHtcblx0XHRcdGluc2VydCh0YXJnZXQsIGJ1dHRvbl8xLCBhbmNob3IpO1xuXHRcdFx0YXBwZW5kKGJ1dHRvbl8xLCBpKTtcblxuXHRcdFx0aWYgKCFtb3VudGVkKSB7XG5cdFx0XHRcdGRpc3Bvc2UgPSBsaXN0ZW4oYnV0dG9uXzEsIFwiY2xpY2tcIiwgLypuZXh0Ki8gY3R4WzE5XSk7XG5cdFx0XHRcdG1vdW50ZWQgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0cChjdHgsIGRpcnR5KSB7XG5cdFx0XHRpZiAoZGlydHkgJiAvKiR0aGVtZSwgYnV0dG9ucyovIDkgJiYgaV9jbGFzc192YWx1ZSAhPT0gKGlfY2xhc3NfdmFsdWUgPSBcIlwiICsgKC8qJHRoZW1lKi8gY3R4WzNdLmljb24gKyBcIiBlYy1cIiArIC8qYnV0dG9uKi8gY3R4WzI1XSkpKSB7XG5cdFx0XHRcdGF0dHIoaSwgXCJjbGFzc1wiLCBpX2NsYXNzX3ZhbHVlKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGRpcnR5ICYgLyokdGhlbWUsIGJ1dHRvbnMqLyA5ICYmIGJ1dHRvbl8xX2NsYXNzX3ZhbHVlICE9PSAoYnV0dG9uXzFfY2xhc3NfdmFsdWUgPSBcIlwiICsgKC8qJHRoZW1lKi8gY3R4WzNdLmJ1dHRvbiArIFwiIGVjLVwiICsgLypidXR0b24qLyBjdHhbMjVdKSkpIHtcblx0XHRcdFx0YXR0cihidXR0b25fMSwgXCJjbGFzc1wiLCBidXR0b25fMV9jbGFzc192YWx1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChkaXJ0eSAmIC8qJGJ1dHRvblRleHQqLyAzMiAmJiBidXR0b25fMV9hcmlhX2xhYmVsX3ZhbHVlICE9PSAoYnV0dG9uXzFfYXJpYV9sYWJlbF92YWx1ZSA9IC8qJGJ1dHRvblRleHQqLyBjdHhbNV0ubmV4dCkpIHtcblx0XHRcdFx0YXR0cihidXR0b25fMSwgXCJhcmlhLWxhYmVsXCIsIGJ1dHRvbl8xX2FyaWFfbGFiZWxfdmFsdWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZGlydHkgJiAvKiRidXR0b25UZXh0Ki8gMzIgJiYgYnV0dG9uXzFfdGl0bGVfdmFsdWUgIT09IChidXR0b25fMV90aXRsZV92YWx1ZSA9IC8qJGJ1dHRvblRleHQqLyBjdHhbNV0ubmV4dCkpIHtcblx0XHRcdFx0YXR0cihidXR0b25fMSwgXCJ0aXRsZVwiLCBidXR0b25fMV90aXRsZV92YWx1ZSk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRkKGRldGFjaGluZykge1xuXHRcdFx0aWYgKGRldGFjaGluZykge1xuXHRcdFx0XHRkZXRhY2goYnV0dG9uXzEpO1xuXHRcdFx0fVxuXG5cdFx0XHRtb3VudGVkID0gZmFsc2U7XG5cdFx0XHRkaXNwb3NlKCk7XG5cdFx0fVxuXHR9O1xufVxuXG4vLyAoMzI6MzEpIFxuZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrXzEoY3R4KSB7XG5cdGxldCBidXR0b25fMTtcblx0bGV0IGk7XG5cdGxldCBpX2NsYXNzX3ZhbHVlO1xuXHRsZXQgYnV0dG9uXzFfY2xhc3NfdmFsdWU7XG5cdGxldCBidXR0b25fMV9hcmlhX2xhYmVsX3ZhbHVlO1xuXHRsZXQgYnV0dG9uXzFfdGl0bGVfdmFsdWU7XG5cdGxldCBtb3VudGVkO1xuXHRsZXQgZGlzcG9zZTtcblxuXHRyZXR1cm4ge1xuXHRcdGMoKSB7XG5cdFx0XHRidXR0b25fMSA9IGVsZW1lbnQoXCJidXR0b25cIik7XG5cdFx0XHRpID0gZWxlbWVudChcImlcIik7XG5cdFx0XHRhdHRyKGksIFwiY2xhc3NcIiwgaV9jbGFzc192YWx1ZSA9IFwiXCIgKyAoLyokdGhlbWUqLyBjdHhbM10uaWNvbiArIFwiIGVjLVwiICsgLypidXR0b24qLyBjdHhbMjVdKSk7XG5cdFx0XHRhdHRyKGJ1dHRvbl8xLCBcImNsYXNzXCIsIGJ1dHRvbl8xX2NsYXNzX3ZhbHVlID0gXCJcIiArICgvKiR0aGVtZSovIGN0eFszXS5idXR0b24gKyBcIiBlYy1cIiArIC8qYnV0dG9uKi8gY3R4WzI1XSkpO1xuXHRcdFx0YXR0cihidXR0b25fMSwgXCJhcmlhLWxhYmVsXCIsIGJ1dHRvbl8xX2FyaWFfbGFiZWxfdmFsdWUgPSAvKiRidXR0b25UZXh0Ki8gY3R4WzVdLnByZXYpO1xuXHRcdFx0YXR0cihidXR0b25fMSwgXCJ0aXRsZVwiLCBidXR0b25fMV90aXRsZV92YWx1ZSA9IC8qJGJ1dHRvblRleHQqLyBjdHhbNV0ucHJldik7XG5cdFx0fSxcblx0XHRtKHRhcmdldCwgYW5jaG9yKSB7XG5cdFx0XHRpbnNlcnQodGFyZ2V0LCBidXR0b25fMSwgYW5jaG9yKTtcblx0XHRcdGFwcGVuZChidXR0b25fMSwgaSk7XG5cblx0XHRcdGlmICghbW91bnRlZCkge1xuXHRcdFx0XHRkaXNwb3NlID0gbGlzdGVuKGJ1dHRvbl8xLCBcImNsaWNrXCIsIC8qcHJldiovIGN0eFsxOF0pO1xuXHRcdFx0XHRtb3VudGVkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdHAoY3R4LCBkaXJ0eSkge1xuXHRcdFx0aWYgKGRpcnR5ICYgLyokdGhlbWUsIGJ1dHRvbnMqLyA5ICYmIGlfY2xhc3NfdmFsdWUgIT09IChpX2NsYXNzX3ZhbHVlID0gXCJcIiArICgvKiR0aGVtZSovIGN0eFszXS5pY29uICsgXCIgZWMtXCIgKyAvKmJ1dHRvbiovIGN0eFsyNV0pKSkge1xuXHRcdFx0XHRhdHRyKGksIFwiY2xhc3NcIiwgaV9jbGFzc192YWx1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChkaXJ0eSAmIC8qJHRoZW1lLCBidXR0b25zKi8gOSAmJiBidXR0b25fMV9jbGFzc192YWx1ZSAhPT0gKGJ1dHRvbl8xX2NsYXNzX3ZhbHVlID0gXCJcIiArICgvKiR0aGVtZSovIGN0eFszXS5idXR0b24gKyBcIiBlYy1cIiArIC8qYnV0dG9uKi8gY3R4WzI1XSkpKSB7XG5cdFx0XHRcdGF0dHIoYnV0dG9uXzEsIFwiY2xhc3NcIiwgYnV0dG9uXzFfY2xhc3NfdmFsdWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZGlydHkgJiAvKiRidXR0b25UZXh0Ki8gMzIgJiYgYnV0dG9uXzFfYXJpYV9sYWJlbF92YWx1ZSAhPT0gKGJ1dHRvbl8xX2FyaWFfbGFiZWxfdmFsdWUgPSAvKiRidXR0b25UZXh0Ki8gY3R4WzVdLnByZXYpKSB7XG5cdFx0XHRcdGF0dHIoYnV0dG9uXzEsIFwiYXJpYS1sYWJlbFwiLCBidXR0b25fMV9hcmlhX2xhYmVsX3ZhbHVlKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKGRpcnR5ICYgLyokYnV0dG9uVGV4dCovIDMyICYmIGJ1dHRvbl8xX3RpdGxlX3ZhbHVlICE9PSAoYnV0dG9uXzFfdGl0bGVfdmFsdWUgPSAvKiRidXR0b25UZXh0Ki8gY3R4WzVdLnByZXYpKSB7XG5cdFx0XHRcdGF0dHIoYnV0dG9uXzEsIFwidGl0bGVcIiwgYnV0dG9uXzFfdGl0bGVfdmFsdWUpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0ZChkZXRhY2hpbmcpIHtcblx0XHRcdGlmIChkZXRhY2hpbmcpIHtcblx0XHRcdFx0ZGV0YWNoKGJ1dHRvbl8xKTtcblx0XHRcdH1cblxuXHRcdFx0bW91bnRlZCA9IGZhbHNlO1xuXHRcdFx0ZGlzcG9zZSgpO1xuXHRcdH1cblx0fTtcbn1cblxuLy8gKDI5OjQpIHsjaWYgYnV0dG9uID09ICd0aXRsZSd9XG5mdW5jdGlvbiBjcmVhdGVfaWZfYmxvY2skMShjdHgpIHtcblx0bGV0IGgyO1xuXHRsZXQgaDJfY2xhc3NfdmFsdWU7XG5cdGxldCBzZXRDb250ZW50X2FjdGlvbjtcblx0bGV0IG1vdW50ZWQ7XG5cdGxldCBkaXNwb3NlO1xuXG5cdHJldHVybiB7XG5cdFx0YygpIHtcblx0XHRcdGgyID0gZWxlbWVudChcImgyXCIpO1xuXHRcdFx0YXR0cihoMiwgXCJjbGFzc1wiLCBoMl9jbGFzc192YWx1ZSA9IC8qJHRoZW1lKi8gY3R4WzNdLnRpdGxlKTtcblx0XHR9LFxuXHRcdG0odGFyZ2V0LCBhbmNob3IpIHtcblx0XHRcdGluc2VydCh0YXJnZXQsIGgyLCBhbmNob3IpO1xuXG5cdFx0XHRpZiAoIW1vdW50ZWQpIHtcblx0XHRcdFx0ZGlzcG9zZSA9IGFjdGlvbl9kZXN0cm95ZXIoc2V0Q29udGVudF9hY3Rpb24gPSBzZXRDb250ZW50LmNhbGwobnVsbCwgaDIsIC8qJF92aWV3VGl0bGUqLyBjdHhbNF0pKTtcblx0XHRcdFx0bW91bnRlZCA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRwKGN0eCwgZGlydHkpIHtcblx0XHRcdGlmIChkaXJ0eSAmIC8qJHRoZW1lKi8gOCAmJiBoMl9jbGFzc192YWx1ZSAhPT0gKGgyX2NsYXNzX3ZhbHVlID0gLyokdGhlbWUqLyBjdHhbM10udGl0bGUpKSB7XG5cdFx0XHRcdGF0dHIoaDIsIFwiY2xhc3NcIiwgaDJfY2xhc3NfdmFsdWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2V0Q29udGVudF9hY3Rpb24gJiYgaXNfZnVuY3Rpb24oc2V0Q29udGVudF9hY3Rpb24udXBkYXRlKSAmJiBkaXJ0eSAmIC8qJF92aWV3VGl0bGUqLyAxNikgc2V0Q29udGVudF9hY3Rpb24udXBkYXRlLmNhbGwobnVsbCwgLyokX3ZpZXdUaXRsZSovIGN0eFs0XSk7XG5cdFx0fSxcblx0XHRkKGRldGFjaGluZykge1xuXHRcdFx0aWYgKGRldGFjaGluZykge1xuXHRcdFx0XHRkZXRhY2goaDIpO1xuXHRcdFx0fVxuXG5cdFx0XHRtb3VudGVkID0gZmFsc2U7XG5cdFx0XHRkaXNwb3NlKCk7XG5cdFx0fVxuXHR9O1xufVxuXG4vLyAoMjg6MCkgeyNlYWNoIGJ1dHRvbnMgYXMgYnV0dG9ufVxuZnVuY3Rpb24gY3JlYXRlX2VhY2hfYmxvY2skMihjdHgpIHtcblx0bGV0IGlmX2Jsb2NrX2FuY2hvcjtcblxuXHRmdW5jdGlvbiBzZWxlY3RfYmxvY2tfdHlwZShjdHgsIGRpcnR5KSB7XG5cdFx0aWYgKC8qYnV0dG9uKi8gY3R4WzI1XSA9PSAndGl0bGUnKSByZXR1cm4gY3JlYXRlX2lmX2Jsb2NrJDE7XG5cdFx0aWYgKC8qYnV0dG9uKi8gY3R4WzI1XSA9PSAncHJldicpIHJldHVybiBjcmVhdGVfaWZfYmxvY2tfMTtcblx0XHRpZiAoLypidXR0b24qLyBjdHhbMjVdID09ICduZXh0JykgcmV0dXJuIGNyZWF0ZV9pZl9ibG9ja18yO1xuXHRcdGlmICgvKmJ1dHRvbiovIGN0eFsyNV0gPT0gJ3RvZGF5JykgcmV0dXJuIGNyZWF0ZV9pZl9ibG9ja18zO1xuXHRcdGlmICgvKiRjdXN0b21CdXR0b25zKi8gY3R4WzZdWy8qYnV0dG9uKi8gY3R4WzI1XV0pIHJldHVybiBjcmVhdGVfaWZfYmxvY2tfNDtcblx0XHRpZiAoLypidXR0b24qLyBjdHhbMjVdICE9ICcnKSByZXR1cm4gY3JlYXRlX2lmX2Jsb2NrXzU7XG5cdH1cblxuXHRsZXQgY3VycmVudF9ibG9ja190eXBlID0gc2VsZWN0X2Jsb2NrX3R5cGUoY3R4KTtcblx0bGV0IGlmX2Jsb2NrID0gY3VycmVudF9ibG9ja190eXBlICYmIGN1cnJlbnRfYmxvY2tfdHlwZShjdHgpO1xuXG5cdHJldHVybiB7XG5cdFx0YygpIHtcblx0XHRcdGlmIChpZl9ibG9jaykgaWZfYmxvY2suYygpO1xuXHRcdFx0aWZfYmxvY2tfYW5jaG9yID0gZW1wdHkoKTtcblx0XHR9LFxuXHRcdG0odGFyZ2V0LCBhbmNob3IpIHtcblx0XHRcdGlmIChpZl9ibG9jaykgaWZfYmxvY2subSh0YXJnZXQsIGFuY2hvcik7XG5cdFx0XHRpbnNlcnQodGFyZ2V0LCBpZl9ibG9ja19hbmNob3IsIGFuY2hvcik7XG5cdFx0fSxcblx0XHRwKGN0eCwgZGlydHkpIHtcblx0XHRcdGlmIChjdXJyZW50X2Jsb2NrX3R5cGUgPT09IChjdXJyZW50X2Jsb2NrX3R5cGUgPSBzZWxlY3RfYmxvY2tfdHlwZShjdHgpKSAmJiBpZl9ibG9jaykge1xuXHRcdFx0XHRpZl9ibG9jay5wKGN0eCwgZGlydHkpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5kKDEpO1xuXHRcdFx0XHRpZl9ibG9jayA9IGN1cnJlbnRfYmxvY2tfdHlwZSAmJiBjdXJyZW50X2Jsb2NrX3R5cGUoY3R4KTtcblxuXHRcdFx0XHRpZiAoaWZfYmxvY2spIHtcblx0XHRcdFx0XHRpZl9ibG9jay5jKCk7XG5cdFx0XHRcdFx0aWZfYmxvY2subShpZl9ibG9ja19hbmNob3IucGFyZW50Tm9kZSwgaWZfYmxvY2tfYW5jaG9yKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cdFx0ZChkZXRhY2hpbmcpIHtcblx0XHRcdGlmIChkZXRhY2hpbmcpIHtcblx0XHRcdFx0ZGV0YWNoKGlmX2Jsb2NrX2FuY2hvcik7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChpZl9ibG9jaykge1xuXHRcdFx0XHRpZl9ibG9jay5kKGRldGFjaGluZyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQkMyhjdHgpIHtcblx0bGV0IGVhY2hfMV9hbmNob3I7XG5cdGxldCBlYWNoX3ZhbHVlID0gZW5zdXJlX2FycmF5X2xpa2UoLypidXR0b25zKi8gY3R4WzBdKTtcblx0bGV0IGVhY2hfYmxvY2tzID0gW107XG5cblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX3ZhbHVlLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0ZWFjaF9ibG9ja3NbaV0gPSBjcmVhdGVfZWFjaF9ibG9jayQyKGdldF9lYWNoX2NvbnRleHQkMihjdHgsIGVhY2hfdmFsdWUsIGkpKTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0YygpIHtcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF9ibG9ja3MubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdFx0ZWFjaF9ibG9ja3NbaV0uYygpO1xuXHRcdFx0fVxuXG5cdFx0XHRlYWNoXzFfYW5jaG9yID0gZW1wdHkoKTtcblx0XHR9LFxuXHRcdG0odGFyZ2V0LCBhbmNob3IpIHtcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF9ibG9ja3MubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdFx0aWYgKGVhY2hfYmxvY2tzW2ldKSB7XG5cdFx0XHRcdFx0ZWFjaF9ibG9ja3NbaV0ubSh0YXJnZXQsIGFuY2hvcik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aW5zZXJ0KHRhcmdldCwgZWFjaF8xX2FuY2hvciwgYW5jaG9yKTtcblx0XHR9LFxuXHRcdHAoY3R4LCBbZGlydHldKSB7XG5cdFx0XHRpZiAoZGlydHkgJiAvKiR0aGVtZSwgJF92aWV3VGl0bGUsIGJ1dHRvbnMsICRidXR0b25UZXh0LCBwcmV2LCBuZXh0LCBpc1RvZGF5LCAkZGF0ZSwgdG9kYXksICRjdXN0b21CdXR0b25zLCAkdmlldyovIDkxNzc1OSkge1xuXHRcdFx0XHRlYWNoX3ZhbHVlID0gZW5zdXJlX2FycmF5X2xpa2UoLypidXR0b25zKi8gY3R4WzBdKTtcblx0XHRcdFx0bGV0IGk7XG5cblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IGVhY2hfdmFsdWUubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdFx0XHRjb25zdCBjaGlsZF9jdHggPSBnZXRfZWFjaF9jb250ZXh0JDIoY3R4LCBlYWNoX3ZhbHVlLCBpKTtcblxuXHRcdFx0XHRcdGlmIChlYWNoX2Jsb2Nrc1tpXSkge1xuXHRcdFx0XHRcdFx0ZWFjaF9ibG9ja3NbaV0ucChjaGlsZF9jdHgsIGRpcnR5KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZWFjaF9ibG9ja3NbaV0gPSBjcmVhdGVfZWFjaF9ibG9jayQyKGNoaWxkX2N0eCk7XG5cdFx0XHRcdFx0XHRlYWNoX2Jsb2Nrc1tpXS5jKCk7XG5cdFx0XHRcdFx0XHRlYWNoX2Jsb2Nrc1tpXS5tKGVhY2hfMV9hbmNob3IucGFyZW50Tm9kZSwgZWFjaF8xX2FuY2hvcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Zm9yICg7IGkgPCBlYWNoX2Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdFx0XHRcdGVhY2hfYmxvY2tzW2ldLmQoMSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRlYWNoX2Jsb2Nrcy5sZW5ndGggPSBlYWNoX3ZhbHVlLmxlbmd0aDtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGk6IG5vb3AsXG5cdFx0bzogbm9vcCxcblx0XHRkKGRldGFjaGluZykge1xuXHRcdFx0aWYgKGRldGFjaGluZykge1xuXHRcdFx0XHRkZXRhY2goZWFjaF8xX2FuY2hvcik7XG5cdFx0XHR9XG5cblx0XHRcdGRlc3Ryb3lfZWFjaChlYWNoX2Jsb2NrcywgZGV0YWNoaW5nKTtcblx0XHR9XG5cdH07XG59XG5cbmZ1bmN0aW9uIGluc3RhbmNlJDMoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHtcblx0bGV0ICRkdXJhdGlvbjtcblx0bGV0ICRkYXRlO1xuXHRsZXQgJGhpZGRlbkRheXM7XG5cdGxldCAkX2N1cnJlbnRSYW5nZTtcblx0bGV0ICR0aGVtZTtcblx0bGV0ICRfdmlld1RpdGxlO1xuXHRsZXQgJGJ1dHRvblRleHQ7XG5cdGxldCAkY3VzdG9tQnV0dG9ucztcblx0bGV0ICR2aWV3O1xuXHRsZXQgeyBidXR0b25zIH0gPSAkJHByb3BzO1xuXHRsZXQgeyBfY3VycmVudFJhbmdlLCBfdmlld1RpdGxlLCBidXR0b25UZXh0LCBjdXN0b21CdXR0b25zLCBkYXRlLCBkdXJhdGlvbiwgaGlkZGVuRGF5cywgdGhlbWUsIHZpZXcgfSA9IGdldENvbnRleHQoJ3N0YXRlJyk7XG5cdGNvbXBvbmVudF9zdWJzY3JpYmUoJCRzZWxmLCBfY3VycmVudFJhbmdlLCB2YWx1ZSA9PiAkJGludmFsaWRhdGUoMjAsICRfY3VycmVudFJhbmdlID0gdmFsdWUpKTtcblx0Y29tcG9uZW50X3N1YnNjcmliZSgkJHNlbGYsIF92aWV3VGl0bGUsIHZhbHVlID0+ICQkaW52YWxpZGF0ZSg0LCAkX3ZpZXdUaXRsZSA9IHZhbHVlKSk7XG5cdGNvbXBvbmVudF9zdWJzY3JpYmUoJCRzZWxmLCBidXR0b25UZXh0LCB2YWx1ZSA9PiAkJGludmFsaWRhdGUoNSwgJGJ1dHRvblRleHQgPSB2YWx1ZSkpO1xuXHRjb21wb25lbnRfc3Vic2NyaWJlKCQkc2VsZiwgY3VzdG9tQnV0dG9ucywgdmFsdWUgPT4gJCRpbnZhbGlkYXRlKDYsICRjdXN0b21CdXR0b25zID0gdmFsdWUpKTtcblx0Y29tcG9uZW50X3N1YnNjcmliZSgkJHNlbGYsIGRhdGUsIHZhbHVlID0+ICQkaW52YWxpZGF0ZSgyLCAkZGF0ZSA9IHZhbHVlKSk7XG5cdGNvbXBvbmVudF9zdWJzY3JpYmUoJCRzZWxmLCBkdXJhdGlvbiwgdmFsdWUgPT4gJCRpbnZhbGlkYXRlKDIzLCAkZHVyYXRpb24gPSB2YWx1ZSkpO1xuXHRjb21wb25lbnRfc3Vic2NyaWJlKCQkc2VsZiwgaGlkZGVuRGF5cywgdmFsdWUgPT4gJCRpbnZhbGlkYXRlKDI0LCAkaGlkZGVuRGF5cyA9IHZhbHVlKSk7XG5cdGNvbXBvbmVudF9zdWJzY3JpYmUoJCRzZWxmLCB0aGVtZSwgdmFsdWUgPT4gJCRpbnZhbGlkYXRlKDMsICR0aGVtZSA9IHZhbHVlKSk7XG5cdGNvbXBvbmVudF9zdWJzY3JpYmUoJCRzZWxmLCB2aWV3LCB2YWx1ZSA9PiAkJGludmFsaWRhdGUoNywgJHZpZXcgPSB2YWx1ZSkpO1xuXHRsZXQgdG9kYXkgPSBzZXRNaWRuaWdodChjcmVhdGVEYXRlKCkpLCBpc1RvZGF5O1xuXG5cdGZ1bmN0aW9uIHByZXYoKSB7XG5cdFx0bGV0IGQgPSBzdWJ0cmFjdER1cmF0aW9uKCRkYXRlLCAkZHVyYXRpb24pO1xuXG5cdFx0aWYgKCRoaWRkZW5EYXlzLmxlbmd0aCAmJiAkaGlkZGVuRGF5cy5sZW5ndGggPCA3KSB7XG5cdFx0XHR3aGlsZSAoJGhpZGRlbkRheXMuaW5jbHVkZXMoZC5nZXRVVENEYXkoKSkpIHtcblx0XHRcdFx0c3VidHJhY3REYXkoZCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0c2V0X3N0b3JlX3ZhbHVlKGRhdGUsICRkYXRlID0gZCwgJGRhdGUpO1xuXHR9XG5cblx0ZnVuY3Rpb24gbmV4dCgpIHtcblx0XHRzZXRfc3RvcmVfdmFsdWUoZGF0ZSwgJGRhdGUgPSBhZGREdXJhdGlvbigkZGF0ZSwgJGR1cmF0aW9uKSwgJGRhdGUpO1xuXHR9XG5cblx0Y29uc3QgY2xpY2tfaGFuZGxlciA9ICgpID0+IHNldF9zdG9yZV92YWx1ZShkYXRlLCAkZGF0ZSA9IGNsb25lRGF0ZSh0b2RheSksICRkYXRlKTtcblx0Y29uc3QgY2xpY2tfaGFuZGxlcl8xID0gYnV0dG9uID0+IHNldF9zdG9yZV92YWx1ZSh2aWV3LCAkdmlldyA9IGJ1dHRvbiwgJHZpZXcpO1xuXG5cdCQkc2VsZi4kJHNldCA9ICQkcHJvcHMgPT4ge1xuXHRcdGlmICgnYnV0dG9ucycgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDAsIGJ1dHRvbnMgPSAkJHByb3BzLmJ1dHRvbnMpO1xuXHR9O1xuXG5cdCQkc2VsZi4kJC51cGRhdGUgPSAoKSA9PiB7XG5cdFx0aWYgKCQkc2VsZi4kJC5kaXJ0eSAmIC8qJF9jdXJyZW50UmFuZ2UqLyAxMDQ4NTc2KSB7XG5cdFx0XHQkJGludmFsaWRhdGUoMSwgaXNUb2RheSA9IHRvZGF5ID49ICRfY3VycmVudFJhbmdlLnN0YXJ0ICYmIHRvZGF5IDwgJF9jdXJyZW50UmFuZ2UuZW5kIHx8IG51bGwpO1xuXHRcdH1cblx0fTtcblxuXHRyZXR1cm4gW1xuXHRcdGJ1dHRvbnMsXG5cdFx0aXNUb2RheSxcblx0XHQkZGF0ZSxcblx0XHQkdGhlbWUsXG5cdFx0JF92aWV3VGl0bGUsXG5cdFx0JGJ1dHRvblRleHQsXG5cdFx0JGN1c3RvbUJ1dHRvbnMsXG5cdFx0JHZpZXcsXG5cdFx0X2N1cnJlbnRSYW5nZSxcblx0XHRfdmlld1RpdGxlLFxuXHRcdGJ1dHRvblRleHQsXG5cdFx0Y3VzdG9tQnV0dG9ucyxcblx0XHRkYXRlLFxuXHRcdGR1cmF0aW9uLFxuXHRcdGhpZGRlbkRheXMsXG5cdFx0dGhlbWUsXG5cdFx0dmlldyxcblx0XHR0b2RheSxcblx0XHRwcmV2LFxuXHRcdG5leHQsXG5cdFx0JF9jdXJyZW50UmFuZ2UsXG5cdFx0Y2xpY2tfaGFuZGxlcixcblx0XHRjbGlja19oYW5kbGVyXzFcblx0XTtcbn1cblxuY2xhc3MgQnV0dG9ucyBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7XG5cdGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcblx0XHRzdXBlcigpO1xuXHRcdGluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkMywgY3JlYXRlX2ZyYWdtZW50JDMsIHNhZmVfbm90X2VxdWFsLCB7IGJ1dHRvbnM6IDAgfSk7XG5cdH1cbn1cblxuLyogcGFja2FnZXMvY29yZS9zcmMvVG9vbGJhci5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjE2ICovXG5cbmZ1bmN0aW9uIGdldF9lYWNoX2NvbnRleHQkMShjdHgsIGxpc3QsIGkpIHtcblx0Y29uc3QgY2hpbGRfY3R4ID0gY3R4LnNsaWNlKCk7XG5cdGNoaWxkX2N0eFs1XSA9IGxpc3RbaV07XG5cdHJldHVybiBjaGlsZF9jdHg7XG59XG5cbmZ1bmN0aW9uIGdldF9lYWNoX2NvbnRleHRfMShjdHgsIGxpc3QsIGkpIHtcblx0Y29uc3QgY2hpbGRfY3R4ID0gY3R4LnNsaWNlKCk7XG5cdGNoaWxkX2N0eFs4XSA9IGxpc3RbaV07XG5cdHJldHVybiBjaGlsZF9jdHg7XG59XG5cbi8vICgyODoxNikgezplbHNlfVxuZnVuY3Rpb24gY3JlYXRlX2Vsc2VfYmxvY2soY3R4KSB7XG5cdGxldCBidXR0b25zXzE7XG5cdGxldCBjdXJyZW50O1xuXHRidXR0b25zXzEgPSBuZXcgQnV0dG9ucyh7IHByb3BzOiB7IGJ1dHRvbnM6IC8qYnV0dG9ucyovIGN0eFs4XSB9IH0pO1xuXG5cdHJldHVybiB7XG5cdFx0YygpIHtcblx0XHRcdGNyZWF0ZV9jb21wb25lbnQoYnV0dG9uc18xLiQkLmZyYWdtZW50KTtcblx0XHR9LFxuXHRcdG0odGFyZ2V0LCBhbmNob3IpIHtcblx0XHRcdG1vdW50X2NvbXBvbmVudChidXR0b25zXzEsIHRhcmdldCwgYW5jaG9yKTtcblx0XHRcdGN1cnJlbnQgPSB0cnVlO1xuXHRcdH0sXG5cdFx0cChjdHgsIGRpcnR5KSB7XG5cdFx0XHRjb25zdCBidXR0b25zXzFfY2hhbmdlcyA9IHt9O1xuXHRcdFx0aWYgKGRpcnR5ICYgLypzZWN0aW9ucyovIDEpIGJ1dHRvbnNfMV9jaGFuZ2VzLmJ1dHRvbnMgPSAvKmJ1dHRvbnMqLyBjdHhbOF07XG5cdFx0XHRidXR0b25zXzEuJHNldChidXR0b25zXzFfY2hhbmdlcyk7XG5cdFx0fSxcblx0XHRpKGxvY2FsKSB7XG5cdFx0XHRpZiAoY3VycmVudCkgcmV0dXJuO1xuXHRcdFx0dHJhbnNpdGlvbl9pbihidXR0b25zXzEuJCQuZnJhZ21lbnQsIGxvY2FsKTtcblx0XHRcdGN1cnJlbnQgPSB0cnVlO1xuXHRcdH0sXG5cdFx0byhsb2NhbCkge1xuXHRcdFx0dHJhbnNpdGlvbl9vdXQoYnV0dG9uc18xLiQkLmZyYWdtZW50LCBsb2NhbCk7XG5cdFx0XHRjdXJyZW50ID0gZmFsc2U7XG5cdFx0fSxcblx0XHRkKGRldGFjaGluZykge1xuXHRcdFx0ZGVzdHJveV9jb21wb25lbnQoYnV0dG9uc18xLCBkZXRhY2hpbmcpO1xuXHRcdH1cblx0fTtcbn1cblxuLy8gKDI0OjE2KSB7I2lmIGJ1dHRvbnMubGVuZ3RoID4gMX1cbmZ1bmN0aW9uIGNyZWF0ZV9pZl9ibG9jayhjdHgpIHtcblx0bGV0IGRpdjtcblx0bGV0IGJ1dHRvbnNfMTtcblx0bGV0IGRpdl9jbGFzc192YWx1ZTtcblx0bGV0IGN1cnJlbnQ7XG5cdGJ1dHRvbnNfMSA9IG5ldyBCdXR0b25zKHsgcHJvcHM6IHsgYnV0dG9uczogLypidXR0b25zKi8gY3R4WzhdIH0gfSk7XG5cblx0cmV0dXJuIHtcblx0XHRjKCkge1xuXHRcdFx0ZGl2ID0gZWxlbWVudChcImRpdlwiKTtcblx0XHRcdGNyZWF0ZV9jb21wb25lbnQoYnV0dG9uc18xLiQkLmZyYWdtZW50KTtcblx0XHRcdGF0dHIoZGl2LCBcImNsYXNzXCIsIGRpdl9jbGFzc192YWx1ZSA9IC8qJHRoZW1lKi8gY3R4WzFdLmJ1dHRvbkdyb3VwKTtcblx0XHR9LFxuXHRcdG0odGFyZ2V0LCBhbmNob3IpIHtcblx0XHRcdGluc2VydCh0YXJnZXQsIGRpdiwgYW5jaG9yKTtcblx0XHRcdG1vdW50X2NvbXBvbmVudChidXR0b25zXzEsIGRpdiwgbnVsbCk7XG5cdFx0XHRjdXJyZW50ID0gdHJ1ZTtcblx0XHR9LFxuXHRcdHAoY3R4LCBkaXJ0eSkge1xuXHRcdFx0Y29uc3QgYnV0dG9uc18xX2NoYW5nZXMgPSB7fTtcblx0XHRcdGlmIChkaXJ0eSAmIC8qc2VjdGlvbnMqLyAxKSBidXR0b25zXzFfY2hhbmdlcy5idXR0b25zID0gLypidXR0b25zKi8gY3R4WzhdO1xuXHRcdFx0YnV0dG9uc18xLiRzZXQoYnV0dG9uc18xX2NoYW5nZXMpO1xuXG5cdFx0XHRpZiAoIWN1cnJlbnQgfHwgZGlydHkgJiAvKiR0aGVtZSovIDIgJiYgZGl2X2NsYXNzX3ZhbHVlICE9PSAoZGl2X2NsYXNzX3ZhbHVlID0gLyokdGhlbWUqLyBjdHhbMV0uYnV0dG9uR3JvdXApKSB7XG5cdFx0XHRcdGF0dHIoZGl2LCBcImNsYXNzXCIsIGRpdl9jbGFzc192YWx1ZSk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRpKGxvY2FsKSB7XG5cdFx0XHRpZiAoY3VycmVudCkgcmV0dXJuO1xuXHRcdFx0dHJhbnNpdGlvbl9pbihidXR0b25zXzEuJCQuZnJhZ21lbnQsIGxvY2FsKTtcblx0XHRcdGN1cnJlbnQgPSB0cnVlO1xuXHRcdH0sXG5cdFx0byhsb2NhbCkge1xuXHRcdFx0dHJhbnNpdGlvbl9vdXQoYnV0dG9uc18xLiQkLmZyYWdtZW50LCBsb2NhbCk7XG5cdFx0XHRjdXJyZW50ID0gZmFsc2U7XG5cdFx0fSxcblx0XHRkKGRldGFjaGluZykge1xuXHRcdFx0aWYgKGRldGFjaGluZykge1xuXHRcdFx0XHRkZXRhY2goZGl2KTtcblx0XHRcdH1cblxuXHRcdFx0ZGVzdHJveV9jb21wb25lbnQoYnV0dG9uc18xKTtcblx0XHR9XG5cdH07XG59XG5cbi8vICgyMzoxMikgeyNlYWNoIHNlY3Rpb25zW2tleV0gYXMgYnV0dG9uc31cbmZ1bmN0aW9uIGNyZWF0ZV9lYWNoX2Jsb2NrXzEoY3R4KSB7XG5cdGxldCBjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXg7XG5cdGxldCBpZl9ibG9jaztcblx0bGV0IGlmX2Jsb2NrX2FuY2hvcjtcblx0bGV0IGN1cnJlbnQ7XG5cdGNvbnN0IGlmX2Jsb2NrX2NyZWF0b3JzID0gW2NyZWF0ZV9pZl9ibG9jaywgY3JlYXRlX2Vsc2VfYmxvY2tdO1xuXHRjb25zdCBpZl9ibG9ja3MgPSBbXTtcblxuXHRmdW5jdGlvbiBzZWxlY3RfYmxvY2tfdHlwZShjdHgsIGRpcnR5KSB7XG5cdFx0aWYgKC8qYnV0dG9ucyovIGN0eFs4XS5sZW5ndGggPiAxKSByZXR1cm4gMDtcblx0XHRyZXR1cm4gMTtcblx0fVxuXG5cdGN1cnJlbnRfYmxvY2tfdHlwZV9pbmRleCA9IHNlbGVjdF9ibG9ja190eXBlKGN0eCk7XG5cdGlmX2Jsb2NrID0gaWZfYmxvY2tzW2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleF0gPSBpZl9ibG9ja19jcmVhdG9yc1tjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXhdKGN0eCk7XG5cblx0cmV0dXJuIHtcblx0XHRjKCkge1xuXHRcdFx0aWZfYmxvY2suYygpO1xuXHRcdFx0aWZfYmxvY2tfYW5jaG9yID0gZW1wdHkoKTtcblx0XHR9LFxuXHRcdG0odGFyZ2V0LCBhbmNob3IpIHtcblx0XHRcdGlmX2Jsb2Nrc1tjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXhdLm0odGFyZ2V0LCBhbmNob3IpO1xuXHRcdFx0aW5zZXJ0KHRhcmdldCwgaWZfYmxvY2tfYW5jaG9yLCBhbmNob3IpO1xuXHRcdFx0Y3VycmVudCA9IHRydWU7XG5cdFx0fSxcblx0XHRwKGN0eCwgZGlydHkpIHtcblx0XHRcdGxldCBwcmV2aW91c19ibG9ja19pbmRleCA9IGN1cnJlbnRfYmxvY2tfdHlwZV9pbmRleDtcblx0XHRcdGN1cnJlbnRfYmxvY2tfdHlwZV9pbmRleCA9IHNlbGVjdF9ibG9ja190eXBlKGN0eCk7XG5cblx0XHRcdGlmIChjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXggPT09IHByZXZpb3VzX2Jsb2NrX2luZGV4KSB7XG5cdFx0XHRcdGlmX2Jsb2Nrc1tjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXhdLnAoY3R4LCBkaXJ0eSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRncm91cF9vdXRyb3MoKTtcblxuXHRcdFx0XHR0cmFuc2l0aW9uX291dChpZl9ibG9ja3NbcHJldmlvdXNfYmxvY2tfaW5kZXhdLCAxLCAxLCAoKSA9PiB7XG5cdFx0XHRcdFx0aWZfYmxvY2tzW3ByZXZpb3VzX2Jsb2NrX2luZGV4XSA9IG51bGw7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGNoZWNrX291dHJvcygpO1xuXHRcdFx0XHRpZl9ibG9jayA9IGlmX2Jsb2Nrc1tjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXhdO1xuXG5cdFx0XHRcdGlmICghaWZfYmxvY2spIHtcblx0XHRcdFx0XHRpZl9ibG9jayA9IGlmX2Jsb2Nrc1tjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXhdID0gaWZfYmxvY2tfY3JlYXRvcnNbY3VycmVudF9ibG9ja190eXBlX2luZGV4XShjdHgpO1xuXHRcdFx0XHRcdGlmX2Jsb2NrLmMoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZl9ibG9jay5wKGN0eCwgZGlydHkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dHJhbnNpdGlvbl9pbihpZl9ibG9jaywgMSk7XG5cdFx0XHRcdGlmX2Jsb2NrLm0oaWZfYmxvY2tfYW5jaG9yLnBhcmVudE5vZGUsIGlmX2Jsb2NrX2FuY2hvcik7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRpKGxvY2FsKSB7XG5cdFx0XHRpZiAoY3VycmVudCkgcmV0dXJuO1xuXHRcdFx0dHJhbnNpdGlvbl9pbihpZl9ibG9jayk7XG5cdFx0XHRjdXJyZW50ID0gdHJ1ZTtcblx0XHR9LFxuXHRcdG8obG9jYWwpIHtcblx0XHRcdHRyYW5zaXRpb25fb3V0KGlmX2Jsb2NrKTtcblx0XHRcdGN1cnJlbnQgPSBmYWxzZTtcblx0XHR9LFxuXHRcdGQoZGV0YWNoaW5nKSB7XG5cdFx0XHRpZiAoZGV0YWNoaW5nKSB7XG5cdFx0XHRcdGRldGFjaChpZl9ibG9ja19hbmNob3IpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZl9ibG9ja3NbY3VycmVudF9ibG9ja190eXBlX2luZGV4XS5kKGRldGFjaGluZyk7XG5cdFx0fVxuXHR9O1xufVxuXG4vLyAoMjE6NCkgeyNlYWNoIE9iamVjdC5rZXlzKHNlY3Rpb25zKSBhcyBrZXl9XG5mdW5jdGlvbiBjcmVhdGVfZWFjaF9ibG9jayQxKGN0eCkge1xuXHRsZXQgZGl2O1xuXHRsZXQgdDtcblx0bGV0IGN1cnJlbnQ7XG5cdGxldCBlYWNoX3ZhbHVlXzEgPSBlbnN1cmVfYXJyYXlfbGlrZSgvKnNlY3Rpb25zKi8gY3R4WzBdWy8qa2V5Ki8gY3R4WzVdXSk7XG5cdGxldCBlYWNoX2Jsb2NrcyA9IFtdO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF92YWx1ZV8xLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0ZWFjaF9ibG9ja3NbaV0gPSBjcmVhdGVfZWFjaF9ibG9ja18xKGdldF9lYWNoX2NvbnRleHRfMShjdHgsIGVhY2hfdmFsdWVfMSwgaSkpO1xuXHR9XG5cblx0Y29uc3Qgb3V0ID0gaSA9PiB0cmFuc2l0aW9uX291dChlYWNoX2Jsb2Nrc1tpXSwgMSwgMSwgKCkgPT4ge1xuXHRcdGVhY2hfYmxvY2tzW2ldID0gbnVsbDtcblx0fSk7XG5cblx0cmV0dXJuIHtcblx0XHRjKCkge1xuXHRcdFx0ZGl2ID0gZWxlbWVudChcImRpdlwiKTtcblxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX2Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdFx0XHRlYWNoX2Jsb2Nrc1tpXS5jKCk7XG5cdFx0XHR9XG5cblx0XHRcdHQgPSBzcGFjZSgpO1xuXHRcdH0sXG5cdFx0bSh0YXJnZXQsIGFuY2hvcikge1xuXHRcdFx0aW5zZXJ0KHRhcmdldCwgZGl2LCBhbmNob3IpO1xuXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGVhY2hfYmxvY2tzLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHRcdGlmIChlYWNoX2Jsb2Nrc1tpXSkge1xuXHRcdFx0XHRcdGVhY2hfYmxvY2tzW2ldLm0oZGl2LCBudWxsKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRhcHBlbmQoZGl2LCB0KTtcblx0XHRcdGN1cnJlbnQgPSB0cnVlO1xuXHRcdH0sXG5cdFx0cChjdHgsIGRpcnR5KSB7XG5cdFx0XHRpZiAoZGlydHkgJiAvKiR0aGVtZSwgc2VjdGlvbnMsIE9iamVjdCovIDMpIHtcblx0XHRcdFx0ZWFjaF92YWx1ZV8xID0gZW5zdXJlX2FycmF5X2xpa2UoLypzZWN0aW9ucyovIGN0eFswXVsvKmtleSovIGN0eFs1XV0pO1xuXHRcdFx0XHRsZXQgaTtcblxuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgZWFjaF92YWx1ZV8xLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHRcdFx0Y29uc3QgY2hpbGRfY3R4ID0gZ2V0X2VhY2hfY29udGV4dF8xKGN0eCwgZWFjaF92YWx1ZV8xLCBpKTtcblxuXHRcdFx0XHRcdGlmIChlYWNoX2Jsb2Nrc1tpXSkge1xuXHRcdFx0XHRcdFx0ZWFjaF9ibG9ja3NbaV0ucChjaGlsZF9jdHgsIGRpcnR5KTtcblx0XHRcdFx0XHRcdHRyYW5zaXRpb25faW4oZWFjaF9ibG9ja3NbaV0sIDEpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRlYWNoX2Jsb2Nrc1tpXSA9IGNyZWF0ZV9lYWNoX2Jsb2NrXzEoY2hpbGRfY3R4KTtcblx0XHRcdFx0XHRcdGVhY2hfYmxvY2tzW2ldLmMoKTtcblx0XHRcdFx0XHRcdHRyYW5zaXRpb25faW4oZWFjaF9ibG9ja3NbaV0sIDEpO1xuXHRcdFx0XHRcdFx0ZWFjaF9ibG9ja3NbaV0ubShkaXYsIHQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGdyb3VwX291dHJvcygpO1xuXG5cdFx0XHRcdGZvciAoaSA9IGVhY2hfdmFsdWVfMS5sZW5ndGg7IGkgPCBlYWNoX2Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdFx0XHRcdG91dChpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNoZWNrX291dHJvcygpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0aShsb2NhbCkge1xuXHRcdFx0aWYgKGN1cnJlbnQpIHJldHVybjtcblxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX3ZhbHVlXzEubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdFx0dHJhbnNpdGlvbl9pbihlYWNoX2Jsb2Nrc1tpXSk7XG5cdFx0XHR9XG5cblx0XHRcdGN1cnJlbnQgPSB0cnVlO1xuXHRcdH0sXG5cdFx0byhsb2NhbCkge1xuXHRcdFx0ZWFjaF9ibG9ja3MgPSBlYWNoX2Jsb2Nrcy5maWx0ZXIoQm9vbGVhbik7XG5cblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF9ibG9ja3MubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdFx0dHJhbnNpdGlvbl9vdXQoZWFjaF9ibG9ja3NbaV0pO1xuXHRcdFx0fVxuXG5cdFx0XHRjdXJyZW50ID0gZmFsc2U7XG5cdFx0fSxcblx0XHRkKGRldGFjaGluZykge1xuXHRcdFx0aWYgKGRldGFjaGluZykge1xuXHRcdFx0XHRkZXRhY2goZGl2KTtcblx0XHRcdH1cblxuXHRcdFx0ZGVzdHJveV9lYWNoKGVhY2hfYmxvY2tzLCBkZXRhY2hpbmcpO1xuXHRcdH1cblx0fTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDIoY3R4KSB7XG5cdGxldCBuYXY7XG5cdGxldCBuYXZfY2xhc3NfdmFsdWU7XG5cdGxldCBjdXJyZW50O1xuXHRsZXQgZWFjaF92YWx1ZSA9IGVuc3VyZV9hcnJheV9saWtlKE9iamVjdC5rZXlzKC8qc2VjdGlvbnMqLyBjdHhbMF0pKTtcblx0bGV0IGVhY2hfYmxvY2tzID0gW107XG5cblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX3ZhbHVlLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0ZWFjaF9ibG9ja3NbaV0gPSBjcmVhdGVfZWFjaF9ibG9jayQxKGdldF9lYWNoX2NvbnRleHQkMShjdHgsIGVhY2hfdmFsdWUsIGkpKTtcblx0fVxuXG5cdGNvbnN0IG91dCA9IGkgPT4gdHJhbnNpdGlvbl9vdXQoZWFjaF9ibG9ja3NbaV0sIDEsIDEsICgpID0+IHtcblx0XHRlYWNoX2Jsb2Nrc1tpXSA9IG51bGw7XG5cdH0pO1xuXG5cdHJldHVybiB7XG5cdFx0YygpIHtcblx0XHRcdG5hdiA9IGVsZW1lbnQoXCJuYXZcIik7XG5cblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF9ibG9ja3MubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdFx0ZWFjaF9ibG9ja3NbaV0uYygpO1xuXHRcdFx0fVxuXG5cdFx0XHRhdHRyKG5hdiwgXCJjbGFzc1wiLCBuYXZfY2xhc3NfdmFsdWUgPSAvKiR0aGVtZSovIGN0eFsxXS50b29sYmFyKTtcblx0XHR9LFxuXHRcdG0odGFyZ2V0LCBhbmNob3IpIHtcblx0XHRcdGluc2VydCh0YXJnZXQsIG5hdiwgYW5jaG9yKTtcblxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX2Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdFx0XHRpZiAoZWFjaF9ibG9ja3NbaV0pIHtcblx0XHRcdFx0XHRlYWNoX2Jsb2Nrc1tpXS5tKG5hdiwgbnVsbCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Y3VycmVudCA9IHRydWU7XG5cdFx0fSxcblx0XHRwKGN0eCwgW2RpcnR5XSkge1xuXHRcdFx0aWYgKGRpcnR5ICYgLypzZWN0aW9ucywgT2JqZWN0LCAkdGhlbWUqLyAzKSB7XG5cdFx0XHRcdGVhY2hfdmFsdWUgPSBlbnN1cmVfYXJyYXlfbGlrZShPYmplY3Qua2V5cygvKnNlY3Rpb25zKi8gY3R4WzBdKSk7XG5cdFx0XHRcdGxldCBpO1xuXG5cdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBlYWNoX3ZhbHVlLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHRcdFx0Y29uc3QgY2hpbGRfY3R4ID0gZ2V0X2VhY2hfY29udGV4dCQxKGN0eCwgZWFjaF92YWx1ZSwgaSk7XG5cblx0XHRcdFx0XHRpZiAoZWFjaF9ibG9ja3NbaV0pIHtcblx0XHRcdFx0XHRcdGVhY2hfYmxvY2tzW2ldLnAoY2hpbGRfY3R4LCBkaXJ0eSk7XG5cdFx0XHRcdFx0XHR0cmFuc2l0aW9uX2luKGVhY2hfYmxvY2tzW2ldLCAxKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZWFjaF9ibG9ja3NbaV0gPSBjcmVhdGVfZWFjaF9ibG9jayQxKGNoaWxkX2N0eCk7XG5cdFx0XHRcdFx0XHRlYWNoX2Jsb2Nrc1tpXS5jKCk7XG5cdFx0XHRcdFx0XHR0cmFuc2l0aW9uX2luKGVhY2hfYmxvY2tzW2ldLCAxKTtcblx0XHRcdFx0XHRcdGVhY2hfYmxvY2tzW2ldLm0obmF2LCBudWxsKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRncm91cF9vdXRyb3MoKTtcblxuXHRcdFx0XHRmb3IgKGkgPSBlYWNoX3ZhbHVlLmxlbmd0aDsgaSA8IGVhY2hfYmxvY2tzLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHRcdFx0b3V0KGkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y2hlY2tfb3V0cm9zKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghY3VycmVudCB8fCBkaXJ0eSAmIC8qJHRoZW1lKi8gMiAmJiBuYXZfY2xhc3NfdmFsdWUgIT09IChuYXZfY2xhc3NfdmFsdWUgPSAvKiR0aGVtZSovIGN0eFsxXS50b29sYmFyKSkge1xuXHRcdFx0XHRhdHRyKG5hdiwgXCJjbGFzc1wiLCBuYXZfY2xhc3NfdmFsdWUpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0aShsb2NhbCkge1xuXHRcdFx0aWYgKGN1cnJlbnQpIHJldHVybjtcblxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX3ZhbHVlLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHRcdHRyYW5zaXRpb25faW4oZWFjaF9ibG9ja3NbaV0pO1xuXHRcdFx0fVxuXG5cdFx0XHRjdXJyZW50ID0gdHJ1ZTtcblx0XHR9LFxuXHRcdG8obG9jYWwpIHtcblx0XHRcdGVhY2hfYmxvY2tzID0gZWFjaF9ibG9ja3MuZmlsdGVyKEJvb2xlYW4pO1xuXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGVhY2hfYmxvY2tzLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHRcdHRyYW5zaXRpb25fb3V0KGVhY2hfYmxvY2tzW2ldKTtcblx0XHRcdH1cblxuXHRcdFx0Y3VycmVudCA9IGZhbHNlO1xuXHRcdH0sXG5cdFx0ZChkZXRhY2hpbmcpIHtcblx0XHRcdGlmIChkZXRhY2hpbmcpIHtcblx0XHRcdFx0ZGV0YWNoKG5hdik7XG5cdFx0XHR9XG5cblx0XHRcdGRlc3Ryb3lfZWFjaChlYWNoX2Jsb2NrcywgZGV0YWNoaW5nKTtcblx0XHR9XG5cdH07XG59XG5cbmZ1bmN0aW9uIGluc3RhbmNlJDIoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHtcblx0bGV0ICRoZWFkZXJUb29sYmFyO1xuXHRsZXQgJHRoZW1lO1xuXHRsZXQgeyBoZWFkZXJUb29sYmFyLCB0aGVtZSB9ID0gZ2V0Q29udGV4dCgnc3RhdGUnKTtcblx0Y29tcG9uZW50X3N1YnNjcmliZSgkJHNlbGYsIGhlYWRlclRvb2xiYXIsIHZhbHVlID0+ICQkaW52YWxpZGF0ZSg0LCAkaGVhZGVyVG9vbGJhciA9IHZhbHVlKSk7XG5cdGNvbXBvbmVudF9zdWJzY3JpYmUoJCRzZWxmLCB0aGVtZSwgdmFsdWUgPT4gJCRpbnZhbGlkYXRlKDEsICR0aGVtZSA9IHZhbHVlKSk7XG5cdGxldCBzZWN0aW9ucyA9IHsgc3RhcnQ6IFtdLCBjZW50ZXI6IFtdLCBlbmQ6IFtdIH07XG5cblx0JCRzZWxmLiQkLnVwZGF0ZSA9ICgpID0+IHtcblx0XHRpZiAoJCRzZWxmLiQkLmRpcnR5ICYgLypzZWN0aW9ucywgJGhlYWRlclRvb2xiYXIqLyAxNykge1xuXHRcdFx0e1xuXHRcdFx0XHRmb3IgKGxldCBrZXkgb2YgT2JqZWN0LmtleXMoc2VjdGlvbnMpKSB7XG5cdFx0XHRcdFx0JCRpbnZhbGlkYXRlKDAsIHNlY3Rpb25zW2tleV0gPSAkaGVhZGVyVG9vbGJhcltrZXldLnNwbGl0KCcgJykubWFwKGdyb3VwID0+IGdyb3VwLnNwbGl0KCcsJykpLCBzZWN0aW9ucyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH07XG5cblx0cmV0dXJuIFtzZWN0aW9ucywgJHRoZW1lLCBoZWFkZXJUb29sYmFyLCB0aGVtZSwgJGhlYWRlclRvb2xiYXJdO1xufVxuXG5jbGFzcyBUb29sYmFyIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHtcblx0Y29uc3RydWN0b3Iob3B0aW9ucykge1xuXHRcdHN1cGVyKCk7XG5cdFx0aW5pdCh0aGlzLCBvcHRpb25zLCBpbnN0YW5jZSQyLCBjcmVhdGVfZnJhZ21lbnQkMiwgc2FmZV9ub3RfZXF1YWwsIHt9KTtcblx0fVxufVxuXG4vKiBwYWNrYWdlcy9jb3JlL3NyYy9BdXhpbGlhcnkuc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjQuMi4xNiAqL1xuXG5mdW5jdGlvbiBnZXRfZWFjaF9jb250ZXh0KGN0eCwgbGlzdCwgaSkge1xuXHRjb25zdCBjaGlsZF9jdHggPSBjdHguc2xpY2UoKTtcblx0Y2hpbGRfY3R4WzExXSA9IGxpc3RbaV07XG5cdHJldHVybiBjaGlsZF9jdHg7XG59XG5cbi8vICgyNTowKSB7I2VhY2ggJF9hdXhpbGlhcnkgYXMgY29tcG9uZW50fVxuZnVuY3Rpb24gY3JlYXRlX2VhY2hfYmxvY2soY3R4KSB7XG5cdGxldCBzd2l0Y2hfaW5zdGFuY2U7XG5cdGxldCBzd2l0Y2hfaW5zdGFuY2VfYW5jaG9yO1xuXHRsZXQgY3VycmVudDtcblx0dmFyIHN3aXRjaF92YWx1ZSA9IC8qY29tcG9uZW50Ki8gY3R4WzExXTtcblxuXHRmdW5jdGlvbiBzd2l0Y2hfcHJvcHMoY3R4LCBkaXJ0eSkge1xuXHRcdHJldHVybiB7fTtcblx0fVxuXG5cdGlmIChzd2l0Y2hfdmFsdWUpIHtcblx0XHRzd2l0Y2hfaW5zdGFuY2UgPSBjb25zdHJ1Y3Rfc3ZlbHRlX2NvbXBvbmVudChzd2l0Y2hfdmFsdWUsIHN3aXRjaF9wcm9wcygpKTtcblx0fVxuXG5cdHJldHVybiB7XG5cdFx0YygpIHtcblx0XHRcdGlmIChzd2l0Y2hfaW5zdGFuY2UpIGNyZWF0ZV9jb21wb25lbnQoc3dpdGNoX2luc3RhbmNlLiQkLmZyYWdtZW50KTtcblx0XHRcdHN3aXRjaF9pbnN0YW5jZV9hbmNob3IgPSBlbXB0eSgpO1xuXHRcdH0sXG5cdFx0bSh0YXJnZXQsIGFuY2hvcikge1xuXHRcdFx0aWYgKHN3aXRjaF9pbnN0YW5jZSkgbW91bnRfY29tcG9uZW50KHN3aXRjaF9pbnN0YW5jZSwgdGFyZ2V0LCBhbmNob3IpO1xuXHRcdFx0aW5zZXJ0KHRhcmdldCwgc3dpdGNoX2luc3RhbmNlX2FuY2hvciwgYW5jaG9yKTtcblx0XHRcdGN1cnJlbnQgPSB0cnVlO1xuXHRcdH0sXG5cdFx0cChjdHgsIGRpcnR5KSB7XG5cdFx0XHRpZiAoZGlydHkgJiAvKiRfYXV4aWxpYXJ5Ki8gMSAmJiBzd2l0Y2hfdmFsdWUgIT09IChzd2l0Y2hfdmFsdWUgPSAvKmNvbXBvbmVudCovIGN0eFsxMV0pKSB7XG5cdFx0XHRcdGlmIChzd2l0Y2hfaW5zdGFuY2UpIHtcblx0XHRcdFx0XHRncm91cF9vdXRyb3MoKTtcblx0XHRcdFx0XHRjb25zdCBvbGRfY29tcG9uZW50ID0gc3dpdGNoX2luc3RhbmNlO1xuXG5cdFx0XHRcdFx0dHJhbnNpdGlvbl9vdXQob2xkX2NvbXBvbmVudC4kJC5mcmFnbWVudCwgMSwgMCwgKCkgPT4ge1xuXHRcdFx0XHRcdFx0ZGVzdHJveV9jb21wb25lbnQob2xkX2NvbXBvbmVudCwgMSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRjaGVja19vdXRyb3MoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzd2l0Y2hfdmFsdWUpIHtcblx0XHRcdFx0XHRzd2l0Y2hfaW5zdGFuY2UgPSBjb25zdHJ1Y3Rfc3ZlbHRlX2NvbXBvbmVudChzd2l0Y2hfdmFsdWUsIHN3aXRjaF9wcm9wcygpKTtcblx0XHRcdFx0XHRjcmVhdGVfY29tcG9uZW50KHN3aXRjaF9pbnN0YW5jZS4kJC5mcmFnbWVudCk7XG5cdFx0XHRcdFx0dHJhbnNpdGlvbl9pbihzd2l0Y2hfaW5zdGFuY2UuJCQuZnJhZ21lbnQsIDEpO1xuXHRcdFx0XHRcdG1vdW50X2NvbXBvbmVudChzd2l0Y2hfaW5zdGFuY2UsIHN3aXRjaF9pbnN0YW5jZV9hbmNob3IucGFyZW50Tm9kZSwgc3dpdGNoX2luc3RhbmNlX2FuY2hvcik7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c3dpdGNoX2luc3RhbmNlID0gbnVsbDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cdFx0aShsb2NhbCkge1xuXHRcdFx0aWYgKGN1cnJlbnQpIHJldHVybjtcblx0XHRcdGlmIChzd2l0Y2hfaW5zdGFuY2UpIHRyYW5zaXRpb25faW4oc3dpdGNoX2luc3RhbmNlLiQkLmZyYWdtZW50LCBsb2NhbCk7XG5cdFx0XHRjdXJyZW50ID0gdHJ1ZTtcblx0XHR9LFxuXHRcdG8obG9jYWwpIHtcblx0XHRcdGlmIChzd2l0Y2hfaW5zdGFuY2UpIHRyYW5zaXRpb25fb3V0KHN3aXRjaF9pbnN0YW5jZS4kJC5mcmFnbWVudCwgbG9jYWwpO1xuXHRcdFx0Y3VycmVudCA9IGZhbHNlO1xuXHRcdH0sXG5cdFx0ZChkZXRhY2hpbmcpIHtcblx0XHRcdGlmIChkZXRhY2hpbmcpIHtcblx0XHRcdFx0ZGV0YWNoKHN3aXRjaF9pbnN0YW5jZV9hbmNob3IpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc3dpdGNoX2luc3RhbmNlKSBkZXN0cm95X2NvbXBvbmVudChzd2l0Y2hfaW5zdGFuY2UsIGRldGFjaGluZyk7XG5cdFx0fVxuXHR9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQkMShjdHgpIHtcblx0bGV0IGVhY2hfMV9hbmNob3I7XG5cdGxldCBjdXJyZW50O1xuXHRsZXQgZWFjaF92YWx1ZSA9IGVuc3VyZV9hcnJheV9saWtlKC8qJF9hdXhpbGlhcnkqLyBjdHhbMF0pO1xuXHRsZXQgZWFjaF9ibG9ja3MgPSBbXTtcblxuXHRmb3IgKGxldCBpID0gMDsgaSA8IGVhY2hfdmFsdWUubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRlYWNoX2Jsb2Nrc1tpXSA9IGNyZWF0ZV9lYWNoX2Jsb2NrKGdldF9lYWNoX2NvbnRleHQoY3R4LCBlYWNoX3ZhbHVlLCBpKSk7XG5cdH1cblxuXHRjb25zdCBvdXQgPSBpID0+IHRyYW5zaXRpb25fb3V0KGVhY2hfYmxvY2tzW2ldLCAxLCAxLCAoKSA9PiB7XG5cdFx0ZWFjaF9ibG9ja3NbaV0gPSBudWxsO1xuXHR9KTtcblxuXHRyZXR1cm4ge1xuXHRcdGMoKSB7XG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGVhY2hfYmxvY2tzLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHRcdGVhY2hfYmxvY2tzW2ldLmMoKTtcblx0XHRcdH1cblxuXHRcdFx0ZWFjaF8xX2FuY2hvciA9IGVtcHR5KCk7XG5cdFx0fSxcblx0XHRtKHRhcmdldCwgYW5jaG9yKSB7XG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGVhY2hfYmxvY2tzLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHRcdGlmIChlYWNoX2Jsb2Nrc1tpXSkge1xuXHRcdFx0XHRcdGVhY2hfYmxvY2tzW2ldLm0odGFyZ2V0LCBhbmNob3IpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGluc2VydCh0YXJnZXQsIGVhY2hfMV9hbmNob3IsIGFuY2hvcik7XG5cdFx0XHRjdXJyZW50ID0gdHJ1ZTtcblx0XHR9LFxuXHRcdHAoY3R4LCBbZGlydHldKSB7XG5cdFx0XHRpZiAoZGlydHkgJiAvKiRfYXV4aWxpYXJ5Ki8gMSkge1xuXHRcdFx0XHRlYWNoX3ZhbHVlID0gZW5zdXJlX2FycmF5X2xpa2UoLyokX2F1eGlsaWFyeSovIGN0eFswXSk7XG5cdFx0XHRcdGxldCBpO1xuXG5cdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBlYWNoX3ZhbHVlLmxlbmd0aDsgaSArPSAxKSB7XG5cdFx0XHRcdFx0Y29uc3QgY2hpbGRfY3R4ID0gZ2V0X2VhY2hfY29udGV4dChjdHgsIGVhY2hfdmFsdWUsIGkpO1xuXG5cdFx0XHRcdFx0aWYgKGVhY2hfYmxvY2tzW2ldKSB7XG5cdFx0XHRcdFx0XHRlYWNoX2Jsb2Nrc1tpXS5wKGNoaWxkX2N0eCwgZGlydHkpO1xuXHRcdFx0XHRcdFx0dHJhbnNpdGlvbl9pbihlYWNoX2Jsb2Nrc1tpXSwgMSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGVhY2hfYmxvY2tzW2ldID0gY3JlYXRlX2VhY2hfYmxvY2soY2hpbGRfY3R4KTtcblx0XHRcdFx0XHRcdGVhY2hfYmxvY2tzW2ldLmMoKTtcblx0XHRcdFx0XHRcdHRyYW5zaXRpb25faW4oZWFjaF9ibG9ja3NbaV0sIDEpO1xuXHRcdFx0XHRcdFx0ZWFjaF9ibG9ja3NbaV0ubShlYWNoXzFfYW5jaG9yLnBhcmVudE5vZGUsIGVhY2hfMV9hbmNob3IpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGdyb3VwX291dHJvcygpO1xuXG5cdFx0XHRcdGZvciAoaSA9IGVhY2hfdmFsdWUubGVuZ3RoOyBpIDwgZWFjaF9ibG9ja3MubGVuZ3RoOyBpICs9IDEpIHtcblx0XHRcdFx0XHRvdXQoaSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjaGVja19vdXRyb3MoKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGkobG9jYWwpIHtcblx0XHRcdGlmIChjdXJyZW50KSByZXR1cm47XG5cblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF92YWx1ZS5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdFx0XHR0cmFuc2l0aW9uX2luKGVhY2hfYmxvY2tzW2ldKTtcblx0XHRcdH1cblxuXHRcdFx0Y3VycmVudCA9IHRydWU7XG5cdFx0fSxcblx0XHRvKGxvY2FsKSB7XG5cdFx0XHRlYWNoX2Jsb2NrcyA9IGVhY2hfYmxvY2tzLmZpbHRlcihCb29sZWFuKTtcblxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX2Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkge1xuXHRcdFx0XHR0cmFuc2l0aW9uX291dChlYWNoX2Jsb2Nrc1tpXSk7XG5cdFx0XHR9XG5cblx0XHRcdGN1cnJlbnQgPSBmYWxzZTtcblx0XHR9LFxuXHRcdGQoZGV0YWNoaW5nKSB7XG5cdFx0XHRpZiAoZGV0YWNoaW5nKSB7XG5cdFx0XHRcdGRldGFjaChlYWNoXzFfYW5jaG9yKTtcblx0XHRcdH1cblxuXHRcdFx0ZGVzdHJveV9lYWNoKGVhY2hfYmxvY2tzLCBkZXRhY2hpbmcpO1xuXHRcdH1cblx0fTtcbn1cblxuZnVuY3Rpb24gaW5zdGFuY2UkMSgkJHNlbGYsICQkcHJvcHMsICQkaW52YWxpZGF0ZSkge1xuXHRsZXQgJF92aWV3O1xuXHRsZXQgJGRhdGVzU2V0O1xuXHRsZXQgJF9hY3RpdmVSYW5nZTtcblx0bGV0ICRfYXV4aWxpYXJ5O1xuXHRsZXQgeyBkYXRlc1NldCwgX2F1eGlsaWFyeSwgX2FjdGl2ZVJhbmdlLCBfcXVldWUsIF92aWV3IH0gPSBnZXRDb250ZXh0KCdzdGF0ZScpO1xuXHRjb21wb25lbnRfc3Vic2NyaWJlKCQkc2VsZiwgZGF0ZXNTZXQsIHZhbHVlID0+ICQkaW52YWxpZGF0ZSg3LCAkZGF0ZXNTZXQgPSB2YWx1ZSkpO1xuXHRjb21wb25lbnRfc3Vic2NyaWJlKCQkc2VsZiwgX2F1eGlsaWFyeSwgdmFsdWUgPT4gJCRpbnZhbGlkYXRlKDAsICRfYXV4aWxpYXJ5ID0gdmFsdWUpKTtcblx0Y29tcG9uZW50X3N1YnNjcmliZSgkJHNlbGYsIF9hY3RpdmVSYW5nZSwgdmFsdWUgPT4gJCRpbnZhbGlkYXRlKDUsICRfYWN0aXZlUmFuZ2UgPSB2YWx1ZSkpO1xuXHRjb21wb25lbnRfc3Vic2NyaWJlKCQkc2VsZiwgX3ZpZXcsIHZhbHVlID0+ICQkaW52YWxpZGF0ZSg2LCAkX3ZpZXcgPSB2YWx1ZSkpO1xuXHRsZXQgZGVib3VuY2VIYW5kbGUgPSB7fTtcblxuXHRmdW5jdGlvbiBydW5EYXRlc1NldChfYWN0aXZlUmFuZ2UpIHtcblx0XHRpZiAoaXNfZnVuY3Rpb24oJGRhdGVzU2V0KSkge1xuXHRcdFx0ZGVib3VuY2UoXG5cdFx0XHRcdCgpID0+ICRkYXRlc1NldCh7XG5cdFx0XHRcdFx0c3RhcnQ6IHRvTG9jYWxEYXRlKF9hY3RpdmVSYW5nZS5zdGFydCksXG5cdFx0XHRcdFx0ZW5kOiB0b0xvY2FsRGF0ZShfYWN0aXZlUmFuZ2UuZW5kKSxcblx0XHRcdFx0XHRzdGFydFN0cjogdG9JU09TdHJpbmcoX2FjdGl2ZVJhbmdlLnN0YXJ0KSxcblx0XHRcdFx0XHRlbmRTdHI6IHRvSVNPU3RyaW5nKF9hY3RpdmVSYW5nZS5lbmQpLFxuXHRcdFx0XHRcdHZpZXc6IHRvVmlld1dpdGhMb2NhbERhdGVzKCRfdmlldylcblx0XHRcdFx0fSksXG5cdFx0XHRcdGRlYm91bmNlSGFuZGxlLFxuXHRcdFx0XHRfcXVldWVcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0JCRzZWxmLiQkLnVwZGF0ZSA9ICgpID0+IHtcblx0XHRpZiAoJCRzZWxmLiQkLmRpcnR5ICYgLyokX2FjdGl2ZVJhbmdlKi8gMzIpIHtcblx0XHRcdC8vIFNldCB1cCBkYXRlc1NldCBjYWxsYmFja1xuXHRcdFx0cnVuRGF0ZXNTZXQoJF9hY3RpdmVSYW5nZSk7XG5cdFx0fVxuXHR9O1xuXG5cdHJldHVybiBbJF9hdXhpbGlhcnksIGRhdGVzU2V0LCBfYXV4aWxpYXJ5LCBfYWN0aXZlUmFuZ2UsIF92aWV3LCAkX2FjdGl2ZVJhbmdlXTtcbn1cblxuY2xhc3MgQXV4aWxpYXJ5IGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHtcblx0Y29uc3RydWN0b3Iob3B0aW9ucykge1xuXHRcdHN1cGVyKCk7XG5cdFx0aW5pdCh0aGlzLCBvcHRpb25zLCBpbnN0YW5jZSQxLCBjcmVhdGVfZnJhZ21lbnQkMSwgc2FmZV9ub3RfZXF1YWwsIHt9KTtcblx0fVxufVxuXG4vKiBwYWNrYWdlcy9jb3JlL3NyYy9DYWxlbmRhci5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjE2ICovXG5cbmZ1bmN0aW9uIGNyZWF0ZV9mcmFnbWVudChjdHgpIHtcblx0bGV0IGRpdjtcblx0bGV0IHRvb2xiYXI7XG5cdGxldCB0MDtcblx0bGV0IHN3aXRjaF9pbnN0YW5jZTtcblx0bGV0IGRpdl9jbGFzc192YWx1ZTtcblx0bGV0IGRpdl9yb2xlX3ZhbHVlO1xuXHRsZXQgdDE7XG5cdGxldCBhdXhpbGlhcnk7XG5cdGxldCBjdXJyZW50O1xuXHRsZXQgbW91bnRlZDtcblx0bGV0IGRpc3Bvc2U7XG5cdHRvb2xiYXIgPSBuZXcgVG9vbGJhcih7fSk7XG5cdHZhciBzd2l0Y2hfdmFsdWUgPSAvKiRfdmlld0NvbXBvbmVudCovIGN0eFs1XTtcblxuXHRmdW5jdGlvbiBzd2l0Y2hfcHJvcHMoY3R4LCBkaXJ0eSkge1xuXHRcdHJldHVybiB7fTtcblx0fVxuXG5cdGlmIChzd2l0Y2hfdmFsdWUpIHtcblx0XHRzd2l0Y2hfaW5zdGFuY2UgPSBjb25zdHJ1Y3Rfc3ZlbHRlX2NvbXBvbmVudChzd2l0Y2hfdmFsdWUsIHN3aXRjaF9wcm9wcygpKTtcblx0fVxuXG5cdGF1eGlsaWFyeSA9IG5ldyBBdXhpbGlhcnkoe30pO1xuXG5cdHJldHVybiB7XG5cdFx0YygpIHtcblx0XHRcdGRpdiA9IGVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHRjcmVhdGVfY29tcG9uZW50KHRvb2xiYXIuJCQuZnJhZ21lbnQpO1xuXHRcdFx0dDAgPSBzcGFjZSgpO1xuXHRcdFx0aWYgKHN3aXRjaF9pbnN0YW5jZSkgY3JlYXRlX2NvbXBvbmVudChzd2l0Y2hfaW5zdGFuY2UuJCQuZnJhZ21lbnQpO1xuXHRcdFx0dDEgPSBzcGFjZSgpO1xuXHRcdFx0Y3JlYXRlX2NvbXBvbmVudChhdXhpbGlhcnkuJCQuZnJhZ21lbnQpO1xuXG5cdFx0XHRhdHRyKGRpdiwgXCJjbGFzc1wiLCBkaXZfY2xhc3NfdmFsdWUgPSBcIlwiICsgKC8qJHRoZW1lKi8gY3R4WzFdLmNhbGVuZGFyICsgXCIgXCIgKyAvKiR0aGVtZSovIGN0eFsxXS52aWV3ICsgKC8qJF9zY3JvbGxhYmxlKi8gY3R4WzBdXG5cdFx0XHQ/ICcgJyArIC8qJHRoZW1lKi8gY3R4WzFdLndpdGhTY3JvbGxcblx0XHRcdDogJycpICsgKC8qJF9pQ2xhc3MqLyBjdHhbMl1cblx0XHRcdD8gJyAnICsgLyokdGhlbWUqLyBjdHhbMV1bLyokX2lDbGFzcyovIGN0eFsyXV1cblx0XHRcdDogJycpKSk7XG5cblx0XHRcdGF0dHIoZGl2LCBcInJvbGVcIiwgZGl2X3JvbGVfdmFsdWUgPSBsaXN0VmlldygvKiR2aWV3Ki8gY3R4WzRdKSA/ICdsaXN0JyA6ICd0YWJsZScpO1xuXHRcdFx0c2V0X3N0eWxlKGRpdiwgXCJoZWlnaHRcIiwgLyokaGVpZ2h0Ki8gY3R4WzNdKTtcblx0XHR9LFxuXHRcdG0odGFyZ2V0LCBhbmNob3IpIHtcblx0XHRcdGluc2VydCh0YXJnZXQsIGRpdiwgYW5jaG9yKTtcblx0XHRcdG1vdW50X2NvbXBvbmVudCh0b29sYmFyLCBkaXYsIG51bGwpO1xuXHRcdFx0YXBwZW5kKGRpdiwgdDApO1xuXHRcdFx0aWYgKHN3aXRjaF9pbnN0YW5jZSkgbW91bnRfY29tcG9uZW50KHN3aXRjaF9pbnN0YW5jZSwgZGl2LCBudWxsKTtcblx0XHRcdGluc2VydCh0YXJnZXQsIHQxLCBhbmNob3IpO1xuXHRcdFx0bW91bnRfY29tcG9uZW50KGF1eGlsaWFyeSwgdGFyZ2V0LCBhbmNob3IpO1xuXHRcdFx0Y3VycmVudCA9IHRydWU7XG5cblx0XHRcdGlmICghbW91bnRlZCkge1xuXHRcdFx0XHRkaXNwb3NlID0gbGlzdGVuKHdpbmRvdywgXCJyZXNpemVcIiwgLypyZWNoZWNrU2Nyb2xsYWJsZSovIGN0eFsxN10pO1xuXHRcdFx0XHRtb3VudGVkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdHAoY3R4LCBkaXJ0eSkge1xuXHRcdFx0aWYgKGRpcnR5WzBdICYgLyokX3ZpZXdDb21wb25lbnQqLyAzMiAmJiBzd2l0Y2hfdmFsdWUgIT09IChzd2l0Y2hfdmFsdWUgPSAvKiRfdmlld0NvbXBvbmVudCovIGN0eFs1XSkpIHtcblx0XHRcdFx0aWYgKHN3aXRjaF9pbnN0YW5jZSkge1xuXHRcdFx0XHRcdGdyb3VwX291dHJvcygpO1xuXHRcdFx0XHRcdGNvbnN0IG9sZF9jb21wb25lbnQgPSBzd2l0Y2hfaW5zdGFuY2U7XG5cblx0XHRcdFx0XHR0cmFuc2l0aW9uX291dChvbGRfY29tcG9uZW50LiQkLmZyYWdtZW50LCAxLCAwLCAoKSA9PiB7XG5cdFx0XHRcdFx0XHRkZXN0cm95X2NvbXBvbmVudChvbGRfY29tcG9uZW50LCAxKTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGNoZWNrX291dHJvcygpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHN3aXRjaF92YWx1ZSkge1xuXHRcdFx0XHRcdHN3aXRjaF9pbnN0YW5jZSA9IGNvbnN0cnVjdF9zdmVsdGVfY29tcG9uZW50KHN3aXRjaF92YWx1ZSwgc3dpdGNoX3Byb3BzKCkpO1xuXHRcdFx0XHRcdGNyZWF0ZV9jb21wb25lbnQoc3dpdGNoX2luc3RhbmNlLiQkLmZyYWdtZW50KTtcblx0XHRcdFx0XHR0cmFuc2l0aW9uX2luKHN3aXRjaF9pbnN0YW5jZS4kJC5mcmFnbWVudCwgMSk7XG5cdFx0XHRcdFx0bW91bnRfY29tcG9uZW50KHN3aXRjaF9pbnN0YW5jZSwgZGl2LCBudWxsKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzd2l0Y2hfaW5zdGFuY2UgPSBudWxsO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmICghY3VycmVudCB8fCBkaXJ0eVswXSAmIC8qJHRoZW1lLCAkX3Njcm9sbGFibGUsICRfaUNsYXNzKi8gNyAmJiBkaXZfY2xhc3NfdmFsdWUgIT09IChkaXZfY2xhc3NfdmFsdWUgPSBcIlwiICsgKC8qJHRoZW1lKi8gY3R4WzFdLmNhbGVuZGFyICsgXCIgXCIgKyAvKiR0aGVtZSovIGN0eFsxXS52aWV3ICsgKC8qJF9zY3JvbGxhYmxlKi8gY3R4WzBdXG5cdFx0XHQ/ICcgJyArIC8qJHRoZW1lKi8gY3R4WzFdLndpdGhTY3JvbGxcblx0XHRcdDogJycpICsgKC8qJF9pQ2xhc3MqLyBjdHhbMl1cblx0XHRcdD8gJyAnICsgLyokdGhlbWUqLyBjdHhbMV1bLyokX2lDbGFzcyovIGN0eFsyXV1cblx0XHRcdDogJycpKSkpIHtcblx0XHRcdFx0YXR0cihkaXYsIFwiY2xhc3NcIiwgZGl2X2NsYXNzX3ZhbHVlKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFjdXJyZW50IHx8IGRpcnR5WzBdICYgLyokdmlldyovIDE2ICYmIGRpdl9yb2xlX3ZhbHVlICE9PSAoZGl2X3JvbGVfdmFsdWUgPSBsaXN0VmlldygvKiR2aWV3Ki8gY3R4WzRdKSA/ICdsaXN0JyA6ICd0YWJsZScpKSB7XG5cdFx0XHRcdGF0dHIoZGl2LCBcInJvbGVcIiwgZGl2X3JvbGVfdmFsdWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZGlydHlbMF0gJiAvKiRoZWlnaHQqLyA4KSB7XG5cdFx0XHRcdHNldF9zdHlsZShkaXYsIFwiaGVpZ2h0XCIsIC8qJGhlaWdodCovIGN0eFszXSk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRpKGxvY2FsKSB7XG5cdFx0XHRpZiAoY3VycmVudCkgcmV0dXJuO1xuXHRcdFx0dHJhbnNpdGlvbl9pbih0b29sYmFyLiQkLmZyYWdtZW50LCBsb2NhbCk7XG5cdFx0XHRpZiAoc3dpdGNoX2luc3RhbmNlKSB0cmFuc2l0aW9uX2luKHN3aXRjaF9pbnN0YW5jZS4kJC5mcmFnbWVudCwgbG9jYWwpO1xuXHRcdFx0dHJhbnNpdGlvbl9pbihhdXhpbGlhcnkuJCQuZnJhZ21lbnQsIGxvY2FsKTtcblx0XHRcdGN1cnJlbnQgPSB0cnVlO1xuXHRcdH0sXG5cdFx0byhsb2NhbCkge1xuXHRcdFx0dHJhbnNpdGlvbl9vdXQodG9vbGJhci4kJC5mcmFnbWVudCwgbG9jYWwpO1xuXHRcdFx0aWYgKHN3aXRjaF9pbnN0YW5jZSkgdHJhbnNpdGlvbl9vdXQoc3dpdGNoX2luc3RhbmNlLiQkLmZyYWdtZW50LCBsb2NhbCk7XG5cdFx0XHR0cmFuc2l0aW9uX291dChhdXhpbGlhcnkuJCQuZnJhZ21lbnQsIGxvY2FsKTtcblx0XHRcdGN1cnJlbnQgPSBmYWxzZTtcblx0XHR9LFxuXHRcdGQoZGV0YWNoaW5nKSB7XG5cdFx0XHRpZiAoZGV0YWNoaW5nKSB7XG5cdFx0XHRcdGRldGFjaChkaXYpO1xuXHRcdFx0XHRkZXRhY2godDEpO1xuXHRcdFx0fVxuXG5cdFx0XHRkZXN0cm95X2NvbXBvbmVudCh0b29sYmFyKTtcblx0XHRcdGlmIChzd2l0Y2hfaW5zdGFuY2UpIGRlc3Ryb3lfY29tcG9uZW50KHN3aXRjaF9pbnN0YW5jZSk7XG5cdFx0XHRkZXN0cm95X2NvbXBvbmVudChhdXhpbGlhcnksIGRldGFjaGluZyk7XG5cdFx0XHRtb3VudGVkID0gZmFsc2U7XG5cdFx0XHRkaXNwb3NlKCk7XG5cdFx0fVxuXHR9O1xufVxuXG5mdW5jdGlvbiBpbnN0YW5jZSgkJHNlbGYsICQkcHJvcHMsICQkaW52YWxpZGF0ZSkge1xuXHRsZXQgJF9ib2R5RWw7XG5cdGxldCAkX3Njcm9sbGFibGU7XG5cdGxldCAkX3F1ZXVlMjtcblx0bGV0ICRfcXVldWU7XG5cdGxldCAkX2ludGVyYWN0aW9uO1xuXHRsZXQgJF9ldmVudHM7XG5cdGxldCAkdGhlbWU7XG5cdGxldCAkX2lDbGFzcztcblx0bGV0ICRoZWlnaHQ7XG5cdGxldCAkdmlldztcblx0bGV0ICRfdmlld0NvbXBvbmVudDtcblx0bGV0IHsgcGx1Z2lucyA9IFtdIH0gPSAkJHByb3BzO1xuXHRsZXQgeyBvcHRpb25zID0ge30gfSA9ICQkcHJvcHM7XG5cdGxldCBjb21wb25lbnQgPSBnZXRfY3VycmVudF9jb21wb25lbnQoKTtcblx0bGV0IHN0YXRlID0gbmV3IFN0YXRlKHBsdWdpbnMsIG9wdGlvbnMpO1xuXHRzZXRDb250ZXh0KCdzdGF0ZScsIHN0YXRlKTtcblx0bGV0IHsgX3ZpZXdDb21wb25lbnQsIF9ib2R5RWwsIF9pbnRlcmFjdGlvbiwgX2lDbGFzcywgX2V2ZW50cywgX3F1ZXVlLCBfcXVldWUyLCBfdGFza3MsIF9zY3JvbGxhYmxlLCBoZWlnaHQsIHRoZW1lLCB2aWV3IH0gPSBzdGF0ZTtcblx0Y29tcG9uZW50X3N1YnNjcmliZSgkJHNlbGYsIF92aWV3Q29tcG9uZW50LCB2YWx1ZSA9PiAkJGludmFsaWRhdGUoNSwgJF92aWV3Q29tcG9uZW50ID0gdmFsdWUpKTtcblx0Y29tcG9uZW50X3N1YnNjcmliZSgkJHNlbGYsIF9ib2R5RWwsIHZhbHVlID0+ICQkaW52YWxpZGF0ZSgzMiwgJF9ib2R5RWwgPSB2YWx1ZSkpO1xuXHRjb21wb25lbnRfc3Vic2NyaWJlKCQkc2VsZiwgX2ludGVyYWN0aW9uLCB2YWx1ZSA9PiAkJGludmFsaWRhdGUoMzUsICRfaW50ZXJhY3Rpb24gPSB2YWx1ZSkpO1xuXHRjb21wb25lbnRfc3Vic2NyaWJlKCQkc2VsZiwgX2lDbGFzcywgdmFsdWUgPT4gJCRpbnZhbGlkYXRlKDIsICRfaUNsYXNzID0gdmFsdWUpKTtcblx0Y29tcG9uZW50X3N1YnNjcmliZSgkJHNlbGYsIF9ldmVudHMsIHZhbHVlID0+ICQkaW52YWxpZGF0ZSgzNiwgJF9ldmVudHMgPSB2YWx1ZSkpO1xuXHRjb21wb25lbnRfc3Vic2NyaWJlKCQkc2VsZiwgX3F1ZXVlLCB2YWx1ZSA9PiAkJGludmFsaWRhdGUoMzQsICRfcXVldWUgPSB2YWx1ZSkpO1xuXHRjb21wb25lbnRfc3Vic2NyaWJlKCQkc2VsZiwgX3F1ZXVlMiwgdmFsdWUgPT4gJCRpbnZhbGlkYXRlKDMzLCAkX3F1ZXVlMiA9IHZhbHVlKSk7XG5cdGNvbXBvbmVudF9zdWJzY3JpYmUoJCRzZWxmLCBfc2Nyb2xsYWJsZSwgdmFsdWUgPT4gJCRpbnZhbGlkYXRlKDAsICRfc2Nyb2xsYWJsZSA9IHZhbHVlKSk7XG5cdGNvbXBvbmVudF9zdWJzY3JpYmUoJCRzZWxmLCBoZWlnaHQsIHZhbHVlID0+ICQkaW52YWxpZGF0ZSgzLCAkaGVpZ2h0ID0gdmFsdWUpKTtcblx0Y29tcG9uZW50X3N1YnNjcmliZSgkJHNlbGYsIHRoZW1lLCB2YWx1ZSA9PiAkJGludmFsaWRhdGUoMSwgJHRoZW1lID0gdmFsdWUpKTtcblx0Y29tcG9uZW50X3N1YnNjcmliZSgkJHNlbGYsIHZpZXcsIHZhbHVlID0+ICQkaW52YWxpZGF0ZSg0LCAkdmlldyA9IHZhbHVlKSk7XG5cblx0Ly8gUmVhY3RpdmVseSB1cGRhdGUgb3B0aW9ucyB0aGF0IGRpZCBjaGFuZ2Vcblx0bGV0IHByZXZPcHRpb25zID0geyAuLi5vcHRpb25zIH07XG5cblx0ZnVuY3Rpb24gc2V0T3B0aW9uKG5hbWUsIHZhbHVlKSB7XG5cdFx0c3RhdGUuX3NldChuYW1lLCB2YWx1ZSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRmdW5jdGlvbiBnZXRPcHRpb24obmFtZSkge1xuXHRcdGxldCB2YWx1ZSA9IHN0YXRlLl9nZXQobmFtZSk7XG5cdFx0cmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgRGF0ZSA/IHRvTG9jYWxEYXRlKHZhbHVlKSA6IHZhbHVlO1xuXHR9XG5cblx0ZnVuY3Rpb24gcmVmZXRjaEV2ZW50cygpIHtcblx0XHRzdGF0ZS5fZmV0Y2hlZFJhbmdlLnNldCh7IHN0YXJ0OiB1bmRlZmluZWQsIGVuZDogdW5kZWZpbmVkIH0pO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0RXZlbnRzKCkge1xuXHRcdHJldHVybiAkX2V2ZW50cy5tYXAodG9FdmVudFdpdGhMb2NhbERhdGVzKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGdldEV2ZW50QnlJZChpZCkge1xuXHRcdGZvciAobGV0IGV2ZW50IG9mICRfZXZlbnRzKSB7XG5cdFx0XHRpZiAoZXZlbnQuaWQgPT0gaWQpIHtcblx0XHRcdFx0cmV0dXJuIHRvRXZlbnRXaXRoTG9jYWxEYXRlcyhldmVudCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRmdW5jdGlvbiBhZGRFdmVudChldmVudCkge1xuXHRcdCRfZXZlbnRzLnB1c2goY3JlYXRlRXZlbnRzKFtldmVudF0pWzBdKTtcblx0XHRfZXZlbnRzLnNldCgkX2V2ZW50cyk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRmdW5jdGlvbiB1cGRhdGVFdmVudChldmVudCkge1xuXHRcdGZvciAobGV0IGUgb2YgJF9ldmVudHMpIHtcblx0XHRcdGlmIChlLmlkID09IGV2ZW50LmlkKSB7XG5cdFx0XHRcdGFzc2lnbihlLCBjcmVhdGVFdmVudHMoW2V2ZW50XSlbMF0pO1xuXHRcdFx0XHRfZXZlbnRzLnNldCgkX2V2ZW50cyk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0ZnVuY3Rpb24gcmVtb3ZlRXZlbnRCeUlkKGlkKSB7XG5cdFx0bGV0IGlkeCA9ICRfZXZlbnRzLmZpbmRJbmRleChldmVudCA9PiBldmVudC5pZCA9PSBpZCk7XG5cblx0XHRpZiAoaWR4ID49IDApIHtcblx0XHRcdCRfZXZlbnRzLnNwbGljZShpZHgsIDEpO1xuXHRcdFx0X2V2ZW50cy5zZXQoJF9ldmVudHMpO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0VmlldygpIHtcblx0XHRyZXR1cm4gdG9WaWV3V2l0aExvY2FsRGF0ZXMoZ2V0KHN0YXRlLl92aWV3KSk7XG5cdH1cblxuXHRmdW5jdGlvbiB1bnNlbGVjdCgpIHtcblx0XHRpZiAoJF9pbnRlcmFjdGlvbi5hY3Rpb24pIHtcblx0XHRcdCRfaW50ZXJhY3Rpb24uYWN0aW9uLnVuc2VsZWN0KCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRmdW5jdGlvbiBkYXRlRnJvbVBvaW50KHgsIHkpIHtcblx0XHRsZXQgZGF5RWwgPSBnZXRFbGVtZW50V2l0aFBheWxvYWQoeCwgeSk7XG5cdFx0cmV0dXJuIGRheUVsID8gZ2V0UGF5bG9hZChkYXlFbCkoeCwgeSkgOiBudWxsO1xuXHR9XG5cblx0ZnVuY3Rpb24gZGVzdHJveSgpIHtcblx0XHRkZXN0cm95X2NvbXBvbmVudChjb21wb25lbnQsIHRydWUpO1xuXHR9XG5cblx0YmVmb3JlVXBkYXRlKCgpID0+IHtcblx0XHRmbHVzaERlYm91bmNlKCRfcXVldWUpO1xuXHR9KTtcblxuXHRhZnRlclVwZGF0ZSgoKSA9PiB7XG5cdFx0Zmx1c2hEZWJvdW5jZSgkX3F1ZXVlMik7XG5cdFx0dGFzayhyZWNoZWNrU2Nyb2xsYWJsZSwgbnVsbCwgX3Rhc2tzKTtcblx0fSk7XG5cblx0ZnVuY3Rpb24gcmVjaGVja1Njcm9sbGFibGUoKSB7XG5cdFx0aWYgKCRfYm9keUVsKSB7XG5cdFx0XHRzZXRfc3RvcmVfdmFsdWUoX3Njcm9sbGFibGUsICRfc2Nyb2xsYWJsZSA9IGhhc1lTY3JvbGwoJF9ib2R5RWwpLCAkX3Njcm9sbGFibGUpO1xuXHRcdH1cblx0fVxuXG5cdCQkc2VsZi4kJHNldCA9ICQkcHJvcHMgPT4ge1xuXHRcdGlmICgncGx1Z2lucycgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDE4LCBwbHVnaW5zID0gJCRwcm9wcy5wbHVnaW5zKTtcblx0XHRpZiAoJ29wdGlvbnMnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxOSwgb3B0aW9ucyA9ICQkcHJvcHMub3B0aW9ucyk7XG5cdH07XG5cblx0JCRzZWxmLiQkLnVwZGF0ZSA9ICgpID0+IHtcblx0XHRpZiAoJCRzZWxmLiQkLmRpcnR5WzBdICYgLypvcHRpb25zKi8gNTI0Mjg4KSB7XG5cdFx0XHRmb3IgKGxldCBbbmFtZSwgdmFsdWVdIG9mIGRpZmYob3B0aW9ucywgcHJldk9wdGlvbnMpKSB7XG5cdFx0XHRcdHNldE9wdGlvbihuYW1lLCB2YWx1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdHJldHVybiBbXG5cdFx0JF9zY3JvbGxhYmxlLFxuXHRcdCR0aGVtZSxcblx0XHQkX2lDbGFzcyxcblx0XHQkaGVpZ2h0LFxuXHRcdCR2aWV3LFxuXHRcdCRfdmlld0NvbXBvbmVudCxcblx0XHRfdmlld0NvbXBvbmVudCxcblx0XHRfYm9keUVsLFxuXHRcdF9pbnRlcmFjdGlvbixcblx0XHRfaUNsYXNzLFxuXHRcdF9ldmVudHMsXG5cdFx0X3F1ZXVlLFxuXHRcdF9xdWV1ZTIsXG5cdFx0X3Njcm9sbGFibGUsXG5cdFx0aGVpZ2h0LFxuXHRcdHRoZW1lLFxuXHRcdHZpZXcsXG5cdFx0cmVjaGVja1Njcm9sbGFibGUsXG5cdFx0cGx1Z2lucyxcblx0XHRvcHRpb25zLFxuXHRcdHNldE9wdGlvbixcblx0XHRnZXRPcHRpb24sXG5cdFx0cmVmZXRjaEV2ZW50cyxcblx0XHRnZXRFdmVudHMsXG5cdFx0Z2V0RXZlbnRCeUlkLFxuXHRcdGFkZEV2ZW50LFxuXHRcdHVwZGF0ZUV2ZW50LFxuXHRcdHJlbW92ZUV2ZW50QnlJZCxcblx0XHRnZXRWaWV3LFxuXHRcdHVuc2VsZWN0LFxuXHRcdGRhdGVGcm9tUG9pbnQsXG5cdFx0ZGVzdHJveVxuXHRdO1xufVxuXG5jbGFzcyBDYWxlbmRhciBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7XG5cdGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcblx0XHRzdXBlcigpO1xuXG5cdFx0aW5pdChcblx0XHRcdHRoaXMsXG5cdFx0XHRvcHRpb25zLFxuXHRcdFx0aW5zdGFuY2UsXG5cdFx0XHRjcmVhdGVfZnJhZ21lbnQsXG5cdFx0XHRzYWZlX25vdF9lcXVhbCxcblx0XHRcdHtcblx0XHRcdFx0cGx1Z2luczogMTgsXG5cdFx0XHRcdG9wdGlvbnM6IDE5LFxuXHRcdFx0XHRzZXRPcHRpb246IDIwLFxuXHRcdFx0XHRnZXRPcHRpb246IDIxLFxuXHRcdFx0XHRyZWZldGNoRXZlbnRzOiAyMixcblx0XHRcdFx0Z2V0RXZlbnRzOiAyMyxcblx0XHRcdFx0Z2V0RXZlbnRCeUlkOiAyNCxcblx0XHRcdFx0YWRkRXZlbnQ6IDI1LFxuXHRcdFx0XHR1cGRhdGVFdmVudDogMjYsXG5cdFx0XHRcdHJlbW92ZUV2ZW50QnlJZDogMjcsXG5cdFx0XHRcdGdldFZpZXc6IDI4LFxuXHRcdFx0XHR1bnNlbGVjdDogMjksXG5cdFx0XHRcdGRhdGVGcm9tUG9pbnQ6IDMwLFxuXHRcdFx0XHRkZXN0cm95OiAzMVxuXHRcdFx0fSxcblx0XHRcdG51bGwsXG5cdFx0XHRbLTEsIC0xXVxuXHRcdCk7XG5cdH1cblxuXHRnZXQgc2V0T3B0aW9uKCkge1xuXHRcdHJldHVybiB0aGlzLiQkLmN0eFsyMF07XG5cdH1cblxuXHRnZXQgZ2V0T3B0aW9uKCkge1xuXHRcdHJldHVybiB0aGlzLiQkLmN0eFsyMV07XG5cdH1cblxuXHRnZXQgcmVmZXRjaEV2ZW50cygpIHtcblx0XHRyZXR1cm4gdGhpcy4kJC5jdHhbMjJdO1xuXHR9XG5cblx0Z2V0IGdldEV2ZW50cygpIHtcblx0XHRyZXR1cm4gdGhpcy4kJC5jdHhbMjNdO1xuXHR9XG5cblx0Z2V0IGdldEV2ZW50QnlJZCgpIHtcblx0XHRyZXR1cm4gdGhpcy4kJC5jdHhbMjRdO1xuXHR9XG5cblx0Z2V0IGFkZEV2ZW50KCkge1xuXHRcdHJldHVybiB0aGlzLiQkLmN0eFsyNV07XG5cdH1cblxuXHRnZXQgdXBkYXRlRXZlbnQoKSB7XG5cdFx0cmV0dXJuIHRoaXMuJCQuY3R4WzI2XTtcblx0fVxuXG5cdGdldCByZW1vdmVFdmVudEJ5SWQoKSB7XG5cdFx0cmV0dXJuIHRoaXMuJCQuY3R4WzI3XTtcblx0fVxuXG5cdGdldCBnZXRWaWV3KCkge1xuXHRcdHJldHVybiB0aGlzLiQkLmN0eFsyOF07XG5cdH1cblxuXHRnZXQgdW5zZWxlY3QoKSB7XG5cdFx0cmV0dXJuIHRoaXMuJCQuY3R4WzI5XTtcblx0fVxuXG5cdGdldCBkYXRlRnJvbVBvaW50KCkge1xuXHRcdHJldHVybiB0aGlzLiQkLmN0eFszMF07XG5cdH1cblxuXHRnZXQgZGVzdHJveSgpIHtcblx0XHRyZXR1cm4gdGhpcy4kJC5jdHhbMzFdO1xuXHR9XG59XG5cbmV4cG9ydCB7IERBWV9JTl9TRUNPTkRTLCBhZGREYXksIGFkZER1cmF0aW9uLCBhbmNlc3RvciwgYXNzaWduLCBiZ0V2ZW50LCBidG5UZXh0RGF5LCBidG5UZXh0TW9udGgsIGJ0blRleHRXZWVrLCBidG5UZXh0WWVhciwgY2VpbCwgY2xvbmVEYXRlLCBjbG9uZUV2ZW50LCBjb3B5VGltZSwgY3JlYXRlRGF0ZSwgY3JlYXRlRHVyYXRpb24sIGNyZWF0ZUVsZW1lbnQsIGNyZWF0ZUV2ZW50Q2h1bmssIGNyZWF0ZUV2ZW50Q2xhc3NlcywgY3JlYXRlRXZlbnRDb250ZW50LCBjcmVhdGVFdmVudFNvdXJjZXMsIGNyZWF0ZUV2ZW50cywgY3JlYXRlU2xvdFRpbWVMaW1pdHMsIGNyZWF0ZVRpbWVzLCBjcmVhdGVWaWV3LCBkYXRlc0VxdWFsLCBkZWJvdW5jZSwgQ2FsZW5kYXIgYXMgZGVmYXVsdCwgZXZlbnRJbnRlcnNlY3RzLCBmbG9vciwgZmx1c2hEZWJvdW5jZSwgZ2V0RWxlbWVudFdpdGhQYXlsb2FkLCBnZXRQYXlsb2FkLCBnaG9zdEV2ZW50LCBoYXNQYXlsb2FkLCBoYXNZU2Nyb2xsLCBoZWlnaHQsIGhlbHBlckV2ZW50LCBpbnRsLCBpbnRsUmFuZ2UsIGtleUVudGVyLCBrZXlzLCBsaXN0VmlldywgbWF4LCBtaW4sIG5leHRDbG9zZXN0RGF5LCBub1RpbWVQYXJ0LCBvdXRzaWRlRXZlbnQsIHBvaW50ZXJFdmVudCwgcHJlcGFyZUV2ZW50Q2h1bmtzLCBwcmV2Q2xvc2VzdERheSwgcHJldmlld0V2ZW50LCByZWN0LCByZXBvc2l0aW9uRXZlbnQsIHJ1blJlcG9zaXRpb24sIHNldENvbnRlbnQsIHNldE1pZG5pZ2h0LCBzZXRQYXlsb2FkLCBzb3J0RXZlbnRDaHVua3MsIHN1YnRyYWN0RGF5LCBzdWJ0cmFjdER1cmF0aW9uLCBzeW1ib2wsIHRhc2ssIHRoZW1lVmlldywgdGltZWxpbmVWaWV3LCB0b0V2ZW50V2l0aExvY2FsRGF0ZXMsIHRvSVNPU3RyaW5nLCB0b0xvY2FsRGF0ZSwgdG9TZWNvbmRzLCB0b1ZpZXdXaXRoTG9jYWxEYXRlcyB9O1xuIiwgImltcG9ydCB7Y3JlYXRlRXZlbnRDb250ZW50fSBmcm9tIFwiQGV2ZW50LWNhbGVuZGFyL2NvcmVcIjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY2FsZW5kYXJXaWRnZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcgPSAnZGF5R3JpZE1vbnRoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbGUgPSAnZW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0RGF5ID0gMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudHMgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudENvbnRlbnQgPSBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlTGFiZWxDb250ZW50ID0gbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RhYmxlID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRDbGlja0VuYWJsZWQgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudERyYWdFbmFibGVkID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRSZXNpemVFbmFibGVkID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9FdmVudHNDbGlja0VuYWJsZWQgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlQ2xpY2tFbmFibGVkID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZVNlbGVjdEVuYWJsZWQgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlc1NldEVuYWJsZWQgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3RGlkTW91bnRFbmFibGVkID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRBbGxVcGRhdGVkRW5hYmxlZCA9IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheU1heEV2ZW50cyA9IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcmVMaW5rQ29udGVudCA9IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzID0gW10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzRGF0ZUNsaWNrQ29udGV4dE1lbnUgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNEYXRlU2VsZWN0Q29udGV4dE1lbnUgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNFdmVudENsaWNrQ29udGV4dE1lbnUgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNOb0V2ZW50c0NsaWNrQ29udGV4dE1lbnUgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0ge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5SGVhZGVyRm9ybWF0ID0gbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbG90TGFiZWxGb3JtYXQgPSBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50QXNzZXRVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSB7XG4gICAgcmV0dXJuIHtcblxuICAgICAgICBjYWxlbmRhckVsOiBudWxsLFxuXG4gICAgICAgIGluaXQ6IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuY2FsZW5kYXJFbCA9IHRoaXMuJGVsO1xuICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgbGV0IHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHZpZXc6IHZpZXcsXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VzOiByZXNvdXJjZXMsXG4gICAgICAgICAgICAgICAgZXZlbnRTb3VyY2VzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50czogKGZldGNoSW5mbywgc3VjY2Vzc0NhbGxiYWNrLCBmYWlsdXJlQ2FsbGJhY2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kd2lyZS5nZXRFdmVudHNKcyhmZXRjaEluZm8pXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGxvY2FsZTogbG9jYWxlLFxuICAgICAgICAgICAgICAgIGZpcnN0RGF5OiBmaXJzdERheSxcbiAgICAgICAgICAgICAgICBkYXlNYXhFdmVudHM6IGRheU1heEV2ZW50cyxcbiAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiBkYXRlU2VsZWN0RW5hYmxlZCxcbiAgICAgICAgICAgICAgICBldmVudFN0YXJ0RWRpdGFibGU6IGV2ZW50RHJhZ0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgZXZlbnREdXJhdGlvbkVkaXRhYmxlOiBldmVudFJlc2l6ZUVuYWJsZWQsXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoZGF5SGVhZGVyRm9ybWF0KSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuZGF5SGVhZGVyRm9ybWF0ID0gZGF5SGVhZGVyRm9ybWF0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2xvdExhYmVsRm9ybWF0KSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3Muc2xvdExhYmVsRm9ybWF0ID0gc2xvdExhYmVsRm9ybWF0O1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGlmIChkYXRlQ2xpY2tFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuZGF0ZUNsaWNrID0gKGluZm8pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc0RhdGVDbGlja0NvbnRleHRNZW51KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2NhbGVuZGFyLWNvbnRleHQtbWVudV0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVudSA9IEFscGluZS4kZGF0YShlbGVtZW50KVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVudS5sb2FkQWN0aW9ucygnZGF0ZUNsaWNrJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IGluZm8uZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlU3RyOiBpbmZvLmRhdGVTdHIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsRGF5OiBpbmZvLmFsbERheSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3OiBpbmZvLnZpZXcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2U6IGluZm8ucmVzb3VyY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgbWVudS5vcGVuTWVudShpbmZvLmpzRXZlbnQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLiRlbC5xdWVyeVNlbGVjdG9yKCdbY2FsZW5kYXItY29udGV4dC1tZW51XScpLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdjYWxlbmRhci0tb3Blbi1tZW51Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3VudERhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IGluZm8uZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVTdHI6IGluZm8uZGF0ZVN0cixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbERheTogaW5mby5hbGxEYXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3OiBpbmZvLnZpZXcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZTogaW5mby5yZXNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganNFdmVudDogaW5mby5qc0V2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXlFbDogaW5mby5kYXlFbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dDogJ2RhdGVDbGljaycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHdpcmUub25EYXRlQ2xpY2soe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IGluZm8uZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlU3RyOiBpbmZvLmRhdGVTdHIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsRGF5OiBpbmZvLmFsbERheSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3OiBpbmZvLnZpZXcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2U6IGluZm8ucmVzb3VyY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkYXRlU2VsZWN0RW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLnNlbGVjdCA9IChpbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChoYXNEYXRlU2VsZWN0Q29udGV4dE1lbnUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuJGVsLnF1ZXJ5U2VsZWN0b3IoJ1tjYWxlbmRhci1jb250ZXh0LW1lbnVdJykuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2NhbGVuZGFyLS1vcGVuLW1lbnUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdW50RGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGluZm8uc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFN0cjogaW5mby5zdGFydFN0cixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogaW5mby5lbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRTdHI6IGluZm8uZW5kU3RyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsRGF5OiBpbmZvLmFsbERheSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXc6IGluZm8udmlldyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlOiBpbmZvLnJlc291cmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqc0V2ZW50OiBpbmZvLmpzRXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6ICdkYXRlU2VsZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kd2lyZS5vbkRhdGVTZWxlY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBpbmZvLnN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0U3RyOiBpbmZvLnN0YXJ0U3RyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogaW5mby5lbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kU3RyOiBpbmZvLmVuZFN0cixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGxEYXk6IGluZm8uYWxsRGF5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXc6IGluZm8udmlldyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZTogaW5mby5yZXNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRhdGVzU2V0RW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLmRhdGVzU2V0ID0gKGluZm8pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kd2lyZS5vbkRhdGVzU2V0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBpbmZvLnN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRTdHI6IGluZm8uc3RhcnRTdHIsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IGluZm8uZW5kLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kU3RyOiBpbmZvLmVuZFN0cixcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXc6IGluZm8udmlldyxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGV2ZW50Q29udGVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLmV2ZW50Q29udGVudCA9IChpbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBzZWxmLmdldEV2ZW50Q29udGVudChpbmZvKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGh0bWw6IGNvbnRlbnQsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobW9yZUxpbmtDb250ZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MubW9yZUxpbmtDb250ZW50ID0gKGFyZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogc2VsZi5nZXRNb3JlTGlua0NvbnRlbnQoYXJnKSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZXNvdXJjZUxhYmVsQ29udGVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLnJlc291cmNlTGFiZWxDb250ZW50ID0gKGluZm8pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IHNlbGYuZ2V0UmVzb3VyY2VMYWJlbENvbnRlbnQoaW5mbyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBodG1sOiBjb250ZW50LFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChldmVudENsaWNrRW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLmV2ZW50Q2xpY2sgPSAoaW5mbykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBBbHBpbmUuJGRhdGEoaW5mby5lbClcbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50Lm9uQ2xpY2soaW5mbylcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobm9FdmVudHNDbGlja0VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5ub0V2ZW50c0NsaWNrID0gKGluZm8pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc05vRXZlbnRzQ2xpY2tDb250ZXh0TWVudSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi4kZWwucXVlcnlTZWxlY3RvcignW2NhbGVuZGFyLWNvbnRleHQtbWVudV0nKS5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnY2FsZW5kYXItLW9wZW4tbWVudScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW91bnREYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3OiBpbmZvLnZpZXcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzRXZlbnQ6IGluZm8uanNFdmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dDogJ25vRXZlbnRzQ2xpY2snLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiR3aXJlLm9uTm9FdmVudHNDbGljayh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlldzogaW5mby52aWV3LFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNldHRpbmdzLmV2ZW50UmVzaXplID0gYXN5bmMgKGluZm8pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbkVkaXRhYmxlID0gaW5mby5ldmVudC5kdXJhdGlvbkVkaXRhYmxlO1xuICAgICAgICAgICAgICAgIGxldCBlbmFibGVkID0gZXZlbnRSZXNpemVFbmFibGVkO1xuXG4gICAgICAgICAgICAgICAgaWYgKGR1cmF0aW9uRWRpdGFibGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVkID0gZHVyYXRpb25FZGl0YWJsZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLiR3aXJlLm9uRXZlbnRSZXNpemUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IGluZm8uZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRFdmVudDogaW5mby5vbGRFdmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZERlbHRhOiBpbmZvLmVuZERlbHRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmlldzogaW5mby52aWV3LFxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5yZXZlcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2V0dGluZ3MuZXZlbnREcm9wID0gYXN5bmMgKGluZm8pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydEVkaXRhYmxlID0gaW5mby5ldmVudC5zdGFydEVkaXRhYmxlO1xuICAgICAgICAgICAgICAgIGxldCBlbmFibGVkID0gZXZlbnREcmFnRW5hYmxlZDtcblxuICAgICAgICAgICAgICAgIGlmIChzdGFydEVkaXRhYmxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZCA9IHN0YXJ0RWRpdGFibGU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy4kd2lyZS5vbkV2ZW50RHJvcCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudDogaW5mby5ldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZEV2ZW50OiBpbmZvLm9sZEV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkUmVzb3VyY2U6IGluZm8ub2xkUmVzb3VyY2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdSZXNvdXJjZTogaW5mby5uZXdSZXNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRhOiBpbmZvLmRlbHRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmlldzogaW5mby52aWV3LFxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5yZXZlcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICBpZiAodmlld0RpZE1vdW50RW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLnZpZXdEaWRNb3VudCA9ICh2aWV3KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHdpcmUub25WaWV3RGlkTW91bnQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlldzogdmlldyxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGV2ZW50QWxsVXBkYXRlZEVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5ldmVudEFsbFVwZGF0ZWQgPSAoaW5mbykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiR3aXJlLm9uRXZlbnRBbGxVcGRhdGVkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm86IGluZm8sXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNldHRpbmdzLmV2ZW50RGlkTW91bnQgPSAoaW5mbykgPT4ge1xuICAgICAgICAgICAgICAgIGluZm8uZWwuc2V0QXR0cmlidXRlKCd4LWxvYWQnKVxuICAgICAgICAgICAgICAgIGluZm8uZWwuc2V0QXR0cmlidXRlKCd4LWxvYWQtc3JjJywgZXZlbnRBc3NldFVybClcbiAgICAgICAgICAgICAgICBpbmZvLmVsLnNldEF0dHJpYnV0ZSgneC1kYXRhJywgYGV2ZW50KHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQ6ICR7SlNPTi5zdHJpbmdpZnkoaW5mby5ldmVudCl9LFxuICAgICAgICAgICAgICAgICAgICB0aW1lVGV4dDogXCIke2luZm8udGltZVRleHR9XCIsXG4gICAgICAgICAgICAgICAgICAgIHZpZXc6ICR7SlNPTi5zdHJpbmdpZnkoaW5mby52aWV3KX0sXG4gICAgICAgICAgICAgICAgICAgIGhhc0V2ZW50Q2xpY2tDb250ZXh0TWVudTogJHtoYXNFdmVudENsaWNrQ29udGV4dE1lbnV9LFxuICAgICAgICAgICAgICAgIH0pYClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5lYyA9IEV2ZW50Q2FsZW5kYXIuY3JlYXRlKHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoJ2RpdicpLCB7XG4gICAgICAgICAgICAgICAgLi4uc2V0dGluZ3MsXG4gICAgICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdjYWxlbmRhci0tcmVmcmVzaCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVjLnJlZmV0Y2hFdmVudHMoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLiR3aXJlLm9uKCdjYWxlbmRhci0tc2V0JywgKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVjLnNldE9wdGlvbihkYXRhLmtleSwgZGF0YS52YWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRFdmVudENvbnRlbnQ6IGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGV2ZW50Q29udGVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy53cmFwQ29udGVudChldmVudENvbnRlbnQsIGluZm8pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGV2ZW50Q29udGVudCA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbCA9IGluZm8uZXZlbnQuZXh0ZW5kZWRQcm9wcy5tb2RlbDtcbiAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZXZlbnRDb250ZW50W21vZGVsXTtcblxuICAgICAgICAgICAgICAgIGlmIChjb250ZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy53cmFwQ29udGVudChjb250ZW50LCBpbmZvKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRSZXNvdXJjZUxhYmVsQ29udGVudDogZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzb3VyY2VMYWJlbENvbnRlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMud3JhcENvbnRlbnQocmVzb3VyY2VMYWJlbENvbnRlbnQsIGluZm8pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHJlc291cmNlTGFiZWxDb250ZW50ID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVsID0gaW5mby5ldmVudC5leHRlbmRlZFByb3BzLm1vZGVsO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSByZXNvdXJjZUxhYmVsQ29udGVudFttb2RlbF07XG5cbiAgICAgICAgICAgICAgICBpZiAoY29udGVudCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMud3JhcENvbnRlbnQoY29udGVudCwgaW5mbyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0TW9yZUxpbmtDb250ZW50OiBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMud3JhcENvbnRlbnQobW9yZUxpbmtDb250ZW50LCBpbmZvKTtcbiAgICAgICAgfSxcblxuICAgICAgICB3cmFwQ29udGVudDogZnVuY3Rpb24gKGNvbnRlbnQsIGluZm8pIHtcbiAgICAgICAgICAgIGxldCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBjb250ZW50O1xuXG4gICAgICAgICAgICAvLyBBZGQgYWxwaW5lIGRhdGEgYW5kIGNsYXNzZXNcbiAgICAgICAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ3gtZGF0YScsIEpTT04uc3RyaW5naWZ5KGluZm8pKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCd3LWZ1bGwnKTtcblxuICAgICAgICAgICAgLy8gR2V0IHRoZSBtb2RpZmllZCBIVE1MXG4gICAgICAgICAgICByZXR1cm4gY29udGFpbmVyLm91dGVySFRNTDtcbiAgICAgICAgfSxcbiAgICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7OztBQUNPLElBQU0sVUFDWixPQUFPLFdBQVcsY0FDZixTQUNBLE9BQU8sZUFBZSxjQUN0QjtBQUFBO0FBQUEsRUFFQTtBQUFBOzs7QUNBRyxJQUFNLDBCQUFOLE1BQU0seUJBQXdCO0FBQUE7QUFBQSxFQWtCcEMsWUFBWSxTQUFTO0FBWnJCO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQ0FBYSxhQUFhLFVBQVUsb0JBQUksUUFBUSxJQUFJO0FBTXBEO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBSUMsU0FBSyxVQUFVO0FBQUEsRUFDaEI7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFPQSxRQUFRQSxVQUFTLFVBQVU7QUFDMUIsU0FBSyxXQUFXLElBQUlBLFVBQVMsUUFBUTtBQUNyQyxTQUFLLGFBQWEsRUFBRSxRQUFRQSxVQUFTLEtBQUssT0FBTztBQUNqRCxXQUFPLE1BQU07QUFDWixXQUFLLFdBQVcsT0FBT0EsUUFBTztBQUM5QixXQUFLLFVBQVUsVUFBVUEsUUFBTztBQUFBLElBQ2pDO0FBQUEsRUFDRDtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBS0EsZUFBZTtBQUNkLFdB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LENBQUM7QUFFRCxhQUFPLGlCQUFpQixxQkFBcUIsTUFBTTtBQUMvQyxhQUFLLEdBQUcsY0FBYztBQUFBLE1BQzFCLENBQUM7QUFFRCxXQUFLLE1BQU0sR0FBRyxpQkFBaUIsQ0FBQyxTQUFTO0FBQ3JDLGFBQUssR0FBRyxVQUFVLEtBQUssS0FBSyxLQUFLLEtBQUs7QUFBQSxNQUMxQyxDQUFDO0FBQUEsSUFDTDtBQUFBLElBRUEsaUJBQWlCLFNBQVUsTUFBTTtBQUM3QixVQUFJLE9BQU8saUJBQWlCLFVBQVU7QUFDbEMsZUFBTyxLQUFLLFlBQVksY0FBYyxJQUFJO0FBQUEsTUFDOUM7QUFFQSxVQUFJLE9BQU8saUJBQWlCLFVBQVU7QUFDbEMsY0FBTSxRQUFRLEtBQUssTUFBTSxjQUFjO0FBQ3ZDLGNBQU0sVUFBVSxhQUFhLEtBQUs7QUFFbEMsWUFBSSxZQUFZLFFBQVc7QUFDdkIsaUJBQU87QUFBQSxRQUNYO0FBRUEsZUFBTyxLQUFLLFlBQVksU0FBUyxJQUFJO0FBQUEsTUFDekM7QUFFQSxhQUFPO0FBQUEsSUFDWDtBQUFBLElBRUEseUJBQXlCLFNBQVUsTUFBTTtBQUNyQyxVQUFJLE9BQU8seUJBQXlCLFVBQVU7QUFDMUMsZUFBTyxLQUFLLFlBQVksc0JBQXNCLElBQUk7QUFBQSxNQUN0RDtBQUVBLFVBQUksT0FBTyx5QkFBeUIsVUFBVTtBQUMxQyxjQUFNLFFBQVEsS0FBSyxNQUFNLGNBQWM7QUFDdkMsY0FBTSxVQUFVLHFCQUFxQixLQUFLO0FBRTFDLFlBQUksWUFBWSxRQUFXO0FBQ3ZCLGlCQUFPO0FBQUEsUUFDWDtBQUVBLGVBQU8sS0FBSyxZQUFZLFNBQVMsSUFBSTtBQUFBLE1BQ3pDO0FBRUEsYUFBTztBQUFBLElBQ1g7QUFBQSxJQUVBLG9CQUFvQixTQUFVLE1BQU07QUFDaEMsYUFBTyxLQUFLLFlBQVksaUJBQWlCLElBQUk7QUFBQSxJQUNqRDtBQUFBLElBRUEsYUFBYSxTQUFVLFNBQVMsTUFBTTtBQUNsQyxVQUFJLFlBQVksU0FBUyxjQUFjLEtBQUs7QUFDNUMsZ0JBQVUsWUFBWTtBQUd0QixnQkFBVSxhQUFhLFVBQVUsS0FBSyxVQUFVLElBQUksQ0FBQztBQUNyRCxnQkFBVSxVQUFVLElBQUksUUFBUTtBQUdoQyxhQUFPLFVBQVU7QUFBQSxJQUNyQjtBQUFBLEVBQ0o7QUFDSjsiLAogICJuYW1lcyI6IFsiZWxlbWVudCIsICJlbGVtZW50IiwgImF0dHIiLCAiZWxlbWVudCIsICJ2aWV3Il0KfQo=
